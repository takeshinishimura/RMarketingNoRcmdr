<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rコマンダーを使わずに『現代マーケティング・リサーチ』を読む</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-e789b2bbe5e3b72425b62d406c7e8d6a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Rコマンダーを使わずに『現代マーケティング・リサーチ』を読む</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#第3章-サンプリング" id="toc-第3章-サンプリング" class="nav-link active" data-scroll-target="#第3章-サンプリング">第3章 サンプリング</a>
  <ul>
  <li><a href="#単純無作為サンプリング" id="toc-単純無作為サンプリング" class="nav-link" data-scroll-target="#単純無作為サンプリング">4 単純無作為サンプリング</a>
  <ul class="collapse">
  <li><a href="#rコマンダーによる乱数表作成" id="toc-rコマンダーによる乱数表作成" class="nav-link" data-scroll-target="#rコマンダーによる乱数表作成">4.1 Rコマンダーによる乱数表作成</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第5章-市場反応分析i" id="toc-第5章-市場反応分析i" class="nav-link" data-scroll-target="#第5章-市場反応分析i">第5章 市場反応分析（I）</a>
  <ul>
  <li><a href="#相関分析" id="toc-相関分析" class="nav-link" data-scroll-target="#相関分析">3 相関分析</a>
  <ul class="collapse">
  <li><a href="#売上と価格のデータ散布図の作成" id="toc-売上と価格のデータ散布図の作成" class="nav-link" data-scroll-target="#売上と価格のデータ散布図の作成">3.2 売上と価格のデータ：散布図の作成</a></li>
  <li><a href="#売上と価格に相関はあるか標本相関係数の検定" id="toc-売上と価格に相関はあるか標本相関係数の検定" class="nav-link" data-scroll-target="#売上と価格に相関はあるか標本相関係数の検定">3.3 売上と価格に相関はあるか：標本相関係数の検定</a></li>
  </ul></li>
  <li><a href="#売上と価格の市場反応分析回帰モデル" id="toc-売上と価格の市場反応分析回帰モデル" class="nav-link" data-scroll-target="#売上と価格の市場反応分析回帰モデル">4 売上と価格の市場反応分析：回帰モデル</a>
  <ul class="collapse">
  <li><a href="#価格反応係数推定値の精度と信頼区間" id="toc-価格反応係数推定値の精度と信頼区間" class="nav-link" data-scroll-target="#価格反応係数推定値の精度と信頼区間">4.1 価格反応係数推定値の精度と信頼区間</a></li>
  </ul></li>
  <li><a href="#複数の説明変数を持つ市場反応分析重回帰モデル" id="toc-複数の説明変数を持つ市場反応分析重回帰モデル" class="nav-link" data-scroll-target="#複数の説明変数を持つ市場反応分析重回帰モデル">5 複数の説明変数を持つ市場反応分析：重回帰モデル</a>
  <ul class="collapse">
  <li><a href="#価格と販売促進の効果" id="toc-価格と販売促進の効果" class="nav-link" data-scroll-target="#価格と販売促進の効果">5.1 価格と販売促進の効果</a></li>
  </ul></li>
  <li><a href="#弾力性測定モデル" id="toc-弾力性測定モデル" class="nav-link" data-scroll-target="#弾力性測定モデル">6 弾力性測定モデル</a>
  <ul class="collapse">
  <li><a href="#交差価格弾力性による競合関係の測定" id="toc-交差価格弾力性による競合関係の測定" class="nav-link" data-scroll-target="#交差価格弾力性による競合関係の測定">6.1 交差価格弾力性による競合関係の測定</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第6章-市場の発見と知覚マップ" id="toc-第6章-市場の発見と知覚マップ" class="nav-link" data-scroll-target="#第6章-市場の発見と知覚マップ">第6章 市場の発見と知覚マップ</a>
  <ul>
  <li><a href="#知覚マップの作成" id="toc-知覚マップの作成" class="nav-link" data-scroll-target="#知覚マップの作成">4 知覚マップの作成</a></li>
  <li><a href="#rコマンダーでの手順" id="toc-rコマンダーでの手順" class="nav-link" data-scroll-target="#rコマンダーでの手順">5 Rコマンダーでの手順</a></li>
  <li><a href="#その他の問題" id="toc-その他の問題" class="nav-link" data-scroll-target="#その他の問題">6 その他の問題</a>
  <ul class="collapse">
  <li><a href="#共通因子数の設定" id="toc-共通因子数の設定" class="nav-link" data-scroll-target="#共通因子数の設定">6.2 共通因子数の設定</a></li>
  </ul></li>
  <li><a href="#サブマーケットと市場構造" id="toc-サブマーケットと市場構造" class="nav-link" data-scroll-target="#サブマーケットと市場構造">7 サブマーケットと市場構造</a></li>
  </ul></li>
  <li><a href="#第7章-市場セグメンテーション" id="toc-第7章-市場セグメンテーション" class="nav-link" data-scroll-target="#第7章-市場セグメンテーション">第7章 市場セグメンテーション</a>
  <ul>
  <li><a href="#rコマンダーによる市場セグメンテーション" id="toc-rコマンダーによる市場セグメンテーション" class="nav-link" data-scroll-target="#rコマンダーによる市場セグメンテーション">5 Rコマンダーによる市場セグメンテーション</a>
  <ul class="collapse">
  <li><a href="#因子分析" id="toc-因子分析" class="nav-link" data-scroll-target="#因子分析">5.2 因子分析</a></li>
  <li><a href="#クラスター分析" id="toc-クラスター分析" class="nav-link" data-scroll-target="#クラスター分析">5.3 クラスター分析</a></li>
  <li><a href="#セグメントのプロファイリング" id="toc-セグメントのプロファイリング" class="nav-link" data-scroll-target="#セグメントのプロファイリング">5.4 セグメントのプロファイリング</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第8章-製品開発" id="toc-第8章-製品開発" class="nav-link" data-scroll-target="#第8章-製品開発">第8章 製品開発</a>
  <ul>
  <li><a href="#コンジョイント分析" id="toc-コンジョイント分析" class="nav-link" data-scroll-target="#コンジョイント分析">4 コンジョイント分析</a>
  <ul class="collapse">
  <li><a href="#個人分析rコマンダーによる分析" id="toc-個人分析rコマンダーによる分析" class="nav-link" data-scroll-target="#個人分析rコマンダーによる分析">4.2 個人分析：Rコマンダーによる分析</a></li>
  </ul></li>
  <li><a href="#直交表利用によるコンジョイント分析" id="toc-直交表利用によるコンジョイント分析" class="nav-link" data-scroll-target="#直交表利用によるコンジョイント分析">5 直交表利用によるコンジョイント分析</a>
  <ul class="collapse">
  <li><a href="#集計分析rコマンダーによる分析" id="toc-集計分析rコマンダーによる分析" class="nav-link" data-scroll-target="#集計分析rコマンダーによる分析">5.3 集計分析：Rコマンダーによる分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第9章-新製品の普及" id="toc-第9章-新製品の普及" class="nav-link" data-scroll-target="#第9章-新製品の普及">第9章 新製品の普及</a>
  <ul>
  <li><a href="#rコマンダーによる新製品普及構造の分析" id="toc-rコマンダーによる新製品普及構造の分析" class="nav-link" data-scroll-target="#rコマンダーによる新製品普及構造の分析">6 Rコマンダーによる新製品普及構造の分析</a>
  <ul class="collapse">
  <li><a href="#回帰分析" id="toc-回帰分析" class="nav-link" data-scroll-target="#回帰分析">6.1 回帰分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第10章-顧客の管理" id="toc-第10章-顧客の管理" class="nav-link" data-scroll-target="#第10章-顧客の管理">第10章 顧客の管理</a>
  <ul>
  <li><a href="#rコマンダーによる顧客管理のための分析" id="toc-rコマンダーによる顧客管理のための分析" class="nav-link" data-scroll-target="#rコマンダーによる顧客管理のための分析">4 Rコマンダーによる顧客管理のための分析</a>
  <ul class="collapse">
  <li><a href="#rfm分析" id="toc-rfm分析" class="nav-link" data-scroll-target="#rfm分析">4.1 RFM分析</a></li>
  <li><a href="#ロジスティック回帰分析" id="toc-ロジスティック回帰分析" class="nav-link" data-scroll-target="#ロジスティック回帰分析">4.2 ロジスティック回帰分析</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="https://www.yuhikaku.co.jp/books/detail/9784641166080" target="_blank">照井伸彦・佐藤忠彦（2022）『現代マーケティング・リサーチ—市場を読み解くデータ分析 新版』有斐閣</a> は，Rを用いたマーケティング・リサーチの入門書として位置づけられる。</p>
<p>本書の想定読者は，Rを初めて使用する学生であり，プログラミングに戸惑うことが予想されるため，Rコマンダーを利用して解説している。 しかし，Rに慣れた読者にとっては，Rコマンダーの処理がブラックボックス化されており，かえって分かりにくい。 そこで，本サイトでは，Rコマンダーによって生成されたコードと，それと同じ処理をRに習熟したユーザーが記述する場合のコードを並べて示し，理解を助ける構成としている。</p>
<p>また，本書にはいくつか誤植があり，本書の指示通りに操作を進めると，Rコマンダーの利用において行き詰まる箇所がある。 そのような部分については適宜修正しながら読み進めることを推奨する。</p>
<section id="第3章-サンプリング" class="level2">
<h2 class="anchored" data-anchor-id="第3章-サンプリング">第3章 サンプリング</h2>
<section id="単純無作為サンプリング" class="level3">
<h3 class="anchored" data-anchor-id="単純無作為サンプリング">4 単純無作為サンプリング</h3>
<section id="rコマンダーによる乱数表作成" class="level4">
<h4 class="anchored" data-anchor-id="rコマンダーによる乱数表作成">4.1 Rコマンダーによる乱数表作成</h4>
<section id="rコマンダーによって生成されたコードp.-37" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-37">▶ Rコマンダーによって生成されたコード（p.&nbsp;37）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>UniformSamples <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">1</span><span class="sc">*</span><span class="dv">100</span>, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">1</span>), <span class="at">ncol=</span><span class="dv">100</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(UniformSamples) <span class="ot">&lt;-</span> <span class="st">"sample"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(UniformSamples) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"obs"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコード" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコード">▶ 手入力するコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> UniformSamples <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rx <span class="ot">&lt;-</span> <span class="fu">round</span>(x) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(rx)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ux[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード">▶ 一般的なRコード</h5>
<p>乱数を生成する際に，あらかじめ <code>set.seed()</code> を実行しておくと，同じ操作を繰り返したときに同じ乱数を再現できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>set.seed()</code> のかっこ中の数字は何でもよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">ceiling</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>)))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ux[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 31 26 56  6 47 49 82 38 55 18</code></pre>
</div>
</div>
<p>または</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ux[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 82 53  3  5 44 85 28 52 25 42</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第5章-市場反応分析i" class="level2">
<h2 class="anchored" data-anchor-id="第5章-市場反応分析i">第5章 市場反応分析（I）</h2>
<section id="相関分析" class="level3">
<h3 class="anchored" data-anchor-id="相関分析">3 相関分析</h3>
<section id="売上と価格のデータ散布図の作成" class="level4">
<h4 class="anchored" data-anchor-id="売上と価格のデータ散布図の作成">3.2 売上と価格のデータ：散布図の作成</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;84</p>
<ul>
<li>（誤）欠損値はないこと“NA”で表している。</li>
<li>（正）欠損値を“NA”で表すように設定している。</li>
</ul>
<p>p.&nbsp;85</p>
<ul>
<li>（誤）小数点の記号がピリオドかカンマの指定もできる。</li>
<li>（正）小数点の記号をピリオドかカンマに指定できる。</li>
</ul>
<p>p.&nbsp;86</p>
<ul>
<li>（誤）“売上”を選択し，図5.5のようにそれぞれ反転させる。</li>
<li>（正）“売上”を選択し，図5.5左のようにそれぞれ青色に反転させる。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-84" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(売上<span class="sc">~</span>価格, <span class="at">regLine=</span><span class="cn">FALSE</span>, <span class="at">smooth=</span><span class="cn">FALSE</span>, <span class="at">boxplots=</span><span class="cn">FALSE</span>, <span class="at">data=</span>Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-1" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-1">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Dataset)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"売上数量"</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>図5.2の縦軸が「売上数量」となっていたため，列名を変更した。 一般的に「売上」は売上高を指すため，価格と売上の相関関係を図示するのはやや不自然である（価格が上がれば，売上数量が一定の場合，売上高も上昇する）。 この点を踏まえると，本書では図が修正されたものの，本文の修正が反映されないまま出版された可能性があるのではないだろうか。 なお，p.&nbsp;102の本文では「売上数量」と明確に同じ意味で使わる「売上」の記述が見られる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   売上数量 価格 販促
1      2052  840    0
2      2105  820    0
3      2450  790    1
4      2131  780    0
5      2806  640    1
6      2532  710    0
7      3650  350    1
8      2968  560    0
9      2605  780    1
10     2652  640    0
11     3062  600    1
12     3237  510    1
13     2831  480    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">regLine =</span> <span class="cn">FALSE</span>, <span class="at">smooth =</span> <span class="cn">FALSE</span>, <span class="at">boxplots =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">data =</span> Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>scatterplot()</code> は <code>car</code> パッケージの関数であるため，最初に <code>car</code> パッケージをロードしている。</p>
<p>あるいは，次のように汎用的な作図関数 <code>plot()</code> を使ってもよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">data =</span> Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="売上と価格に相関はあるか標本相関係数の検定" class="level4">
<h4 class="anchored" data-anchor-id="売上と価格に相関はあるか標本相関係数の検定">3.3 売上と価格に相関はあるか：標本相関係数の検定</h4>
<section id="rコマンダーによって生成されたコードp.-87" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-87">▶ Rコマンダーによって生成されたコード（p.&nbsp;87）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">cor.test</span>(価格, 売上, <span class="at">alternative=</span><span class="st">"two.sided"</span>, <span class="at">method=</span><span class="st">"pearson"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-2" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-2">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(Dataset<span class="sc">$</span>価格, Dataset<span class="sc">$</span>売上数量, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  Dataset$価格 and Dataset$売上数量
t = -8.1457, df = 11, p-value = 5.5e-06
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.9780506 -0.7661642
sample estimates:
       cor 
-0.9261709 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="売上と価格の市場反応分析回帰モデル" class="level3">
<h3 class="anchored" data-anchor-id="売上と価格の市場反応分析回帰モデル">4 売上と価格の市場反応分析：回帰モデル</h3>
<section id="rコマンダーによって生成されたコードp.-91" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-91">▶ Rコマンダーによって生成されたコード（p.&nbsp;91）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上<span class="sc">~</span>価格, <span class="at">data=</span>Dataset)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-3" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-3">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">data =</span> Dataset)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 売上数量 ~ 価格, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-368.25 -110.38   -0.84  124.15  269.81 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4581.7523   236.7640  19.352 7.61e-10 ***
価格          -2.8802     0.3536  -8.146 5.50e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 184.1 on 11 degrees of freedom
Multiple R-squared:  0.8578,    Adjusted R-squared:  0.8449 
F-statistic: 66.35 on 1 and 11 DF,  p-value: 5.5e-06</code></pre>
</div>
</div>
<p>昔は変数名（先頭ではなく途中）に <code>.</code> が使用されることもあったが，最近は使用しないのが一般的である。</p>
</section>
<section id="価格反応係数推定値の精度と信頼区間" class="level4">
<h4 class="anchored" data-anchor-id="価格反応係数推定値の精度と信頼区間">4.1 価格反応係数推定値の精度と信頼区間</h4>
<section id="rコマンダーによって生成されたコードp.-93" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-93">▶ Rコマンダーによって生成されたコード（p.&nbsp;93）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Confint</span>(RegModel<span class="fl">.1</span>, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-4" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-4">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Confint</span>(RegModel_1, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate       2.5 %      97.5 %
(Intercept) 4581.752298 4060.638183 5102.866414
価格          -2.880209   -3.658452   -2.101967</code></pre>
</div>
</div>
<p><code>Confint()</code> は <code>car</code> パッケージの関数である。</p>
</section>
</section>
</section>
<section id="複数の説明変数を持つ市場反応分析重回帰モデル" class="level3">
<h3 class="anchored" data-anchor-id="複数の説明変数を持つ市場反応分析重回帰モデル">5 複数の説明変数を持つ市場反応分析：重回帰モデル</h3>
<section id="価格と販売促進の効果" class="level4">
<h4 class="anchored" data-anchor-id="価格と販売促進の効果">5.1 価格と販売促進の効果</h4>
<section id="rコマンダーによって生成されたコードp.-98" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-98">▶ Rコマンダーによって生成されたコード（p.&nbsp;98）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上<span class="sc">~</span>価格<span class="sc">+</span>販促, <span class="at">data=</span>Dataset)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-5" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-5">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>RegModel_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上数量 <span class="sc">~</span> 価格 <span class="sc">+</span> 販促, <span class="at">data =</span> Dataset)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 売上数量 ~ 価格 + 販促, data = Dataset)

Residuals:
     Min       1Q   Median       3Q      Max 
-182.876  -54.165    0.597   63.301  162.349 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4263.2262   148.6279  28.684 6.18e-11 ***
価格          -2.6028     0.2077 -12.531 1.94e-07 ***
販促         297.1607    60.1706   4.939 0.000588 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 104.1 on 10 degrees of freedom
Multiple R-squared:  0.9586,    Adjusted R-squared:  0.9504 
F-statistic: 115.9 on 2 and 10 DF,  p-value: 1.209e-07</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;100</p>
<ul>
<li>（誤）適合度が0.08程度</li>
<li>（正）適合度が0.008程度</li>
</ul>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="弾力性測定モデル" class="level3">
<h3 class="anchored" data-anchor-id="弾力性測定モデル">6 弾力性測定モデル</h3>
<section id="交差価格弾力性による競合関係の測定" class="level4">
<h4 class="anchored" data-anchor-id="交差価格弾力性による競合関係の測定">6.1 交差価格弾力性による競合関係の測定</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;106</p>
<ul>
<li>（誤）売上を【新しい変数名】に“LY”，【計算式】に“log(売上)”と入力する。</li>
<li>（正）【新しい変数名】に“LY1”，【計算式】に“log(Y1)”と入力する。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-105" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-105">▶ Rコマンダーによって生成されたコード（p.&nbsp;105）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LY1 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(Y1))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX1 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(X1))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX2 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(X2))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(LY1<span class="sc">~</span>LX1<span class="sc">+</span>LX2, <span class="at">data=</span>Dataset)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-6" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-6">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LY1 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>Y1)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX1 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>X1)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX2 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>X2)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>RegModel_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(LY1 <span class="sc">~</span> LX1 <span class="sc">+</span> LX2, <span class="at">data =</span> Dataset)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_3)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = LY1 ~ LX1 + LX2, data = Dataset)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.52555 -0.13583 -0.05818  0.18692  0.38784 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.720      7.097   1.088    0.286    
LX1           -7.033      1.290  -5.451 9.08e-06 ***
LX2            6.504      1.187   5.479 8.42e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2199 on 27 degrees of freedom
Multiple R-squared:  0.6221,    Adjusted R-squared:  0.5941 
F-statistic: 22.22 on 2 and 27 DF,  p-value: 1.973e-06</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第6章-市場の発見と知覚マップ" class="level2">
<h2 class="anchored" data-anchor-id="第6章-市場の発見と知覚マップ">第6章 市場の発見と知覚マップ</h2>
<section id="知覚マップの作成" class="level3">
<h3 class="anchored" data-anchor-id="知覚マップの作成">4 知覚マップの作成</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
補足情報
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>本文には，表6.1は「消費者の評価調査データである」とされている。 しかし，同表は実際にはバイヤーに対する調査結果であり，詳細は以下のとおりである。</p>
【調査の方法】<br>
日本経済新聞社の「小売業調査」の対象になっているスーパー162社に対し，2010年12月22日に調査票をファクスで送付，2011年1月31日までに回収した。 回収数は92社，回収率は56.8%。 調査の実施・分析は日経リサーチが担当した。<br>
【表中の数字の見方】<br>
せんべい類を扱うバイヤーに5点満点でメーカーとブランドの総合評価をつけてもらい，その合計得点からランキングを作成した。 採点項目の数字は，メーカーまたはブランドを評価できると回答したバイヤーの割合（%）を表す。<br>

<div style="text-align: right;">
<p><strong>（出所：『日経MJ（流通新聞）』2011年2月13日，p.&nbsp;2）</strong></p>
</div>
</div>
</div>
</div>
</section>
<section id="rコマンダーでの手順" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーでの手順">5 Rコマンダーでの手順</h3>
<section id="rコマンダーによって生成されたコードp.-119" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-119">▶ Rコマンダーによって生成されたコード（p.&nbsp;119）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"clipboard"</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">"¥t"</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  .FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>キャンペーンイベント<span class="sc">+</span>パッケージデザイン<span class="sc">+</span>広告宣伝<span class="sc">+</span>素材栄養素<span class="sc">+</span>味, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.FA)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  Dataset <span class="ot">&lt;&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    F2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    F1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(F2<span class="sc">~</span>F1, <span class="at">regLine=</span><span class="cn">FALSE</span>, <span class="at">smooth=</span><span class="cn">FALSE</span>, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">'identify'</span>), <span class="at">boxplots=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">"マーケティング因子"</span>, <span class="at">ylab=</span><span class="st">"製品因子"</span>, <span class="at">data=</span>Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-7" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-7">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"clipboard"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"¥t"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> キャンペーンイベント <span class="sc">+</span> パッケージデザイン <span class="sc">+</span> 広告宣伝 <span class="sc">+</span> 素材栄養素 <span class="sc">+</span> 味,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="dv">2</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation =</span> <span class="st">"varimax"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scores =</span> <span class="st">"regression"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F1 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">1</span>]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F2 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">2</span>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Dataset) <span class="ot">&lt;-</span> Dataset<span class="sc">$</span>製品名</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  F2 <span class="sc">~</span> F1,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">regLine =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">'identify'</span>),</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">boxplots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"製品因子"</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~キャンペーンイベント + パッケージデザイン +     広告宣伝 + 素材栄養素 + 味, factors = 2, data = Dataset,     scores = "regression", rotation = "varimax", rownames = 1)

Uniquenesses:
キャンペーンイベント   パッケージデザイン             広告宣伝 
               0.158                0.318                0.005 
          素材栄養素                   味 
               0.407                0.005 

Loadings:
                     Factor1 Factor2
キャンペーンイベント 0.886   0.237  
パッケージデザイン   0.696   0.445  
広告宣伝             0.985   0.158  
素材栄養素           0.119   0.761  
味                   0.371   0.926  

               Factor1 Factor2
SS loadings      2.392   1.715
Proportion Var   0.478   0.343
Cumulative Var   0.478   0.821

Test of the hypothesis that 2 factors are sufficient.
The chi square statistic is 4.16 on 1 degree of freedom.
The p-value is 0.0415 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>1つの関数が長い場合は，引数のカンマの後で改行した方が見やすいため，コードを書く際に改行を入れるのが一般的である。 このとき，改行した行の先頭にはスペースを2つ入れる。</p>
<p>なお，クリップボードからデータを読むコードはOSによって異なる。 上に示したコードはWindowsの場合であり，macOSの場合，<code>Dataset &lt;- read.csv(pipe("pbpaste"), header = TRUE, sep = "\t")</code> とする。 タブを表す記号 <code>¥t</code> はWindowsの場合であり，macOSでは <code>\t</code> である。</p>
<p>また，Rコマンダーでは因子分析の結果を <code>.FA</code> に代入している。 <code>.</code> で始まる変数名はユーザーから隠す意図があり，この場面では意図通りに変数名を用いている（ただし，<code>local()</code> を使っているため，<code>.</code> で始まる必要はないのではあるが…）。 ここでは，ユーザーから隠す必然性はないため，<code>.FA</code> の代わりに <code>FA</code> という変数名を一般的なRコードで用いた。</p>
<p>さらに，本文の指示通りだと，図6.6の知覚マップには製品名ではなく，データフレーム <code>Dataset</code> の行番号が表示されることになる。 知覚マップ上に製品名を表示するには，<code>rownames(Dataset) &lt;- Dataset$製品名</code> を追加するか，あるいは，<code>read.csv()</code> の引数に <code>row.names = 1</code> を指定する必要がある，</p>
</section>
</section>
<section id="その他の問題" class="level3">
<h3 class="anchored" data-anchor-id="その他の問題">6 その他の問題</h3>
<section id="共通因子数の設定" class="level4">
<h4 class="anchored" data-anchor-id="共通因子数の設定">6.2 共通因子数の設定</h4>
<section id="rコマンダーによって生成されたコードp.-84-1" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84-1">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  .PC <span class="ot">&lt;-</span> <span class="fu">princomp</span>(<span class="sc">~</span>キャンペーンイベント<span class="sc">+</span>パッケージデザイン<span class="sc">+</span>広告宣伝<span class="sc">+</span>素材栄養素<span class="sc">+</span>味, <span class="at">cor=</span><span class="cn">TRUE</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Component loadings:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">unclass</span>(<span class="fu">loadings</span>(.PC)))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Component variances:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.PC<span class="sc">$</span>sd<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(.PC))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">screeplot</span>(.PC)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-8" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-8">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>PC <span class="ot">&lt;-</span> <span class="fu">princomp</span>( <span class="sc">~</span> キャンペーンイベント <span class="sc">+</span> パッケージデザイン <span class="sc">+</span> 広告宣伝 <span class="sc">+</span> 素材栄養素 <span class="sc">+</span> 味, <span class="at">cor =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> Dataset)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Component Loadings"</span> <span class="ot">=</span> <span class="fu">unclass</span>(<span class="fu">loadings</span>(PC)),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Component Variances"</span> <span class="ot">=</span> PC<span class="sc">$</span>sd<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Summary"</span> <span class="ot">=</span> <span class="fu">summary</span>(PC)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Component Loadings`
                        Comp.1     Comp.2     Comp.3     Comp.4     Comp.5
キャンペーンイベント 0.4714356  0.3769183  0.4597706  0.3613854  0.5419342
パッケージデザイン   0.4781955  0.1375293 -0.7804739 -0.2277185  0.3023567
広告宣伝             0.4871404  0.3588612  0.2664691 -0.4602804 -0.5924939
素材栄養素           0.3058296 -0.7333420  0.2987866 -0.4441059  0.2866606
味                   0.4671617 -0.4152667 -0.1385361  0.6391062 -0.4262212

$`Component Variances`
   Comp.1    Comp.2    Comp.3    Comp.4    Comp.5 
3.2672933 1.1601639 0.3588058 0.1815096 0.0322274 

$Summary
Importance of components:
                          Comp.1    Comp.2     Comp.3     Comp.4      Comp.5
Standard deviation     1.8075656 1.0771091 0.59900398 0.42603945 0.179519902
Proportion of Variance 0.6534587 0.2320328 0.07176115 0.03630192 0.006445479
Cumulative Proportion  0.6534587 0.8854914 0.95725260 0.99355452 1.000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(PC)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(PC, <span class="at">type =</span> <span class="st">"lines"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>スクリープロットを描く際，<code>screeplot(PC)</code> の引数として <code>type = "lines"</code> を指定すると折れ線グラフになり，こちらが一般的に用いられる。</p>
<p>また，主成分分析を使わずに相関行列の固有値を計算し，スクリープロットを描く方法もある。 因子分析の際にはこの方法が使われることがある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(Dataset[, <span class="fu">c</span>(<span class="st">"キャンペーンイベント"</span>, <span class="st">"パッケージデザイン"</span>, <span class="st">"広告宣伝"</span>, <span class="st">"素材栄養素"</span>, <span class="st">"味"</span>)])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ev <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cor_matrix)<span class="sc">$</span>values</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ev, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"スクリープロット"</span>, <span class="at">xlab =</span> <span class="st">"因子数"</span>, <span class="at">ylab =</span> <span class="st">"固有値"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>さらに，<code>psych</code> パッケージには簡単にスクリープロットを描く関数が用意されている。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(cor_matrix, <span class="at">n.obs =</span> <span class="fu">nrow</span>(Dataset), <span class="at">fa =</span> <span class="st">"fa"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel analysis suggests that the number of factors =  2  and the number of components =  NA </code></pre>
</div>
</div>
<p><code>fa.parallel()</code> は，単なる固有値のプロットではなく，実データの固有値とランダムデータから計算された固有値を比較するものである。</p>
</section>
</section>
</section>
<section id="サブマーケットと市場構造" class="level3">
<h3 class="anchored" data-anchor-id="サブマーケットと市場構造">7 サブマーケットと市場構造</h3>
<section id="rコマンダーによって生成されたコードp.-84-2" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84-2">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>HClust<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1<span class="sc">+</span>F2, Dataset)) , <span class="at">method=</span> <span class="st">"ward"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(HClust<span class="fl">.1</span>, <span class="at">main=</span> <span class="st">"Cluster Dendrogram for Solution HClust.1"</span>, <span class="at">xlab=</span> <span class="st">"Observation Number in Data Set Dataset"</span>, <span class="at">sub=</span><span class="st">"Method=ward; Distance=euclidian"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-9" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-9">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dist_1 <span class="ot">&lt;-</span> <span class="fu">dist</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)], <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>HClust_1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_1, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  HClust_1,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Cluster Dendrogram for Solution HClust_1"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Observation Number in Data Set Dataset"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"Method=ward.D2; Distance=euclidean"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ウォード法は <code>ward</code> や <code>ward.D</code> ではなく，<code>ward.D2</code> を指定する。 詳細な説明は関数 <code>hclust()</code> の<a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/hclust.html" target="_blank">ヘルプ</a>を参照のこと。</p>
<p>なお，知覚マップのところで <code>rownames(Dataset) &lt;- Dataset$製品名</code> を追加した場合は，図6.9とは異なり，デンドログラムに製品名が表示される。 製品名ではなく番号を使ってデンドログラムを描くには，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Dataset) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Dataset)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dist_1 <span class="ot">&lt;-</span> <span class="fu">dist</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)], <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>HClust_1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_1, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  HClust_1,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Cluster Dendrogram for Solution HClust_1"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Observation Number in Data Set Dataset"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"Method=ward.D2; Distance=euclidean"</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>以下は，図6.10の作図のためのコードである。 なお，クラスター分析に <code>ward.D2</code> を使用しているため，クラスター間距離が本書の記述とは異なる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(HClust_1, <span class="at">h =</span> <span class="dv">3</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">as.numeric</span>(Dataset<span class="sc">$</span>Cluster),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>, <span class="at">ylab =</span> <span class="st">"製品因子"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"クラスター間距離3"</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2, <span class="at">labels =</span> Dataset<span class="sc">$</span>製品名, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(Dataset<span class="sc">$</span>Cluster)) {</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dataEllipse</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    Dataset<span class="sc">$</span>F1[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k],</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    Dataset<span class="sc">$</span>F2[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k],</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> k, <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(HClust_1, <span class="at">h =</span> <span class="dv">1</span>))</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">as.numeric</span>(Dataset<span class="sc">$</span>Cluster),</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>, <span class="at">ylab =</span> <span class="st">"製品因子"</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"クラスター間距離1"</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2, <span class="at">labels =</span> Dataset<span class="sc">$</span>製品名, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(Dataset<span class="sc">$</span>Cluster)) {</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  cluster_data <span class="ot">&lt;-</span> Dataset[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)]</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(cluster_data) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dataEllipse</span>(</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>      cluster_data<span class="sc">$</span>F1,</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>      cluster_data<span class="sc">$</span>F2,</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> k, <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>dataEllipse()</code> はデータのばらつきをもとに楕円を描くため，2点しかないと警告が出て，直線が描かれる点に注意が必要である。</p>
<p>図を横に並べて表示する設定を行ったため，次のコードを実行してデフォルトの設定に戻しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="第7章-市場セグメンテーション" class="level2">
<h2 class="anchored" data-anchor-id="第7章-市場セグメンテーション">第7章 市場セグメンテーション</h2>
<section id="rコマンダーによる市場セグメンテーション" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる市場セグメンテーション">5 Rコマンダーによる市場セグメンテーション</h3>
<section id="因子分析" class="level4">
<h4 class="anchored" data-anchor-id="因子分析">5.2 因子分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;153</p>
<p>誤植というより，おそらく <code>Rcmdr</code> のバージョン違いにより，出力結果が異なっている可能性がある。図7.8，図7.9の通り実行しても，エラーになってしまう。以下の「手入力するコード」の部分を実行すると，本書の意図通りになるはずである（1行目のエラーは避けられない）。</p>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-149" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-149">▶ Rコマンダーによって生成されたコード（p.&nbsp;149）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  .FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>q1<span class="sc">+</span>q2<span class="sc">+</span>q3<span class="sc">+</span>q4<span class="sc">+</span>q5<span class="sc">+</span>q6<span class="sc">+</span>q7<span class="sc">+</span>q8<span class="sc">+</span>q9<span class="sc">+</span>q10<span class="sc">+</span>q11<span class="sc">+</span>q12<span class="sc">+</span>q13<span class="sc">+</span>q14<span class="sc">+</span>q15<span class="sc">+</span>q16<span class="sc">+</span>q17<span class="sc">+</span>q18<span class="sc">+</span>q19<span class="sc">+</span>q20<span class="sc">+</span>q21<span class="sc">+</span>q22<span class="sc">+</span>q23<span class="sc">+</span>q24<span class="sc">+</span>q25<span class="sc">+</span>q26<span class="sc">+</span>q27, <span class="at">factors=</span><span class="dv">4</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.FA)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  Dataset <span class="ot">&lt;&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    F4 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">4</span>]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    F3 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">3</span>]</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    F2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    F1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコード-1" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコード-1">▶ 手入力するコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.FA)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>.FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>q1<span class="sc">+</span>q2<span class="sc">+</span>q3<span class="sc">+</span>q4<span class="sc">+</span>q5<span class="sc">+</span>q6<span class="sc">+</span>q7<span class="sc">+</span>q8<span class="sc">+</span>q9<span class="sc">+</span>q10<span class="sc">+</span>q11<span class="sc">+</span>q12<span class="sc">+</span>q13<span class="sc">+</span>q14<span class="sc">+</span>q15<span class="sc">+</span>q16<span class="sc">+</span>q17<span class="sc">+</span>q18<span class="sc">+</span>q19<span class="sc">+</span>q20<span class="sc">+</span>q21<span class="sc">+</span>q22<span class="sc">+</span>q23<span class="sc">+</span>q24<span class="sc">+</span>q25<span class="sc">+</span>q26<span class="sc">+</span>q27, <span class="at">factors=</span><span class="dv">4</span>, <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>.FA</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA3 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">3</span>]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA4 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">4</span>]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(.FA,<span class="at">cutoff=</span><span class="dv">0</span>,<span class="at">sort=</span><span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-10" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-10">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> q1 <span class="sc">+</span> q2 <span class="sc">+</span> q3 <span class="sc">+</span> q4 <span class="sc">+</span> q5 <span class="sc">+</span> q6 <span class="sc">+</span> q7 <span class="sc">+</span> q8 <span class="sc">+</span> q9 <span class="sc">+</span> q10 <span class="sc">+</span> q11 <span class="sc">+</span> q12 <span class="sc">+</span> q13 <span class="sc">+</span> q14 <span class="sc">+</span> q15 <span class="sc">+</span> q16 <span class="sc">+</span> q17 <span class="sc">+</span> q18 <span class="sc">+</span> q19 <span class="sc">+</span> q20 <span class="sc">+</span> q21 <span class="sc">+</span> q22 <span class="sc">+</span> q23 <span class="sc">+</span> q24 <span class="sc">+</span> q25 <span class="sc">+</span> q26 <span class="sc">+</span> q27,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="dv">4</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation =</span> <span class="st">"varimax"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scores =</span> <span class="st">"regression"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9 + q10 +     q11 + q12 + q13 + q14 + q15 + q16 + q17 + q18 + q19 + q20 +     q21 + q22 + q23 + q24 + q25 + q26 + q27, factors = 4, data = Dataset,     scores = "regression", rotation = "varimax")

Uniquenesses:
   q1    q2    q3    q4    q5    q6    q7    q8    q9   q10   q11   q12   q13 
0.857 0.924 0.557 0.743 0.532 0.759 0.654 0.755 0.645 0.705 0.676 0.318 0.179 
  q14   q15   q16   q17   q18   q19   q20   q21   q22   q23   q24   q25   q26 
0.220 0.160 0.550 0.143 0.053 0.262 0.657 0.864 0.492 0.443 0.516 0.398 0.106 
  q27 
0.163 

Loadings:
    Factor1 Factor2 Factor3 Factor4
q1           0.251   0.261         
q2                   0.257         
q3           0.184   0.638         
q4           0.138   0.471         
q5           0.164   0.659         
q6           0.105   0.459   0.119 
q7   0.110   0.238   0.522         
q8   0.281   0.177   0.299   0.212 
q9   0.234   0.234   0.481   0.118 
q10  0.355   0.165   0.208   0.314 
q11  0.408   0.135   0.127   0.351 
q12  0.805           0.156         
q13  0.898                         
q14  0.869           0.100         
q15  0.901                   0.146 
q16  0.541           0.264   0.284 
q17  0.496           0.121   0.768 
q18  0.478                   0.839 
q19  0.803                   0.286 
q20  0.360   0.248   0.332   0.204 
q21  0.329   0.109           0.101 
q22          0.474   0.531         
q23          0.550   0.500         
q24  0.107   0.555   0.405         
q25          0.693   0.331         
q26  0.131   0.911   0.177   0.121 
q27  0.148   0.880   0.175         

               Factor1 Factor2 Factor3 Factor4
SS loadings      5.206   3.376   3.187   1.899
Proportion Var   0.193   0.125   0.118   0.070
Cumulative Var   0.193   0.318   0.436   0.506

Test of the hypothesis that 4 factors are sufficient.
The chi square statistic is 2835.86 on 249 degrees of freedom.
The p-value is 0 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F1 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">1</span>]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F2 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">2</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F3 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">3</span>]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F4 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">4</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA, <span class="at">cutoff =</span> <span class="dv">0</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9 + q10 +     q11 + q12 + q13 + q14 + q15 + q16 + q17 + q18 + q19 + q20 +     q21 + q22 + q23 + q24 + q25 + q26 + q27, factors = 4, data = Dataset,     scores = "regression", rotation = "varimax")

Uniquenesses:
   q1    q2    q3    q4    q5    q6    q7    q8    q9   q10   q11   q12   q13 
0.857 0.924 0.557 0.743 0.532 0.759 0.654 0.755 0.645 0.705 0.676 0.318 0.179 
  q14   q15   q16   q17   q18   q19   q20   q21   q22   q23   q24   q25   q26 
0.220 0.160 0.550 0.143 0.053 0.262 0.657 0.864 0.492 0.443 0.516 0.398 0.106 
  q27 
0.163 

Loadings:
    Factor1 Factor2 Factor3 Factor4
q12  0.805   0.045   0.156   0.090 
q13  0.898   0.041   0.078   0.089 
q14  0.869   0.086   0.100   0.080 
q15  0.901   0.068   0.045   0.146 
q16  0.541   0.083   0.264   0.284 
q19  0.803   0.066   0.085   0.286 
q23  0.065   0.550   0.500   0.020 
q24  0.107   0.555   0.405   0.025 
q25  0.081   0.693   0.331   0.071 
q26  0.131   0.911   0.177   0.121 
q27  0.148   0.880   0.175   0.099 
q3   0.010   0.184   0.638  -0.040 
q5   0.039   0.164   0.659   0.070 
q7   0.110   0.238   0.522   0.067 
q22  0.011   0.474   0.531   0.026 
q17  0.496   0.076   0.121   0.768 
q18  0.478   0.075   0.096   0.839 
q1   0.096   0.251   0.261   0.050 
q2   0.100   0.006   0.257   0.017 
q4   0.095   0.138   0.471   0.084 
q6   0.070   0.105   0.459   0.119 
q8   0.281   0.177   0.299   0.212 
q9   0.234   0.234   0.481   0.118 
q10  0.355   0.165   0.208   0.314 
q11  0.408   0.135   0.127   0.351 
q20  0.360   0.248   0.332   0.204 
q21  0.329   0.109   0.074   0.101 

               Factor1 Factor2 Factor3 Factor4
SS loadings      5.206   3.376   3.187   1.899
Proportion Var   0.193   0.125   0.118   0.070
Cumulative Var   0.193   0.318   0.436   0.506

Test of the hypothesis that 4 factors are sufficient.
The chi square statistic is 2835.86 on 249 degrees of freedom.
The p-value is 0 </code></pre>
</div>
</div>
</section>
</section>
<section id="クラスター分析" class="level4">
<h4 class="anchored" data-anchor-id="クラスター分析">5.3 クラスター分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;153</p>
<ul>
<li>（誤）入力としてF1〜F4（【変数（1つ以上選択）】）を指定し，クラスター数は4つとした。</li>
<li>（正）入力としてF1〜F4（【変数（1つ以上選択）】）を指定し，クラスター数は4つとした。さらに，【オプション】タブでは「データセットにクラスタを割り当てる」にチェックを入れる。最後に，【OK】をクリックする。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-153" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-153">▶ Rコマンダーによって生成されたコード（p.&nbsp;153）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>.cluster <span class="ot">&lt;-</span>  <span class="fu">KMeans</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset), <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">iter.max =</span> <span class="dv">10</span>, <span class="at">num.seeds =</span> <span class="dv">10</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>size <span class="co"># Cluster Sizes</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>centers <span class="co"># Cluster Centroids</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>withinss <span class="co"># Within Cluster Sum of Squares</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>tot.withinss <span class="co"># Total Within Sum of Squares</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>betweenss <span class="co"># Between Cluster Sum of Squares</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">princomp</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset)), <span class="at">xlabs =</span> <span class="fu">as.character</span>(.cluster<span class="sc">$</span>cluster))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>KMeans <span class="ot">&lt;-</span> <span class="fu">assignCluster</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset), Dataset, .cluster<span class="sc">$</span>cluster)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.cluster)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  .Table <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">table</span>(KMeans))</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">counts:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.Table)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">percentages:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>.Table<span class="sc">/</span><span class="fu">sum</span>(.Table), <span class="dv">2</span>))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071, <span class="at">pos=</span><span class="dv">17</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">numSummary</span>(Dataset[,<span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>), <span class="at">drop=</span><span class="cn">FALSE</span>], <span class="at">groups=</span>Dataset<span class="sc">$</span>KMeans, <span class="at">statistics=</span><span class="fu">c</span>(<span class="st">"mean"</span>), <span class="at">quantiles=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,<span class="dv">1</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-11" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-11">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)], <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">iter.max =</span> <span class="dv">10</span>, <span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cluster Sizes"</span> <span class="ot">=</span> cluster<span class="sc">$</span>size,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cluster Centroids"</span> <span class="ot">=</span> cluster<span class="sc">$</span>centers,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Within Cluster Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>withinss,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total Within Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>tot.withinss,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Between Cluster Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>betweenss</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Cluster Sizes`
[1] 192 202 514 327

$`Cluster Centroids`
          F1          F2         F3         F4
1 -0.5953486  0.21550094  0.2528594  1.4000022
2 -0.6171745 -1.40308357 -0.4617852 -0.5133626
3  0.8355935  0.01429324  0.0165523  0.1887794
4 -0.5826265  0.71773692  0.1107759 -0.8016323

$`Within Cluster Sum of Squares`
[1] 453.0426 647.8556 677.8658 696.1054

$`Total Within Sum of Squares`
[1] 2474.869

$`Between Cluster Sum of Squares`
[1] 1907.535</code></pre>
</div>
</div>
<p>主成分分析のバイプロットを描画し，データポイントを <em>K-means</em> 法によるクラスター分析の結果に基づいてラベル付けする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">princomp</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)]), <span class="at">xlabs =</span> <span class="fu">as.character</span>(cluster<span class="sc">$</span>cluster))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>K-means</em> 法によるクラスター分析の結果を確認する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>KMeans <span class="ot">&lt;-</span> cluster<span class="sc">$</span>cluster</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Dataset<span class="sc">$</span>KMeans)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4 
192 202 514 327 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(Dataset<span class="sc">$</span>KMeans)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1     2     3     4 
15.55 16.36 41.62 26.48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)], Dataset<span class="sc">$</span>KMeans)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">t</span>(<span class="fu">sapply</span>(split_data, colMeans)),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                     サンプルサイズ <span class="ot">=</span> <span class="fu">sapply</span>(split_data, nrow))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント         F1          F2         F3         F4 サンプルサイズ
1          1 -0.5953486  0.21550094  0.2528594  1.4000022            192
2          2 -0.6171745 -1.40308357 -0.4617852 -0.5133626            202
3          3  0.8355935  0.01429324  0.0165523  0.1887794            514
4          4 -0.5826265  0.71773692  0.1107759 -0.8016323            327</code></pre>
</div>
</div>
<p><code>print(result)</code> の出力結果の行の並び順が表7.9と異なっていても問題ない。</p>
</section>
</section>
<section id="セグメントのプロファイリング" class="level4">
<h4 class="anchored" data-anchor-id="セグメントのプロファイリング">5.4 セグメントのプロファイリング</h4>
<p>表7.10〜表7.13もRを使って作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(Dataset, Dataset<span class="sc">$</span>KMeans)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">table</span>(df<span class="sc">$</span>性別)), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>gender_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data), <span class="fu">t</span>(gender))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gender_table)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"男性"</span>, <span class="st">"女性"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>gender_table</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 男性 女性
1          1 60.4 39.6
2          2 69.3 30.7
3          3 65.4 34.6
4          4 70.3 29.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>           平均年齢 <span class="ot">=</span> <span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">round</span>(<span class="fu">mean</span>(df<span class="sc">$</span>年齢), <span class="dv">1</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 平均年齢
1          1     44.0
2          2     39.9
3          3     42.1
4          4     45.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>           投資経験年数 <span class="ot">=</span> <span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">round</span>(<span class="fu">mean</span>(df<span class="sc">$</span>投資経験年数), <span class="dv">1</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 投資経験年数
1          1          8.3
2          2          6.3
3          3          7.3
4          4          9.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>transaction <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">table</span>(df<span class="sc">$</span>取引形態)), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>transaction_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data), <span class="fu">t</span>(transaction))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(transaction_table)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"対面取引"</span>, <span class="st">"インターネット取引"</span>, <span class="st">"対面とインターネットの併用"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>transaction_table</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 対面取引 インターネット取引 対面とインターネットの併用
1          1     20.3               64.1                       15.6
2          2     14.9               78.2                        6.9
3          3     15.8               72.0                       12.3
4          4     13.1               74.9                       11.9</code></pre>
</div>
</div>
<p>さらに，図7.4もRを使って作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(Dataset<span class="sc">$</span>性別)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gender_counts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"男性"</span>, <span class="st">"女性"</span>) </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(gender_counts)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>年齢区分 <span class="ot">&lt;-</span> <span class="fu">cut</span>(Dataset<span class="sc">$</span>年齢, </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">20</span>, <span class="fu">max</span>(Dataset<span class="sc">$</span>年齢) <span class="sc">+</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">5</span>), </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(Dataset<span class="sc">$</span>年齢区分), <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">las =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>細かい調整が必要な場合は，自分でカスタマイズ可能である。 例えば，棒グラフの上に数値を表示したい場合は，次のようにする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>bar_positions <span class="ot">&lt;-</span> <span class="fu">barplot</span>(gender_counts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(gender_counts) <span class="sc">*</span> <span class="fl">1.2</span>), <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">alpha.f =</span> .<span class="dv">5</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(bar_positions, gender_counts, <span class="at">labels =</span> gender_counts, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="第8章-製品開発" class="level2">
<h2 class="anchored" data-anchor-id="第8章-製品開発">第8章 製品開発</h2>
<section id="コンジョイント分析" class="level3">
<h3 class="anchored" data-anchor-id="コンジョイント分析">4 コンジョイント分析</h3>
<section id="個人分析rコマンダーによる分析" class="level4">
<h4 class="anchored" data-anchor-id="個人分析rコマンダーによる分析">4.2 個人分析：Rコマンダーによる分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;173</p>
<ul>
<li>（誤）日本語処理の関係で先頭に <code>X</code> が付いている</li>
<li>（正）デフォルトでは，数字で始まる列名の先頭に <code>X</code> が付く</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-172" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-172">▶ Rコマンダーによって生成されたコード（p.&nbsp;172）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用<span class="sc">~</span>X2年<span class="sc">+</span>X4時間<span class="sc">+</span>X6時間<span class="sc">+</span>シルバー<span class="sc">+</span>赤, <span class="at">data=</span>Dataset)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-12" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-12">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> X2年 <span class="sc">+</span> X4時間 <span class="sc">+</span> X6時間 <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ X2年 + X4時間 + X6時間 + シルバー + 
    赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0556 -0.8889  0.4167  1.0278  2.4444 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -0.5556     1.0199  -0.545  0.59591    
X2年          6.7778     0.8327   8.139 3.15e-06 ***
X4時間        2.5000     1.0199   2.451  0.03052 *  
X6時間        3.5000     1.0199   3.432  0.00497 ** 
シルバー      6.3333     1.0199   6.210 4.52e-05 ***
赤            7.6667     1.0199   7.517 7.07e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.766 on 12 degrees of freedom
Multiple R-squared:  0.9227,    Adjusted R-squared:  0.8905 
F-statistic: 28.65 on 5 and 12 DF,  p-value: 2.819e-06</code></pre>
</div>
</div>
<p><code>conjoint1.txt</code> はタブ区切りテキストのように見えるが，Rコマンダーで「フィールドの区切り記号」を「タブ」にするとエラーが出て読み込めない。 「空白」にすると読み込める。 よく見ると，<code>conjoint1.txt</code> のヘッダーのみスペース区切りになっている。 このようなデータは珍しい。</p>
<p>なお，数字で始まる列名の先頭に <code>X</code> を付けたくない場合は，<code>read.table()</code> の引数に <code>check.names = FALSE</code> を指定すればよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   カードNo. 6時間 4時間 2年 赤 シルバー 選好順位 全体効用
1          1     1     0   0  1        0        7       12
2          2     1     0   0  0        1        9       10
3          3     1     0   0  0        0       17        2
4          4     1     0   1  1        0        1       18
5          5     1     0   1  0        1        6       13
6          6     1     0   1  0        0        8       11
7          7     0     1   0  1        0       10        9
8          8     0     1   0  0        1       12        7
9          9     0     1   0  0        0       16        3
10        10     0     1   1  1        0        2       17
11        11     0     1   1  0        1        3       16
12        12     0     1   1  0        0       11        8
13        13     0     0   0  1        0       14        5
14        14     0     0   0  0        1       13        6
15        15     0     0   0  0        0       18        1
16        16     0     0   1  1        0        5       14
17        17     0     0   1  0        1        4       15
18        18     0     0   1  0        0       15        4</code></pre>
</div>
</div>
<p>ただし，<code>lm()</code> を実行するときには，列名をバッククオート <code>`</code> で括る必要がある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> <span class="st">`</span><span class="at">2年</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">4時間</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">6時間</span><span class="st">`</span> <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ `2年` + `4時間` + `6時間` + 
    シルバー + 赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0556 -0.8889  0.4167  1.0278  2.4444 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -0.5556     1.0199  -0.545  0.59591    
`2年`         6.7778     0.8327   8.139 3.15e-06 ***
`4時間`       2.5000     1.0199   2.451  0.03052 *  
`6時間`       3.5000     1.0199   3.432  0.00497 ** 
シルバー      6.3333     1.0199   6.210 4.52e-05 ***
赤            7.6667     1.0199   7.517 7.07e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.766 on 12 degrees of freedom
Multiple R-squared:  0.9227,    Adjusted R-squared:  0.8905 
F-statistic: 28.65 on 5 and 12 DF,  p-value: 2.819e-06</code></pre>
</div>
</div>
<p>実際に自分でデータを扱う際には，こうしたことを考慮しながら，列名をどうするかを決める必要がある。</p>
</section>
</section>
</section>
<section id="直交表利用によるコンジョイント分析" class="level3">
<h3 class="anchored" data-anchor-id="直交表利用によるコンジョイント分析">5 直交表利用によるコンジョイント分析</h3>
<section id="集計分析rコマンダーによる分析" class="level4">
<h4 class="anchored" data-anchor-id="集計分析rコマンダーによる分析">5.3 集計分析：Rコマンダーによる分析</h4>
<section id="rコマンダーによって生成されたコードp.-179" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-179">▶ Rコマンダーによって生成されたコード（p.&nbsp;179）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用<span class="sc">~</span>X2年<span class="sc">+</span>X4時間<span class="sc">+</span>X6時間<span class="sc">+</span>シルバー<span class="sc">+</span>赤, <span class="at">data=</span>Dataset)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-13" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-13">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>RegModel_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> X2年 <span class="sc">+</span> X4時間 <span class="sc">+</span> X6時間 <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ X2年 + X4時間 + X6時間 + シルバー + 
    赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7667 -0.6875 -0.1500  0.5833  2.7000 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.1667     0.3193   0.522 0.603020    
X2年          2.2500     0.2560   8.790 1.57e-13 ***
X4時間        1.1333     0.2956   3.834 0.000243 ***
X6時間        0.3667     0.2956   1.240 0.218245    
シルバー      3.9000     0.2956  13.194  &lt; 2e-16 ***
赤            4.6000     0.2956  15.563  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.145 on 84 degrees of freedom
Multiple R-squared:  0.8165,    Adjusted R-squared:  0.8056 
F-statistic: 74.77 on 5 and 84 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><code>conjoint2.txt</code> も <code>conjoint1.txt</code> と同様に変わったルール（ヘッダーのみスペース区切りで，他はタブ区切り）でデータが記述されている。</p>
</section>
</section>
</section>
</section>
<section id="第9章-新製品の普及" class="level2">
<h2 class="anchored" data-anchor-id="第9章-新製品の普及">第9章 新製品の普及</h2>
<section id="rコマンダーによる新製品普及構造の分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる新製品普及構造の分析">6 Rコマンダーによる新製品普及構造の分析</h3>
<section id="回帰分析" class="level4">
<h4 class="anchored" data-anchor-id="回帰分析">6.1 回帰分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;202，表9.2</p>
<ul>
<li>（誤）5000e+03</li>
<li>（正）5.000e+03</li>
</ul>
<p>p.&nbsp;202，表9.2</p>
<ul>
<li>（誤）予測値が追加される。本書の検証は</li>
<li>（正）予測値が追加される。その後，【グラフ】⇒【折れ線グラフ…】でコマンドボックスを立ち上げて，【x 変数（1つ選択）】から「時点」を選択し，【y 変数（2つ以上選択）】から「購買者数」と「予測」を選択した後で，【OK】をクリックする。本書の検証は</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-199" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-199">▶ Rコマンダーによって生成されたコード（p.&nbsp;199）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>Dataset2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(Dataset, <span class="at">subset=</span>時点<span class="sc">&lt;</span><span class="dv">11</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(購買者数<span class="sc">~</span>一期前累積購買者数<span class="sc">+</span>一期前累積購買者数の二乗, <span class="at">data=</span>Dataset2)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコード-2" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコード-2">▶ 手入力するコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">5.000e+03</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">9.983e-02</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.994e-06</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> (<span class="sc">-</span> b <span class="sc">-</span> <span class="fu">sqrt</span>(b<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> a <span class="sc">*</span> c)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> c)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> a <span class="sc">/</span> m</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> p <span class="sc">+</span> b</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50021.69</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09995664</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>q</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1997866</code></pre>
</div>
</div>
<p>本書の指示通りに計算すると，<code>p</code> と <code>q</code> は小数第4位で四捨五入すれば正しい値が計算できたことになる。 ただし，<code>m</code> については四捨五入したとしても値が一致しない。</p>
</section>
<section id="一般的なrコード-14" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-14">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>Dataset2 <span class="ot">&lt;-</span> Dataset[Dataset<span class="sc">$</span>時点 <span class="sc">&lt;</span> <span class="dv">11</span>, ]</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(購買者数 <span class="sc">~</span> 一期前累積購買者数 <span class="sc">+</span> 一期前累積購買者数 <span class="sc">^</span> <span class="dv">2</span>, <span class="at">data =</span> Dataset2)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 購買者数 ~ 一期前累積購買者数 + I(一期前累積購買者数^2), 
    data = Dataset2)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.8250 -1.4318 -0.3015  1.5493  5.1581 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              5.000e+03  2.453e+00  2038.4  &lt; 2e-16 ***
一期前累積購買者数       9.983e-02  2.708e-04   368.7 2.85e-16 ***
I(一期前累積購買者数^2) -3.994e-06  6.104e-09  -654.3  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.051 on 7 degrees of freedom
Multiple R-squared:      1, Adjusted R-squared:      1 
F-statistic: 7.471e+05 on 2 and 7 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>このデータについて，「累積購買者数」，「一期前累積購買者数」，「一期前累積購買者数の二乗」の3つの列がどこで計算されたのかが気になる。 通常は，次のデータが手元にあると考えるのが理に適っているだろう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> Dataset[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   時点 購買者数
1     1     4998
2     2     5398
3     3     5611
4     4     5574
5     5     5292
6     6     4798
7     7     4157
8     8     3445
9     9     2762
10   10     2141
11   11     1609
12   12     1199
13   13      871
14   14      629
15   15      448</code></pre>
</div>
</div>
<p>このデータから，必要なデータを作成可能である。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>累積購買者数 <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(Dataset<span class="sc">$</span>購買者数)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>一期前累積購買者数 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">head</span>(Dataset<span class="sc">$</span>累積購買者数, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>一期前累積購買者数の二乗 <span class="ot">&lt;-</span> Dataset<span class="sc">$</span>一期前累積購買者数 <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   時点 購買者数 累積購買者数 一期前累積購買者数 一期前累積購買者数の二乗
1     1     4998         4998                  0                        0
2     2     5398        10396               4998                 24980004
3     3     5611        16007              10396                108076816
4     4     5574        21581              16007                256224049
5     5     5292        26873              21581                465739561
6     6     4798        31671              26873                722158129
7     7     4157        35828              31671               1003052241
8     8     3445        39273              35828               1283645584
9     9     2762        42035              39273               1542368529
10   10     2141        44176              42035               1766941225
11   11     1609        45785              44176               1951518976
12   12     1199        46984              45785               2096266225
13   13      871        47855              46984               2207496256
14   14      629        48484              47855               2290101025
15   15      448        48932              48484               2350698256</code></pre>
</div>
</div>
<p>続いて，<code>m</code>，<code>p</code>，<code>q</code> の計算は，<code>lm()</code> の結果を用いて計算することができる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">coef</span>(RegModel_1)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> x[<span class="dv">2</span>]</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> x[<span class="dv">3</span>]</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> (<span class="sc">-</span> b <span class="sc">-</span> <span class="fu">sqrt</span>(b<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> a <span class="sc">*</span> c)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> c)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> a <span class="sc">/</span> m</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> p <span class="sc">+</span> b</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50022.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09994712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>q</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1997775</code></pre>
</div>
</div>
<p>今度は，本書と同じ値が計算された。 続いて，図9.12を作成する。</p>
</section>
<section id="rコマンダーによって生成されたコードp.-203" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-203">▶ Rコマンダーによって生成されたコード（p.&nbsp;203）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fl">5.000e+03</span><span class="sc">+</span>一期前累積購買者数<span class="sc">*</span><span class="fl">9.983e-02</span><span class="sc">+</span>一期前累積購買者数の二乗<span class="sc">*</span>(<span class="sc">-</span><span class="fl">3.994e-06</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">lineplot</span>(時点, 購買者数, 予測))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-15" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-15">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, Dataset[, <span class="fu">c</span>(<span class="st">"一期前累積購買者数"</span>, <span class="st">"一期前累積購買者数の二乗"</span>)])) <span class="sc">%*%</span> <span class="fu">coef</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このとき， <code>predict()</code> 関数を使うと便利である。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">predict</span>(RegModel_1, <span class="at">newdata =</span> Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rコマンダーでは，<code>RcmdrMisc</code> パッケージの関数 <code>lineplot()</code> で作図しているので，Rコマンダーを使わない場合はこの関数は使えない。 代わりに，次のコードで図を作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>購買者数, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">c</span>(Dataset<span class="sc">$</span>購買者数, Dataset<span class="sc">$</span>予測)),</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"時点"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"購買者数と予測値の推移"</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>予測, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>購買者数, <span class="at">labels =</span> <span class="st">"1"</span>, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">offset =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>予測, <span class="at">labels =</span> <span class="st">"2"</span>, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">offset =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"購買者数"</span>, <span class="st">"予測"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>図9.13にあるような累積購入者数のグラフを作成するには，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>累積購買者数, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(Dataset<span class="sc">$</span>累積購買者数)), <span class="at">xlab =</span> <span class="st">"時点"</span>, <span class="at">ylab =</span> <span class="st">"累積購買者数"</span>, <span class="at">main =</span> <span class="st">"普及パターン"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第10章-顧客の管理" class="level2">
<h2 class="anchored" data-anchor-id="第10章-顧客の管理">第10章 顧客の管理</h2>
<section id="rコマンダーによる顧客管理のための分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる顧客管理のための分析">4 Rコマンダーによる顧客管理のための分析</h3>
<section id="rfm分析" class="level4">
<h4 class="anchored" data-anchor-id="rfm分析">4.1 RFM分析</h4>
<section id="rコマンダーによって生成されたコードp.-220" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-220">▶ Rコマンダーによって生成されたコード（p.&nbsp;220）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  M_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(M, <span class="st">'0:49999="M_Rank1"; 50000:99999="M_Rank2"; 100000:299999="M_Rank3"; 300000:499999="M_Rank4"; else="M_Rank5"'</span>, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">as.factor=</span><span class="cn">TRUE</span>, <span class="at">to.value=</span><span class="st">"="</span>, <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  F_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(F, <span class="st">'1="F_Rank1"; 2="F_Rank2"; 3:9="F_Rank3"; 10:29="F_Rank4"; else="F_Rank5";'</span>, <span class="at">as.factor=</span><span class="cn">TRUE</span>, <span class="at">to.value=</span><span class="st">"="</span>, </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  R_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(R, <span class="st">'0:30="R_Rank5"; 31:60="R_Rank4"; 61:90="R_Rank3"; 91:180="R_Rank2"; else="R_Rank1"; ;'</span>, <span class="at">as.factor=</span><span class="cn">TRUE</span>, </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">to.value=</span><span class="st">"="</span>, <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(F <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TH.data, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind, <span class="at">pos=</span><span class="dv">21</span>)</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>AnovaModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">aov</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset)</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AnovaModel<span class="fl">.2</span>)</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">numSummary</span>(M, <span class="at">groups=</span>R_Rank, <span class="at">statistics=</span><span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>)))</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  .Pairs <span class="ot">&lt;-</span> <span class="fu">glht</span>(AnovaModel<span class="fl">.2</span>, <span class="at">linfct =</span> <span class="fu">mcp</span>(<span class="at">R_Rank =</span> <span class="st">"Tukey"</span>))</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(.Pairs)) <span class="co"># pairwise tests</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">confint</span>(.Pairs, <span class="at">level=</span><span class="fl">0.95</span>)) <span class="co"># confidence intervals</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">cld</span>(.Pairs, <span class="at">level=</span><span class="fl">0.05</span>)) <span class="co"># compact letter display</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  old.oma <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">confint</span>(.Pairs))</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(old.oma)</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-16" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-16">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>M_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>M,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">49999</span>, <span class="dv">99999</span>, <span class="dv">299999</span>, <span class="dv">499999</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"M_Rank1"</span>, <span class="st">"M_Rank2"</span>, <span class="st">"M_Rank3"</span>, <span class="st">"M_Rank4"</span>, <span class="st">"M_Rank5"</span>),</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">29</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"F_Rank1"</span>, <span class="st">"F_Rank2"</span>, <span class="st">"F_Rank3"</span>, <span class="st">"F_Rank4"</span>, <span class="st">"F_Rank5"</span>),</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>R_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>R,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"R_Rank5"</span>, <span class="st">"R_Rank4"</span>, <span class="st">"R_Rank3"</span>, <span class="st">"R_Rank2"</span>, <span class="st">"R_Rank1"</span>),</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>R_Rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(Dataset<span class="sc">$</span>R_Rank, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"R_Rank1"</span>, <span class="st">"R_Rank2"</span>, <span class="st">"R_Rank3"</span>, <span class="st">"R_Rank4"</span>, <span class="st">"R_Rank5"</span>))</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(F <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>AnovaModel_2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset)</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AnovaModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "111"  "233"  "387"  "635"  "654"  "1325" "1379" "1743" "538"  "1770"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              Df    Sum Sq   Mean Sq F value Pr(&gt;F)    
R_Rank         4 2.054e+12 5.134e+11   20.78 &lt;2e-16 ***
Residuals   1995 4.929e+13 2.471e+10                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Rコマンダーでは，<code>RcmdrMisc</code> パッケージの関数 <code>lineplot()</code> でTukeyのHSD検定を行っているので，Rコマンダーを使わない場合はこの関数は使えない。 代わりに，次のコードで図を作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>mean_values <span class="ot">&lt;-</span> <span class="fu">tapply</span>(Dataset<span class="sc">$</span>M, Dataset<span class="sc">$</span>R_Rank, mean)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>sd_values <span class="ot">&lt;-</span> <span class="fu">tapply</span>(Dataset<span class="sc">$</span>M, Dataset<span class="sc">$</span>R_Rank, sd)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">R_Rank =</span> <span class="fu">names</span>(mean_values), <span class="at">mean =</span> mean_values, <span class="at">sd =</span> sd_values)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         R_Rank     mean       sd
R_Rank1 R_Rank1 209930.0 151138.6
R_Rank2 R_Rank2 225057.9 152059.6
R_Rank3 R_Rank3 247259.6 152568.9
R_Rank4 R_Rank4 281963.5 156606.0
R_Rank5 R_Rank5 306564.1 161327.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Tukey_Result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(AnovaModel_2, <span class="st">"R_Rank"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>Tukey_Result</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = M ~ R_Rank, data = Dataset)

$R_Rank
                    diff        lwr       upr     p adj
R_Rank2-R_Rank1 15127.90 -42195.595  72451.39 0.9518249
R_Rank3-R_Rank1 37329.65 -25238.093  99897.40 0.4789160
R_Rank4-R_Rank1 72033.53  17020.899 127046.17 0.0032962
R_Rank5-R_Rank1 96634.17  41964.001 151304.34 0.0000148
R_Rank3-R_Rank2 22201.75 -19061.973  63465.48 0.5828362
R_Rank4-R_Rank2 56905.63  28368.600  85442.67 0.0000006
R_Rank5-R_Rank2 81506.27  53635.143 109377.40 0.0000000
R_Rank4-R_Rank3 34703.88  -3284.302  72692.06 0.0922935
R_Rank5-R_Rank3 59304.52  21813.992  96795.04 0.0001599
R_Rank5-R_Rank4 24600.64   1858.459  47342.81 0.0263635</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Tukey_Result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>tukey_pvalues <span class="ot">&lt;-</span> Tukey_Result<span class="sc">$</span>R_Rank[, <span class="st">"p adj"</span>]</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>cld_results <span class="ot">&lt;-</span> <span class="fu">multcompLetters</span>(tukey_pvalues)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>cld_results</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R_Rank2 R_Rank3 R_Rank4 R_Rank5 R_Rank1 
    "a"    "ab"     "b"     "c"     "a" </code></pre>
</div>
</div>
</section>
</section>
<section id="ロジスティック回帰分析" class="level4">
<h4 class="anchored" data-anchor-id="ロジスティック回帰分析">4.2 ロジスティック回帰分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;202，表9.2</p>
<ul>
<li>（誤）一般化線形モデル</li>
<li>（正）一般化線型モデル</li>
</ul>
<p>これはRコマンダーの翻訳ミスであろう。</p>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-220-1" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-220-1">▶ Rコマンダーによって生成されたコード（p.&nbsp;220）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(DM <span class="sc">~</span> <span class="fu">log</span>(M)<span class="sc">+</span><span class="fu">log</span>(F)<span class="sc">+</span><span class="fu">log</span>(R), <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>Dataset)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.3</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.3</span>))  <span class="co"># Exponentiated coefficients ("odds ratios")</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-17" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-17">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>DM <span class="ot">&lt;-</span> <span class="fu">factor</span>(Dataset<span class="sc">$</span>DM, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset$DM01 &lt;- ifelse(Dataset$DM == "yes", 1, 0)</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(DM <span class="sc">~</span> <span class="fu">log</span>(M) <span class="sc">+</span> <span class="fu">log</span>(F) <span class="sc">+</span> <span class="fu">log</span>(R), <span class="at">family =</span> <span class="fu">binomial</span>(logit), <span class="at">data =</span> Dataset)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = DM ~ log(M) + log(F) + log(R), family = binomial(logit), 
    data = Dataset)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -11.94177    1.05258 -11.345  &lt; 2e-16 ***
log(M)        0.79688    0.08450   9.431  &lt; 2e-16 ***
log(F)        1.29098    0.09949  12.977  &lt; 2e-16 ***
log(R)       -0.47586    0.06170  -7.712 1.24e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2614.8  on 1999  degrees of freedom
Residual deviance: 1873.8  on 1996  degrees of freedom
AIC: 1881.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.3</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)       log(M)       log(F)       log(R) 
6.512621e-06 2.218618e+00 3.636348e+00 6.213502e-01 </code></pre>
</div>
</div>
<p>Rコマンダーは，どうやら内部で <code>DM</code> 列をファクターに変換しているようである。 実際には，<code>factor()</code> を適用するか，<code>ifelse()</code> でダミー変数に変換すればよい。 ダミー変数に変換した場合は，値も変わってしまうため，列名を変更することを推奨する。</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "コピーしました");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "コピーしました");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>