<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rコマンダーを使わずに『現代マーケティング・リサーチ』を読む</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-e789b2bbe5e3b72425b62d406c7e8d6a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="index_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="index_files/libs/viz-1.8.2/viz.js"></script>
<link href="index_files/libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="index_files/libs/grViz-binding-1.0.11/grViz.js"></script>


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Rコマンダーを使わずに『現代マーケティング・リサーチ』を読む</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#第3章-サンプリング" id="toc-第3章-サンプリング" class="nav-link active" data-scroll-target="#第3章-サンプリング">第3章 サンプリング</a>
  <ul>
  <li><a href="#単純無作為サンプリング" id="toc-単純無作為サンプリング" class="nav-link" data-scroll-target="#単純無作為サンプリング">4 単純無作為サンプリング</a>
  <ul class="collapse">
  <li><a href="#rコマンダーによる乱数表作成" id="toc-rコマンダーによる乱数表作成" class="nav-link" data-scroll-target="#rコマンダーによる乱数表作成">4.1 Rコマンダーによる乱数表作成</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第5章-市場反応分析i" id="toc-第5章-市場反応分析i" class="nav-link" data-scroll-target="#第5章-市場反応分析i">第5章 市場反応分析（I）</a>
  <ul>
  <li><a href="#相関分析" id="toc-相関分析" class="nav-link" data-scroll-target="#相関分析">3 相関分析</a>
  <ul class="collapse">
  <li><a href="#売上と価格のデータ散布図の作成" id="toc-売上と価格のデータ散布図の作成" class="nav-link" data-scroll-target="#売上と価格のデータ散布図の作成">3.2 売上と価格のデータ：散布図の作成</a></li>
  <li><a href="#売上と価格に相関はあるか標本相関係数の検定" id="toc-売上と価格に相関はあるか標本相関係数の検定" class="nav-link" data-scroll-target="#売上と価格に相関はあるか標本相関係数の検定">3.3 売上と価格に相関はあるか：標本相関係数の検定</a></li>
  </ul></li>
  <li><a href="#売上と価格の市場反応分析回帰モデル" id="toc-売上と価格の市場反応分析回帰モデル" class="nav-link" data-scroll-target="#売上と価格の市場反応分析回帰モデル">4 売上と価格の市場反応分析：回帰モデル</a>
  <ul class="collapse">
  <li><a href="#価格反応係数推定値の精度と信頼区間" id="toc-価格反応係数推定値の精度と信頼区間" class="nav-link" data-scroll-target="#価格反応係数推定値の精度と信頼区間">4.1 価格反応係数推定値の精度と信頼区間</a></li>
  </ul></li>
  <li><a href="#複数の説明変数を持つ市場反応分析重回帰モデル" id="toc-複数の説明変数を持つ市場反応分析重回帰モデル" class="nav-link" data-scroll-target="#複数の説明変数を持つ市場反応分析重回帰モデル">5 複数の説明変数を持つ市場反応分析：重回帰モデル</a>
  <ul class="collapse">
  <li><a href="#価格と販売促進の効果" id="toc-価格と販売促進の効果" class="nav-link" data-scroll-target="#価格と販売促進の効果">5.1 価格と販売促進の効果</a></li>
  </ul></li>
  <li><a href="#弾力性測定モデル" id="toc-弾力性測定モデル" class="nav-link" data-scroll-target="#弾力性測定モデル">6 弾力性測定モデル</a>
  <ul class="collapse">
  <li><a href="#交差価格弾力性による競合関係の測定" id="toc-交差価格弾力性による競合関係の測定" class="nav-link" data-scroll-target="#交差価格弾力性による競合関係の測定">6.1 交差価格弾力性による競合関係の測定</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第6章-市場の発見と知覚マップ" id="toc-第6章-市場の発見と知覚マップ" class="nav-link" data-scroll-target="#第6章-市場の発見と知覚マップ">第6章 市場の発見と知覚マップ</a>
  <ul>
  <li><a href="#知覚マップの作成" id="toc-知覚マップの作成" class="nav-link" data-scroll-target="#知覚マップの作成">4 知覚マップの作成</a></li>
  <li><a href="#rコマンダーでの手順" id="toc-rコマンダーでの手順" class="nav-link" data-scroll-target="#rコマンダーでの手順">5 Rコマンダーでの手順</a></li>
  <li><a href="#その他の問題" id="toc-その他の問題" class="nav-link" data-scroll-target="#その他の問題">6 その他の問題</a>
  <ul class="collapse">
  <li><a href="#共通因子数の設定" id="toc-共通因子数の設定" class="nav-link" data-scroll-target="#共通因子数の設定">6.2 共通因子数の設定</a></li>
  </ul></li>
  <li><a href="#サブマーケットと市場構造" id="toc-サブマーケットと市場構造" class="nav-link" data-scroll-target="#サブマーケットと市場構造">7 サブマーケットと市場構造</a></li>
  </ul></li>
  <li><a href="#第7章-市場セグメンテーション" id="toc-第7章-市場セグメンテーション" class="nav-link" data-scroll-target="#第7章-市場セグメンテーション">第7章 市場セグメンテーション</a>
  <ul>
  <li><a href="#rコマンダーによる市場セグメンテーション" id="toc-rコマンダーによる市場セグメンテーション" class="nav-link" data-scroll-target="#rコマンダーによる市場セグメンテーション">5 Rコマンダーによる市場セグメンテーション</a>
  <ul class="collapse">
  <li><a href="#因子分析" id="toc-因子分析" class="nav-link" data-scroll-target="#因子分析">5.2 因子分析</a></li>
  <li><a href="#クラスター分析" id="toc-クラスター分析" class="nav-link" data-scroll-target="#クラスター分析">5.3 クラスター分析</a></li>
  <li><a href="#セグメントのプロファイリング" id="toc-セグメントのプロファイリング" class="nav-link" data-scroll-target="#セグメントのプロファイリング">5.4 セグメントのプロファイリング</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第8章-製品開発" id="toc-第8章-製品開発" class="nav-link" data-scroll-target="#第8章-製品開発">第8章 製品開発</a>
  <ul>
  <li><a href="#コンジョイント分析" id="toc-コンジョイント分析" class="nav-link" data-scroll-target="#コンジョイント分析">4 コンジョイント分析</a>
  <ul class="collapse">
  <li><a href="#個人分析rコマンダーによる分析" id="toc-個人分析rコマンダーによる分析" class="nav-link" data-scroll-target="#個人分析rコマンダーによる分析">4.2 個人分析：Rコマンダーによる分析</a></li>
  </ul></li>
  <li><a href="#直交表利用によるコンジョイント分析" id="toc-直交表利用によるコンジョイント分析" class="nav-link" data-scroll-target="#直交表利用によるコンジョイント分析">5 直交表利用によるコンジョイント分析</a>
  <ul class="collapse">
  <li><a href="#集計分析rコマンダーによる分析" id="toc-集計分析rコマンダーによる分析" class="nav-link" data-scroll-target="#集計分析rコマンダーによる分析">5.3 集計分析：Rコマンダーによる分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第9章-新製品の普及" id="toc-第9章-新製品の普及" class="nav-link" data-scroll-target="#第9章-新製品の普及">第9章 新製品の普及</a>
  <ul>
  <li><a href="#rコマンダーによる新製品普及構造の分析" id="toc-rコマンダーによる新製品普及構造の分析" class="nav-link" data-scroll-target="#rコマンダーによる新製品普及構造の分析">6 Rコマンダーによる新製品普及構造の分析</a>
  <ul class="collapse">
  <li><a href="#回帰分析" id="toc-回帰分析" class="nav-link" data-scroll-target="#回帰分析">6.1 回帰分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第10章-顧客の管理" id="toc-第10章-顧客の管理" class="nav-link" data-scroll-target="#第10章-顧客の管理">第10章 顧客の管理</a>
  <ul>
  <li><a href="#rコマンダーによる顧客管理のための分析" id="toc-rコマンダーによる顧客管理のための分析" class="nav-link" data-scroll-target="#rコマンダーによる顧客管理のための分析">4 Rコマンダーによる顧客管理のための分析</a>
  <ul class="collapse">
  <li><a href="#rfm分析" id="toc-rfm分析" class="nav-link" data-scroll-target="#rfm分析">4.1 RFM分析</a></li>
  <li><a href="#ロジスティック回帰分析" id="toc-ロジスティック回帰分析" class="nav-link" data-scroll-target="#ロジスティック回帰分析">4.2 ロジスティック回帰分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第11章-市場反応分析ii" id="toc-第11章-市場反応分析ii" class="nav-link" data-scroll-target="#第11章-市場反応分析ii">第11章 市場反応分析（II）</a>
  <ul>
  <li><a href="#rコマンダーによる分析" id="toc-rコマンダーによる分析" class="nav-link" data-scroll-target="#rコマンダーによる分析">3 Rコマンダーによる分析</a>
  <ul class="collapse">
  <li><a href="#ブランド価値を含むモデル" id="toc-ブランド価値を含むモデル" class="nav-link" data-scroll-target="#ブランド価値を含むモデル">3.1 ブランド価値を含むモデル</a></li>
  </ul></li>
  <li><a href="#多項離散選択モデル" id="toc-多項離散選択モデル" class="nav-link" data-scroll-target="#多項離散選択モデル">4 多項離散選択モデル</a>
  <ul class="collapse">
  <li><a href="#rによる分析多項ロジットモデルの推定" id="toc-rによる分析多項ロジットモデルの推定" class="nav-link" data-scroll-target="#rによる分析多項ロジットモデルの推定">4.1 Rによる分析：多項ロジット・モデルの推定</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第12章-ブランドと属性の同時マップ" id="toc-第12章-ブランドと属性の同時マップ" class="nav-link" data-scroll-target="#第12章-ブランドと属性の同時マップ">第12章 ブランドと属性の同時マップ</a>
  <ul>
  <li><a href="#質的変数の関連性" id="toc-質的変数の関連性" class="nav-link" data-scroll-target="#質的変数の関連性">1 質的変数の関連性</a>
  <ul class="collapse">
  <li><a href="#rコマンダーによる質的変数の独立性の検定" id="toc-rコマンダーによる質的変数の独立性の検定" class="nav-link" data-scroll-target="#rコマンダーによる質的変数の独立性の検定">1.2 Rコマンダーによる質的変数の独立性の検定</a></li>
  </ul></li>
  <li><a href="#rコマンダーによるコレスポンデンス分析" id="toc-rコマンダーによるコレスポンデンス分析" class="nav-link" data-scroll-target="#rコマンダーによるコレスポンデンス分析">3 Rコマンダーによるコレスポンデンス分析</a>
  <ul class="collapse">
  <li><a href="#実行手順" id="toc-実行手順" class="nav-link" data-scroll-target="#実行手順">3.1 実行手順</a></li>
  <li><a href="#デジタルカメラの事例" id="toc-デジタルカメラの事例" class="nav-link" data-scroll-target="#デジタルカメラの事例">3.2 デジタルカメラの事例</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第13章-マーケットバスケットとクロスセリング" id="toc-第13章-マーケットバスケットとクロスセリング" class="nav-link" data-scroll-target="#第13章-マーケットバスケットとクロスセリング">第13章 マーケットバスケットとクロスセリング</a>
  <ul>
  <li><a href="#rによるマーケットバスケット分析" id="toc-rによるマーケットバスケット分析" class="nav-link" data-scroll-target="#rによるマーケットバスケット分析">3 Rによるマーケットバスケット分析</a></li>
  </ul></li>
  <li><a href="#第14章-定性調査データの分析" id="toc-第14章-定性調査データの分析" class="nav-link" data-scroll-target="#第14章-定性調査データの分析">第14章 定性調査データの分析</a>
  <ul>
  <li><a href="#顧客満足度指数csi" id="toc-顧客満足度指数csi" class="nav-link" data-scroll-target="#顧客満足度指数csi">5 顧客満足度指数：CSI</a>
  <ul class="collapse">
  <li><a href="#rによる顧客満足度の分析" id="toc-rによる顧客満足度の分析" class="nav-link" data-scroll-target="#rによる顧客満足度の分析">5.6 Rによる顧客満足度の分析</a></li>
  </ul></li>
  <li><a href="#高次因子分析" id="toc-高次因子分析" class="nav-link" data-scroll-target="#高次因子分析">6 高次因子分析</a>
  <ul class="collapse">
  <li><a href="#rによるサービス品質の分析" id="toc-rによるサービス品質の分析" class="nav-link" data-scroll-target="#rによるサービス品質の分析">6.2 Rによるサービス品質の分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#第15章-eコマースとテキスト解析" id="toc-第15章-eコマースとテキスト解析" class="nav-link" data-scroll-target="#第15章-eコマースとテキスト解析">第15章 Eコマースとテキスト解析</a>
  <ul>
  <li><a href="#テキストデータの取得と前処理" id="toc-テキストデータの取得と前処理" class="nav-link" data-scroll-target="#テキストデータの取得と前処理">2 テキストデータの取得と前処理</a>
  <ul class="collapse">
  <li><a href="#rによるスクレイピングと形態素解析" id="toc-rによるスクレイピングと形態素解析" class="nav-link" data-scroll-target="#rによるスクレイピングと形態素解析">2.2 Rによるスクレイピングと形態素解析</a></li>
  </ul></li>
  <li><a href="#テキストの可視化" id="toc-テキストの可視化" class="nav-link" data-scroll-target="#テキストの可視化">3 テキストの可視化</a>
  <ul class="collapse">
  <li><a href="#rによるワードクラウドとn-gramネットワーク" id="toc-rによるワードクラウドとn-gramネットワーク" class="nav-link" data-scroll-target="#rによるワードクラウドとn-gramネットワーク">3.2 RによるワードクラウドとN-gramネットワーク</a></li>
  </ul></li>
  <li><a href="#rによる商品レビューコメントを用いた製品評価" id="toc-rによる商品レビューコメントを用いた製品評価" class="nav-link" data-scroll-target="#rによる商品レビューコメントを用いた製品評価">5 Rによる商品レビューコメントを用いた製品評価</a></li>
  </ul></li>
  <li><a href="#第16章-カウントデータの分析" id="toc-第16章-カウントデータの分析" class="nav-link" data-scroll-target="#第16章-カウントデータの分析">第16章 カウントデータの分析</a>
  <ul>
  <li><a href="#カウントデータを用いた市場反応分析" id="toc-カウントデータを用いた市場反応分析" class="nav-link" data-scroll-target="#カウントデータを用いた市場反応分析">4 カウントデータを用いた市場反応分析</a>
  <ul class="collapse">
  <li><a href="#事例データ入力データ" id="toc-事例データ入力データ" class="nav-link" data-scroll-target="#事例データ入力データ">4.1 事例データ：入力データ</a></li>
  <li><a href="#モデルによる分析" id="toc-モデルによる分析" class="nav-link" data-scroll-target="#モデルによる分析">4.2 モデルによる分析</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="https://www.yuhikaku.co.jp/books/detail/9784641166080" target="_blank">照井伸彦・佐藤忠彦（2022）『現代マーケティング・リサーチ—市場を読み解くデータ分析 新版』有斐閣</a> は，Rを用いたマーケティング・リサーチの入門書として位置づけられる。</p>
<p>本書の想定読者は，Rを初めて使用する学生であり，プログラミングに戸惑うことが予想されるため，Rコマンダーを利用して解説している。 しかし，Rに慣れた読者にとっては，Rコマンダーの処理がブラックボックス化されており，かえって分かりにくい。 そこで，本サイトでは，Rコマンダーによって生成されたコードと，それと同じ処理をRに習熟したユーザーが記述する場合のコードを並べて示し，理解を助ける構成としている。</p>
<p>また，本書にはいくつか誤植があり，本書の指示通りに操作を進めると，Rコマンダーの利用において行き詰まる箇所がある。 そのような部分については適宜修正しながら読み進めることを推奨する。</p>
<section id="第3章-サンプリング" class="level2">
<h2 class="anchored" data-anchor-id="第3章-サンプリング">第3章 サンプリング</h2>
<section id="単純無作為サンプリング" class="level3">
<h3 class="anchored" data-anchor-id="単純無作為サンプリング">4 単純無作為サンプリング</h3>
<section id="rコマンダーによる乱数表作成" class="level4">
<h4 class="anchored" data-anchor-id="rコマンダーによる乱数表作成">4.1 Rコマンダーによる乱数表作成</h4>
<section id="rコマンダーによって生成されたコードp.-37" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-37">▶ Rコマンダーによって生成されたコード（p.&nbsp;37）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>UniformSamples <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">1</span><span class="sc">*</span><span class="dv">100</span>, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">1</span>), <span class="at">ncol=</span><span class="dv">100</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(UniformSamples) <span class="ot">&lt;-</span> <span class="st">"sample"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(UniformSamples) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"obs"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコードransu.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードransu.r">▶ 手入力するコード（<code>ransu.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> UniformSamples<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rx <span class="ot">&lt;-</span> <span class="fu">round</span>(x)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(rx)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード">▶ 一般的なRコード</h5>
<p>乱数を生成する際に，あらかじめ <code>set.seed()</code> を実行しておくと，同じ操作を繰り返したときに同じ乱数を再現できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>set.seed()</code> のかっこ中の数字は何でもよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">ceiling</span>(<span class="fu">runif</span>(<span class="dv">100</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">100</span>)))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ux[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 31 26 56  6 47 49 82 38 55 18</code></pre>
</div>
</div>
<p>または</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ux <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ux[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 82 53  3  5 44 85 28 52 25 42</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第5章-市場反応分析i" class="level2">
<h2 class="anchored" data-anchor-id="第5章-市場反応分析i">第5章 市場反応分析（I）</h2>
<section id="相関分析" class="level3">
<h3 class="anchored" data-anchor-id="相関分析">3 相関分析</h3>
<section id="売上と価格のデータ散布図の作成" class="level4">
<h4 class="anchored" data-anchor-id="売上と価格のデータ散布図の作成">3.2 売上と価格のデータ：散布図の作成</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;84</p>
<ul>
<li>（誤）欠損値はないこと“NA”で表している。</li>
<li>（正）欠損値を“NA”で表すように設定している。</li>
</ul>
<p>p.&nbsp;85</p>
<ul>
<li>（誤）小数点の記号がピリオドかカンマの指定もできる。</li>
<li>（正）小数点の記号をピリオドかカンマに指定できる。</li>
</ul>
<p>p.&nbsp;86</p>
<ul>
<li>（誤）“売上”を選択し，図5.5のようにそれぞれ反転させる。</li>
<li>（正）“売上”を選択し，図5.5左のようにそれぞれ青色に反転させる。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-84" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(売上<span class="sc">~</span>価格, <span class="at">regLine=</span><span class="cn">FALSE</span>, <span class="at">smooth=</span><span class="cn">FALSE</span>, <span class="at">boxplots=</span><span class="cn">FALSE</span>, <span class="at">data=</span>Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-1" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-1">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Dataset)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"売上数量"</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>図5.2の縦軸が「売上数量」となっていたため，列名を変更した。 一般的に「売上」は売上高を指すため，価格と売上の相関関係を図示するのはやや不自然である（価格が上がれば，売上数量が一定の場合，売上高も上昇する）。 この点を踏まえると，本書では図が修正されたものの，本文の修正が反映されないまま出版された可能性があるのではないだろうか。 なお，p.&nbsp;102の本文では「売上数量」と明確に同じ意味で使わる「売上」の記述が見られる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   売上数量 価格 販促
1      2052  840    0
2      2105  820    0
3      2450  790    1
4      2131  780    0
5      2806  640    1
6      2532  710    0
7      3650  350    1
8      2968  560    0
9      2605  780    1
10     2652  640    0
11     3062  600    1
12     3237  510    1
13     2831  480    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">regLine =</span> <span class="cn">FALSE</span>, <span class="at">smooth =</span> <span class="cn">FALSE</span>, <span class="at">boxplots =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">data =</span> Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>scatterplot()</code> は <code>car</code> パッケージの関数であるため，最初に <code>car</code> パッケージをロードしている。</p>
<p>次のように汎用的な作図関数 <code>plot()</code> を使ってもよい。 この場合，<code>car</code> パッケージを読み込む必要はない。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">data =</span> Dataset, <span class="at">las =</span> <span class="dv">1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="売上と価格に相関はあるか標本相関係数の検定" class="level4">
<h4 class="anchored" data-anchor-id="売上と価格に相関はあるか標本相関係数の検定">3.3 売上と価格に相関はあるか：標本相関係数の検定</h4>
<section id="rコマンダーによって生成されたコードp.-87" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-87">▶ Rコマンダーによって生成されたコード（p.&nbsp;87）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">cor.test</span>(価格, 売上, <span class="at">alternative=</span><span class="st">"two.sided"</span>, <span class="at">method=</span><span class="st">"pearson"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-2" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-2">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(Dataset<span class="sc">$</span>価格, Dataset<span class="sc">$</span>売上数量, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  Dataset$価格 and Dataset$売上数量
t = -8.1457, df = 11, p-value = 5.5e-06
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.9780506 -0.7661642
sample estimates:
       cor 
-0.9261709 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="売上と価格の市場反応分析回帰モデル" class="level3">
<h3 class="anchored" data-anchor-id="売上と価格の市場反応分析回帰モデル">4 売上と価格の市場反応分析：回帰モデル</h3>
<section id="rコマンダーによって生成されたコードp.-91" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-91">▶ Rコマンダーによって生成されたコード（p.&nbsp;91）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上<span class="sc">~</span>価格, <span class="at">data=</span>Dataset)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-3" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-3">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上数量 <span class="sc">~</span> 価格, <span class="at">data =</span> Dataset)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 売上数量 ~ 価格, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-368.25 -110.38   -0.84  124.15  269.81 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4581.7523   236.7640  19.352 7.61e-10 ***
価格          -2.8802     0.3536  -8.146 5.50e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 184.1 on 11 degrees of freedom
Multiple R-squared:  0.8578,    Adjusted R-squared:  0.8449 
F-statistic: 66.35 on 1 and 11 DF,  p-value: 5.5e-06</code></pre>
</div>
</div>
<p>昔は変数名（先頭ではなく途中）に <code>.</code> が使用されることもあったが，最近は使用しないのが一般的である。</p>
</section>
<section id="価格反応係数推定値の精度と信頼区間" class="level4">
<h4 class="anchored" data-anchor-id="価格反応係数推定値の精度と信頼区間">4.1 価格反応係数推定値の精度と信頼区間</h4>
<section id="rコマンダーによって生成されたコードp.-93" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-93">▶ Rコマンダーによって生成されたコード（p.&nbsp;93）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Confint</span>(RegModel<span class="fl">.1</span>, <span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-4" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-4">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Confint</span>(RegModel_1, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate       2.5 %      97.5 %
(Intercept) 4581.752298 4060.638183 5102.866414
価格          -2.880209   -3.658452   -2.101967</code></pre>
</div>
</div>
<p><code>Confint()</code> は <code>car</code> パッケージの関数である。</p>
</section>
</section>
</section>
<section id="複数の説明変数を持つ市場反応分析重回帰モデル" class="level3">
<h3 class="anchored" data-anchor-id="複数の説明変数を持つ市場反応分析重回帰モデル">5 複数の説明変数を持つ市場反応分析：重回帰モデル</h3>
<section id="価格と販売促進の効果" class="level4">
<h4 class="anchored" data-anchor-id="価格と販売促進の効果">5.1 価格と販売促進の効果</h4>
<section id="rコマンダーによって生成されたコードp.-98" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-98">▶ Rコマンダーによって生成されたコード（p.&nbsp;98）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上<span class="sc">~</span>価格<span class="sc">+</span>販促, <span class="at">data=</span>Dataset)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-5" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-5">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>RegModel_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(売上数量 <span class="sc">~</span> 価格 <span class="sc">+</span> 販促, <span class="at">data =</span> Dataset)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 売上数量 ~ 価格 + 販促, data = Dataset)

Residuals:
     Min       1Q   Median       3Q      Max 
-182.876  -54.165    0.597   63.301  162.349 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4263.2262   148.6279  28.684 6.18e-11 ***
価格          -2.6028     0.2077 -12.531 1.94e-07 ***
販促         297.1607    60.1706   4.939 0.000588 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 104.1 on 10 degrees of freedom
Multiple R-squared:  0.9586,    Adjusted R-squared:  0.9504 
F-statistic: 115.9 on 2 and 10 DF,  p-value: 1.209e-07</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;100</p>
<ul>
<li>（誤）適合度が0.08程度</li>
<li>（正）適合度が0.008程度</li>
</ul>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="弾力性測定モデル" class="level3">
<h3 class="anchored" data-anchor-id="弾力性測定モデル">6 弾力性測定モデル</h3>
<section id="交差価格弾力性による競合関係の測定" class="level4">
<h4 class="anchored" data-anchor-id="交差価格弾力性による競合関係の測定">6.1 交差価格弾力性による競合関係の測定</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;106</p>
<ul>
<li>（誤）売上を【新しい変数名】に“LY”，【計算式】に“log(売上)”と入力する。</li>
<li>（正）【新しい変数名】に“LY1”，【計算式】に“log(Y1)”と入力する。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-105" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-105">▶ Rコマンダーによって生成されたコード（p.&nbsp;105）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LY1 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(Y1))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX1 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(X1))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX2 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">log</span>(X2))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(LY1<span class="sc">~</span>LX1<span class="sc">+</span>LX2, <span class="at">data=</span>Dataset)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-6" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-6">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LY1 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>Y1)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX1 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>X1)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>LX2 <span class="ot">&lt;-</span> <span class="fu">log</span>(Dataset<span class="sc">$</span>X2)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>RegModel_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(LY1 <span class="sc">~</span> LX1 <span class="sc">+</span> LX2, <span class="at">data =</span> Dataset)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_3)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = LY1 ~ LX1 + LX2, data = Dataset)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.52555 -0.13583 -0.05818  0.18692  0.38784 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.720      7.097   1.088    0.286    
LX1           -7.033      1.290  -5.451 9.08e-06 ***
LX2            6.504      1.187   5.479 8.42e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2199 on 27 degrees of freedom
Multiple R-squared:  0.6221,    Adjusted R-squared:  0.5941 
F-statistic: 22.22 on 2 and 27 DF,  p-value: 1.973e-06</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第6章-市場の発見と知覚マップ" class="level2">
<h2 class="anchored" data-anchor-id="第6章-市場の発見と知覚マップ">第6章 市場の発見と知覚マップ</h2>
<section id="知覚マップの作成" class="level3">
<h3 class="anchored" data-anchor-id="知覚マップの作成">4 知覚マップの作成</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
補足情報
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>本文には，表6.1は「消費者の評価調査データである」とされている。 しかし，同表は実際にはバイヤーに対する調査結果であり，詳細は以下のとおりである。</p>
【調査の方法】<br>
日本経済新聞社の「小売業調査」の対象になっているスーパー162社に対し，2010年12月22日に調査票をファクスで送付，2011年1月31日までに回収した。 回収数は92社，回収率は56.8%。 調査の実施・分析は日経リサーチが担当した。<br>
【表中の数字の見方】<br>
せんべい類を扱うバイヤーに5点満点でメーカーとブランドの総合評価をつけてもらい，その合計得点からランキングを作成した。 採点項目の数字は，メーカーまたはブランドを評価できると回答したバイヤーの割合（%）を表す。<br>

<div style="text-align: right;">
<p><strong>（出所：『日経MJ（流通新聞）』2011年2月13日，p.&nbsp;2）</strong></p>
</div>
</div>
</div>
</div>
</section>
<section id="rコマンダーでの手順" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーでの手順">5 Rコマンダーでの手順</h3>
<section id="rコマンダーによって生成されたコードp.-119" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-119">▶ Rコマンダーによって生成されたコード（p.&nbsp;119）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"clipboard"</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">"¥t"</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  .FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>キャンペーンイベント<span class="sc">+</span>パッケージデザイン<span class="sc">+</span>広告宣伝<span class="sc">+</span>素材栄養素<span class="sc">+</span>味, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.FA)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  Dataset <span class="ot">&lt;&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    F2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    F1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(F2<span class="sc">~</span>F1, <span class="at">regLine=</span><span class="cn">FALSE</span>, <span class="at">smooth=</span><span class="cn">FALSE</span>, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">'identify'</span>), <span class="at">boxplots=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">"マーケティング因子"</span>, <span class="at">ylab=</span><span class="st">"製品因子"</span>, <span class="at">data=</span>Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-7" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-7">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"clipboard"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"¥t"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> キャンペーンイベント <span class="sc">+</span> パッケージデザイン <span class="sc">+</span> 広告宣伝 <span class="sc">+</span> 素材栄養素 <span class="sc">+</span> 味,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="dv">2</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation =</span> <span class="st">"varimax"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">scores =</span> <span class="st">"regression"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F1 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">1</span>]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F2 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">2</span>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Dataset) <span class="ot">&lt;-</span> Dataset<span class="sc">$</span>製品名</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  F2 <span class="sc">~</span> F1,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">regLine =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">'identify'</span>),</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">boxplots =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"製品因子"</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~キャンペーンイベント + パッケージデザイン +     広告宣伝 + 素材栄養素 + 味, factors = 2, data = Dataset,     scores = "regression", rotation = "varimax", rownames = 1)

Uniquenesses:
キャンペーンイベント   パッケージデザイン             広告宣伝 
               0.158                0.318                0.005 
          素材栄養素                   味 
               0.407                0.005 

Loadings:
                     Factor1 Factor2
キャンペーンイベント 0.886   0.237  
パッケージデザイン   0.696   0.445  
広告宣伝             0.985   0.158  
素材栄養素           0.119   0.761  
味                   0.371   0.926  

               Factor1 Factor2
SS loadings      2.392   1.715
Proportion Var   0.478   0.343
Cumulative Var   0.478   0.821

Test of the hypothesis that 2 factors are sufficient.
The chi square statistic is 4.16 on 1 degree of freedom.
The p-value is 0.0415 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>1つの関数が長い場合は，引数のカンマの後で改行した方が見やすいため，コードを書く際に改行を入れるのが一般的である。 このとき，改行した行の先頭にはスペースを2つ入れる。</p>
<p>なお，クリップボードからデータを読むコードはOSによって異なる。 上に示したコードはWindowsの場合であり，macOSの場合，<code>Dataset &lt;- read.csv(pipe("pbpaste"), header = TRUE, sep = "\t")</code> とする。 タブを表す記号 <code>¥t</code> はWindowsの場合であり，macOSでは <code>\t</code> である。 ここで，<code>read.table()</code> の代わりに，<code>read.delim()</code> を使うこともできる。 <code>read.delim()</code> を使う場合は，引数の <code>header</code> と <code>sep</code> を省略できる（デフォルト値のため）。</p>
<p>また，Rコマンダーでは因子分析の結果を <code>.FA</code> に代入している。 <code>.</code> で始まる変数名はユーザーから隠す意図があり，この場面では意図通りに変数名を用いている（ただし，<code>local()</code> を使っているため，<code>.</code> で始まる必要はないのではあるが…）。 ここでは，ユーザーから隠す必然性はないため，<code>.FA</code> の代わりに <code>FA</code> という変数名を一般的なRコードで用いた。</p>
<p>さらに，本文の指示通りだと，図6.6の知覚マップには製品名ではなく，データフレーム <code>Dataset</code> の行番号が表示されることになる。 知覚マップ上に製品名を表示するには，<code>rownames(Dataset) &lt;- Dataset$製品名</code> を追加するか，あるいは，<code>read.csv()</code> の引数に <code>row.names = 1</code> を指定する必要がある，</p>
</section>
</section>
<section id="その他の問題" class="level3">
<h3 class="anchored" data-anchor-id="その他の問題">6 その他の問題</h3>
<section id="共通因子数の設定" class="level4">
<h4 class="anchored" data-anchor-id="共通因子数の設定">6.2 共通因子数の設定</h4>
<section id="rコマンダーによって生成されたコードp.-84-1" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84-1">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  .PC <span class="ot">&lt;-</span> <span class="fu">princomp</span>(<span class="sc">~</span>キャンペーンイベント<span class="sc">+</span>パッケージデザイン<span class="sc">+</span>広告宣伝<span class="sc">+</span>素材栄養素<span class="sc">+</span>味, <span class="at">cor=</span><span class="cn">TRUE</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Component loadings:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">unclass</span>(<span class="fu">loadings</span>(.PC)))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Component variances:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.PC<span class="sc">$</span>sd<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(.PC))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">screeplot</span>(.PC)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-8" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-8">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>PC <span class="ot">&lt;-</span> <span class="fu">princomp</span>( <span class="sc">~</span> キャンペーンイベント <span class="sc">+</span> パッケージデザイン <span class="sc">+</span> 広告宣伝 <span class="sc">+</span> 素材栄養素 <span class="sc">+</span> 味, <span class="at">cor =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> Dataset)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Component Loadings"</span> <span class="ot">=</span> <span class="fu">unclass</span>(<span class="fu">loadings</span>(PC)),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Component Variances"</span> <span class="ot">=</span> PC<span class="sc">$</span>sd <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Summary"</span> <span class="ot">=</span> <span class="fu">summary</span>(PC)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Component Loadings`
                        Comp.1     Comp.2     Comp.3     Comp.4     Comp.5
キャンペーンイベント 0.4714356  0.3769183  0.4597706  0.3613854  0.5419342
パッケージデザイン   0.4781955  0.1375293 -0.7804739 -0.2277185  0.3023567
広告宣伝             0.4871404  0.3588612  0.2664691 -0.4602804 -0.5924939
素材栄養素           0.3058296 -0.7333420  0.2987866 -0.4441059  0.2866606
味                   0.4671617 -0.4152667 -0.1385361  0.6391062 -0.4262212

$`Component Variances`
   Comp.1    Comp.2    Comp.3    Comp.4    Comp.5 
3.2672933 1.1601639 0.3588058 0.1815096 0.0322274 

$Summary
Importance of components:
                          Comp.1    Comp.2     Comp.3     Comp.4      Comp.5
Standard deviation     1.8075656 1.0771091 0.59900398 0.42603945 0.179519902
Proportion of Variance 0.6534587 0.2320328 0.07176115 0.03630192 0.006445479
Cumulative Proportion  0.6534587 0.8854914 0.95725260 0.99355452 1.000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(PC)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(PC, <span class="at">type =</span> <span class="st">"lines"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>スクリープロットを描く際，<code>screeplot(PC)</code> の引数として <code>type = "lines"</code> を指定すると折れ線グラフになり，こちらが一般的に用いられる。</p>
<p>また，主成分分析を使わずに相関行列の固有値を計算し，スクリープロットを描く方法もある。 因子分析の際にはこの方法が使われることがある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(Dataset[, <span class="fu">c</span>(<span class="st">"キャンペーンイベント"</span>, <span class="st">"パッケージデザイン"</span>, <span class="st">"広告宣伝"</span>, <span class="st">"素材栄養素"</span>, <span class="st">"味"</span>)])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ev <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cor_matrix)<span class="sc">$</span>values</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ev, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">main =</span> <span class="st">"スクリープロット"</span>, <span class="at">xlab =</span> <span class="st">"因子数"</span>, <span class="at">ylab =</span> <span class="st">"固有値"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>さらに，<code>psych</code> パッケージには簡単にスクリープロットを描く関数が用意されている。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(cor_matrix, <span class="at">n.obs =</span> <span class="fu">nrow</span>(Dataset), <span class="at">fa =</span> <span class="st">"fa"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel analysis suggests that the number of factors =  2  and the number of components =  NA </code></pre>
</div>
</div>
<p><code>fa.parallel()</code> は，単なる固有値のプロットではなく，実データの固有値とランダムデータから計算された固有値を比較するものである。</p>
</section>
</section>
</section>
<section id="サブマーケットと市場構造" class="level3">
<h3 class="anchored" data-anchor-id="サブマーケットと市場構造">7 サブマーケットと市場構造</h3>
<section id="rコマンダーによって生成されたコードp.-84-2" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-84-2">▶ Rコマンダーによって生成されたコード（p.&nbsp;84）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>HClust<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1<span class="sc">+</span>F2, Dataset)) , <span class="at">method=</span> <span class="st">"ward"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(HClust<span class="fl">.1</span>, <span class="at">main=</span> <span class="st">"Cluster Dendrogram for Solution HClust.1"</span>, <span class="at">xlab=</span> <span class="st">"Observation Number in Data Set Dataset"</span>, <span class="at">sub=</span><span class="st">"Method=ward; Distance=euclidian"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-9" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-9">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dist_1 <span class="ot">&lt;-</span> <span class="fu">dist</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)], <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>HClust_1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_1, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  HClust_1,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Cluster Dendrogram for Solution HClust_1"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Observation Number in Data Set Dataset"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"Method=ward.D2; Distance=euclidean"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ウォード法は <code>ward</code> や <code>ward.D</code> ではなく，<code>ward.D2</code> を指定する。 詳細な説明は関数 <code>hclust()</code> の<a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/hclust.html" target="_blank">ヘルプ</a>を参照のこと。</p>
<p>なお，知覚マップのところで <code>rownames(Dataset) &lt;- Dataset$製品名</code> を追加した場合は，図6.9とは異なり，デンドログラムに製品名が表示される。 製品名ではなく番号を使ってデンドログラムを描くには，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Dataset) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Dataset)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dist_1 <span class="ot">&lt;-</span> <span class="fu">dist</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)], <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>HClust_1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_1, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  HClust_1,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Cluster Dendrogram for Solution HClust_1"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Observation Number in Data Set Dataset"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"Method=ward.D2; Distance=euclidean"</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>以下は，図6.10の作図のためのコードである。 なお，クラスター分析に <code>ward.D2</code> を使用しているため，クラスター間距離が本書の記述とは異なる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(HClust_1, <span class="at">h =</span> <span class="dv">3</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">as.numeric</span>(Dataset<span class="sc">$</span>Cluster),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>, <span class="at">ylab =</span> <span class="st">"製品因子"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"クラスター間距離3"</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2, <span class="at">labels =</span> Dataset<span class="sc">$</span>製品名, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(Dataset<span class="sc">$</span>Cluster)) {</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dataEllipse</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    Dataset<span class="sc">$</span>F1[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k],</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    Dataset<span class="sc">$</span>F2[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k],</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> k, <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(HClust_1, <span class="at">h =</span> <span class="dv">1</span>))</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">as.numeric</span>(Dataset<span class="sc">$</span>Cluster),</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"マーケティング因子"</span>, <span class="at">ylab =</span> <span class="st">"製品因子"</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"クラスター間距離1"</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>F1, Dataset<span class="sc">$</span>F2, <span class="at">labels =</span> Dataset<span class="sc">$</span>製品名, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">unique</span>(Dataset<span class="sc">$</span>Cluster)) {</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  cluster_data <span class="ot">&lt;-</span> Dataset[Dataset<span class="sc">$</span>Cluster <span class="sc">==</span> k, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>)]</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(cluster_data) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dataEllipse</span>(</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>      cluster_data<span class="sc">$</span>F1,</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>      cluster_data<span class="sc">$</span>F2,</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> k, <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>dataEllipse()</code> はデータのばらつきをもとに楕円を描くため，2点しかないと警告が出て，直線が描かれる点に注意が必要である。</p>
<p>図を横に並べて表示する設定を行ったため，次のコードを実行してデフォルトの設定に戻しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="第7章-市場セグメンテーション" class="level2">
<h2 class="anchored" data-anchor-id="第7章-市場セグメンテーション">第7章 市場セグメンテーション</h2>
<section id="rコマンダーによる市場セグメンテーション" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる市場セグメンテーション">5 Rコマンダーによる市場セグメンテーション</h3>
<section id="因子分析" class="level4">
<h4 class="anchored" data-anchor-id="因子分析">5.2 因子分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;153</p>
<p>誤植というより，おそらく <code>Rcmdr</code> のバージョン違いにより，出力結果が異なっている可能性がある。図7.8，図7.9の通り実行しても，エラーになってしまう。以下の「手入力するコード」の部分を実行すると，本書の意図通りになるはずである（1行目のエラーは避けられない）。</p>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-149" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-149">▶ Rコマンダーによって生成されたコード（p.&nbsp;149）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  .FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>q1<span class="sc">+</span>q2<span class="sc">+</span>q3<span class="sc">+</span>q4<span class="sc">+</span>q5<span class="sc">+</span>q6<span class="sc">+</span>q7<span class="sc">+</span>q8<span class="sc">+</span>q9<span class="sc">+</span>q10<span class="sc">+</span>q11<span class="sc">+</span>q12<span class="sc">+</span>q13<span class="sc">+</span>q14<span class="sc">+</span>q15<span class="sc">+</span>q16<span class="sc">+</span>q17<span class="sc">+</span>q18<span class="sc">+</span>q19<span class="sc">+</span>q20<span class="sc">+</span>q21<span class="sc">+</span>q22<span class="sc">+</span>q23<span class="sc">+</span>q24<span class="sc">+</span>q25<span class="sc">+</span>q26<span class="sc">+</span>q27, <span class="at">factors=</span><span class="dv">4</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.FA)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  Dataset <span class="ot">&lt;&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    F4 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">4</span>]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    F3 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">3</span>]</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    F2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    F1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコード" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコード">▶ 手入力するコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.FA)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>.FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(<span class="sc">~</span>q1<span class="sc">+</span>q2<span class="sc">+</span>q3<span class="sc">+</span>q4<span class="sc">+</span>q5<span class="sc">+</span>q6<span class="sc">+</span>q7<span class="sc">+</span>q8<span class="sc">+</span>q9<span class="sc">+</span>q10<span class="sc">+</span>q11<span class="sc">+</span>q12<span class="sc">+</span>q13<span class="sc">+</span>q14<span class="sc">+</span>q15<span class="sc">+</span>q16<span class="sc">+</span>q17<span class="sc">+</span>q18<span class="sc">+</span>q19<span class="sc">+</span>q20<span class="sc">+</span>q21<span class="sc">+</span>q22<span class="sc">+</span>q23<span class="sc">+</span>q24<span class="sc">+</span>q25<span class="sc">+</span>q26<span class="sc">+</span>q27, <span class="at">factors=</span><span class="dv">4</span>, <span class="at">rotation=</span><span class="st">"varimax"</span>, <span class="at">scores=</span><span class="st">"regression"</span>, <span class="at">data=</span>Dataset)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>.FA</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA1 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">1</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA2 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">2</span>]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA3 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">3</span>]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>FA4 <span class="ot">&lt;-</span> .FA<span class="sc">$</span>scores[,<span class="dv">4</span>]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(.FA,<span class="at">cutoff=</span><span class="dv">0</span>,<span class="at">sort=</span><span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-10" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-10">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>())</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>FA <span class="ot">&lt;-</span> <span class="fu">factanal</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> q1 <span class="sc">+</span> q2 <span class="sc">+</span> q3 <span class="sc">+</span> q4 <span class="sc">+</span> q5 <span class="sc">+</span> q6 <span class="sc">+</span> q7 <span class="sc">+</span> q8 <span class="sc">+</span> q9 <span class="sc">+</span> q10 <span class="sc">+</span> q11 <span class="sc">+</span> q12 <span class="sc">+</span> q13 <span class="sc">+</span> q14 <span class="sc">+</span> q15 <span class="sc">+</span> q16 <span class="sc">+</span> q17 <span class="sc">+</span> q18 <span class="sc">+</span> q19 <span class="sc">+</span> q20 <span class="sc">+</span> q21 <span class="sc">+</span> q22 <span class="sc">+</span> q23 <span class="sc">+</span> q24 <span class="sc">+</span> q25 <span class="sc">+</span> q26 <span class="sc">+</span> q27,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">factors =</span> <span class="dv">4</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation =</span> <span class="st">"varimax"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scores =</span> <span class="st">"regression"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Dataset</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9 + q10 +     q11 + q12 + q13 + q14 + q15 + q16 + q17 + q18 + q19 + q20 +     q21 + q22 + q23 + q24 + q25 + q26 + q27, factors = 4, data = Dataset,     scores = "regression", rotation = "varimax")

Uniquenesses:
   q1    q2    q3    q4    q5    q6    q7    q8    q9   q10   q11   q12   q13 
0.857 0.924 0.557 0.743 0.532 0.759 0.654 0.755 0.645 0.705 0.676 0.318 0.179 
  q14   q15   q16   q17   q18   q19   q20   q21   q22   q23   q24   q25   q26 
0.220 0.160 0.550 0.143 0.053 0.262 0.657 0.864 0.492 0.443 0.516 0.398 0.106 
  q27 
0.163 

Loadings:
    Factor1 Factor2 Factor3 Factor4
q1           0.251   0.261         
q2                   0.257         
q3           0.184   0.638         
q4           0.138   0.471         
q5           0.164   0.659         
q6           0.105   0.459   0.119 
q7   0.110   0.238   0.522         
q8   0.281   0.177   0.299   0.212 
q9   0.234   0.234   0.481   0.118 
q10  0.355   0.165   0.208   0.314 
q11  0.408   0.135   0.127   0.351 
q12  0.805           0.156         
q13  0.898                         
q14  0.869           0.100         
q15  0.901                   0.146 
q16  0.541           0.264   0.284 
q17  0.496           0.121   0.768 
q18  0.478                   0.839 
q19  0.803                   0.286 
q20  0.360   0.248   0.332   0.204 
q21  0.329   0.109           0.101 
q22          0.474   0.531         
q23          0.550   0.500         
q24  0.107   0.555   0.405         
q25          0.693   0.331         
q26  0.131   0.911   0.177   0.121 
q27  0.148   0.880   0.175         

               Factor1 Factor2 Factor3 Factor4
SS loadings      5.206   3.376   3.187   1.899
Proportion Var   0.193   0.125   0.118   0.070
Cumulative Var   0.193   0.318   0.436   0.506

Test of the hypothesis that 4 factors are sufficient.
The chi square statistic is 2835.86 on 249 degrees of freedom.
The p-value is 0 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F1 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">1</span>]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F2 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">2</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F3 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">3</span>]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F4 <span class="ot">&lt;-</span> FA<span class="sc">$</span>scores[, <span class="dv">4</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FA, <span class="at">cutoff =</span> <span class="dv">0</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = ~q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9 + q10 +     q11 + q12 + q13 + q14 + q15 + q16 + q17 + q18 + q19 + q20 +     q21 + q22 + q23 + q24 + q25 + q26 + q27, factors = 4, data = Dataset,     scores = "regression", rotation = "varimax")

Uniquenesses:
   q1    q2    q3    q4    q5    q6    q7    q8    q9   q10   q11   q12   q13 
0.857 0.924 0.557 0.743 0.532 0.759 0.654 0.755 0.645 0.705 0.676 0.318 0.179 
  q14   q15   q16   q17   q18   q19   q20   q21   q22   q23   q24   q25   q26 
0.220 0.160 0.550 0.143 0.053 0.262 0.657 0.864 0.492 0.443 0.516 0.398 0.106 
  q27 
0.163 

Loadings:
    Factor1 Factor2 Factor3 Factor4
q12  0.805   0.045   0.156   0.090 
q13  0.898   0.041   0.078   0.089 
q14  0.869   0.086   0.100   0.080 
q15  0.901   0.068   0.045   0.146 
q16  0.541   0.083   0.264   0.284 
q19  0.803   0.066   0.085   0.286 
q23  0.065   0.550   0.500   0.020 
q24  0.107   0.555   0.405   0.025 
q25  0.081   0.693   0.331   0.071 
q26  0.131   0.911   0.177   0.121 
q27  0.148   0.880   0.175   0.099 
q3   0.010   0.184   0.638  -0.040 
q5   0.039   0.164   0.659   0.070 
q7   0.110   0.238   0.522   0.067 
q22  0.011   0.474   0.531   0.026 
q17  0.496   0.076   0.121   0.768 
q18  0.478   0.075   0.096   0.839 
q1   0.096   0.251   0.261   0.050 
q2   0.100   0.006   0.257   0.017 
q4   0.095   0.138   0.471   0.084 
q6   0.070   0.105   0.459   0.119 
q8   0.281   0.177   0.299   0.212 
q9   0.234   0.234   0.481   0.118 
q10  0.355   0.165   0.208   0.314 
q11  0.408   0.135   0.127   0.351 
q20  0.360   0.248   0.332   0.204 
q21  0.329   0.109   0.074   0.101 

               Factor1 Factor2 Factor3 Factor4
SS loadings      5.206   3.376   3.187   1.899
Proportion Var   0.193   0.125   0.118   0.070
Cumulative Var   0.193   0.318   0.436   0.506

Test of the hypothesis that 4 factors are sufficient.
The chi square statistic is 2835.86 on 249 degrees of freedom.
The p-value is 0 </code></pre>
</div>
</div>
</section>
</section>
<section id="クラスター分析" class="level4">
<h4 class="anchored" data-anchor-id="クラスター分析">5.3 クラスター分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;153</p>
<ul>
<li>（誤）入力としてF1〜F4（【変数（1つ以上選択）】）を指定し，クラスター数は4つとした。</li>
<li>（正）入力としてF1〜F4（【変数（1つ以上選択）】）を指定し，クラスター数は4つとした。さらに，【オプション】タブでは「データセットにクラスタを割り当てる」にチェックを入れる。最後に，【OK】をクリックする。</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-153" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-153">▶ Rコマンダーによって生成されたコード（p.&nbsp;153）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>.cluster <span class="ot">&lt;-</span>  <span class="fu">KMeans</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset), <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">iter.max =</span> <span class="dv">10</span>, <span class="at">num.seeds =</span> <span class="dv">10</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>size <span class="co"># Cluster Sizes</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>centers <span class="co"># Cluster Centroids</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>withinss <span class="co"># Within Cluster Sum of Squares</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>tot.withinss <span class="co"># Total Within Sum of Squares</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>.cluster<span class="sc">$</span>betweenss <span class="co"># Between Cluster Sum of Squares</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">princomp</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset)), <span class="at">xlabs =</span> <span class="fu">as.character</span>(.cluster<span class="sc">$</span>cluster))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>KMeans <span class="ot">&lt;-</span> <span class="fu">assignCluster</span>(<span class="fu">model.matrix</span>(<span class="sc">~-</span><span class="dv">1</span> <span class="sc">+</span> F1 <span class="sc">+</span> F2 <span class="sc">+</span> F3 <span class="sc">+</span> F4, Dataset), Dataset, .cluster<span class="sc">$</span>cluster)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.cluster)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  .Table <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fu">table</span>(KMeans))</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">counts:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(.Table)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">percentages:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>.Table<span class="sc">/</span><span class="fu">sum</span>(.Table), <span class="dv">2</span>))</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071, <span class="at">pos=</span><span class="dv">17</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">numSummary</span>(Dataset[,<span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>), <span class="at">drop=</span><span class="cn">FALSE</span>], <span class="at">groups=</span>Dataset<span class="sc">$</span>KMeans, <span class="at">statistics=</span><span class="fu">c</span>(<span class="st">"mean"</span>), <span class="at">quantiles=</span><span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,<span class="dv">1</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-11" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-11">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)], <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">iter.max =</span> <span class="dv">10</span>, <span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cluster Sizes"</span> <span class="ot">=</span> cluster<span class="sc">$</span>size,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cluster Centroids"</span> <span class="ot">=</span> cluster<span class="sc">$</span>centers,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Within Cluster Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>withinss,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total Within Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>tot.withinss,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Between Cluster Sum of Squares"</span> <span class="ot">=</span> cluster<span class="sc">$</span>betweenss</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Cluster Sizes`
[1] 192 202 514 327

$`Cluster Centroids`
          F1          F2         F3         F4
1 -0.5953486  0.21550094  0.2528594  1.4000022
2 -0.6171745 -1.40308357 -0.4617852 -0.5133626
3  0.8355935  0.01429324  0.0165523  0.1887794
4 -0.5826265  0.71773692  0.1107759 -0.8016323

$`Within Cluster Sum of Squares`
[1] 453.0426 647.8556 677.8658 696.1054

$`Total Within Sum of Squares`
[1] 2474.869

$`Between Cluster Sum of Squares`
[1] 1907.535</code></pre>
</div>
</div>
<p>主成分分析のバイプロットを描画し，データポイントを <em>K-means</em> 法によるクラスター分析の結果に基づいてラベル付けする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">princomp</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)]), <span class="at">xlabs =</span> <span class="fu">as.character</span>(cluster<span class="sc">$</span>cluster))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>K-means</em> 法によるクラスター分析の結果を確認する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>KMeans <span class="ot">&lt;-</span> cluster<span class="sc">$</span>cluster</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Dataset<span class="sc">$</span>KMeans)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3   4 
192 202 514 327 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(Dataset<span class="sc">$</span>KMeans)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1     2     3     4 
15.55 16.36 41.62 26.48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(Dataset[, <span class="fu">c</span>(<span class="st">"F1"</span>, <span class="st">"F2"</span>, <span class="st">"F3"</span>, <span class="st">"F4"</span>)], Dataset<span class="sc">$</span>KMeans)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">t</span>(<span class="fu">sapply</span>(split_data, colMeans)),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                     サンプルサイズ <span class="ot">=</span> <span class="fu">sapply</span>(split_data, nrow))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント         F1          F2         F3         F4 サンプルサイズ
1          1 -0.5953486  0.21550094  0.2528594  1.4000022            192
2          2 -0.6171745 -1.40308357 -0.4617852 -0.5133626            202
3          3  0.8355935  0.01429324  0.0165523  0.1887794            514
4          4 -0.5826265  0.71773692  0.1107759 -0.8016323            327</code></pre>
</div>
</div>
<p><code>result</code> の出力結果において，行の並び順が表7.9と異なっていても問題ない。</p>
</section>
</section>
<section id="セグメントのプロファイリング" class="level4">
<h4 class="anchored" data-anchor-id="セグメントのプロファイリング">5.4 セグメントのプロファイリング</h4>
<p>表7.10〜表7.13もRを使って作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(Dataset, Dataset<span class="sc">$</span>KMeans)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">table</span>(df<span class="sc">$</span>性別)), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>gender_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data), <span class="fu">t</span>(gender))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gender_table)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"男性"</span>, <span class="st">"女性"</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>gender_table</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 男性 女性
1          1 60.4 39.6
2          2 69.3 30.7
3          3 65.4 34.6
4          4 70.3 29.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>           平均年齢 <span class="ot">=</span> <span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">round</span>(<span class="fu">mean</span>(df<span class="sc">$</span>年齢), <span class="dv">1</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 平均年齢
1          1     44.0
2          2     39.9
3          3     42.1
4          4     45.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data),</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>           投資経験年数 <span class="ot">=</span> <span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">round</span>(<span class="fu">mean</span>(df<span class="sc">$</span>投資経験年数), <span class="dv">1</span>)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 投資経験年数
1          1          8.3
2          2          6.3
3          3          7.3
4          4          9.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>transaction <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">sapply</span>(split_data, <span class="cf">function</span>(df) <span class="fu">table</span>(df<span class="sc">$</span>取引形態)), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>transaction_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(セグメント <span class="ot">=</span> <span class="fu">names</span>(split_data), <span class="fu">t</span>(transaction))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(transaction_table)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"対面取引"</span>, <span class="st">"インターネット取引"</span>, <span class="st">"対面とインターネットの併用"</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>transaction_table</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  セグメント 対面取引 インターネット取引 対面とインターネットの併用
1          1     20.3               64.1                       15.6
2          2     14.9               78.2                        6.9
3          3     15.8               72.0                       12.3
4          4     13.1               74.9                       11.9</code></pre>
</div>
</div>
<p>さらに，図7.4もRを使って作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>gender_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(Dataset<span class="sc">$</span>性別)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gender_counts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"男性"</span>, <span class="st">"女性"</span>) </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(gender_counts)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>年齢区分 <span class="ot">&lt;-</span> <span class="fu">cut</span>(Dataset<span class="sc">$</span>年齢, </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">20</span>, <span class="fu">max</span>(Dataset<span class="sc">$</span>年齢) <span class="sc">+</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">5</span>), </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(Dataset<span class="sc">$</span>年齢区分), <span class="at">col =</span> <span class="st">"skyblue"</span>, <span class="at">las =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>細かい調整が必要な場合は，自分でカスタマイズ可能である。 例えば，棒グラフの上に数値を表示したい場合は，次のようにする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>bar_positions <span class="ot">&lt;-</span> <span class="fu">barplot</span>(gender_counts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(gender_counts) <span class="sc">*</span> <span class="fl">1.2</span>), <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">alpha.f =</span> .<span class="dv">5</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(bar_positions, gender_counts, <span class="at">labels =</span> gender_counts, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="第8章-製品開発" class="level2">
<h2 class="anchored" data-anchor-id="第8章-製品開発">第8章 製品開発</h2>
<section id="コンジョイント分析" class="level3">
<h3 class="anchored" data-anchor-id="コンジョイント分析">4 コンジョイント分析</h3>
<section id="個人分析rコマンダーによる分析" class="level4">
<h4 class="anchored" data-anchor-id="個人分析rコマンダーによる分析">4.2 個人分析：Rコマンダーによる分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;173</p>
<ul>
<li>（誤）日本語処理の関係で先頭に <code>X</code> が付いている</li>
<li>（正）デフォルトでは，数字で始まる列名の先頭に <code>X</code> が付く</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-172" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-172">▶ Rコマンダーによって生成されたコード（p.&nbsp;172）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用<span class="sc">~</span>X2年<span class="sc">+</span>X4時間<span class="sc">+</span>X6時間<span class="sc">+</span>シルバー<span class="sc">+</span>赤, <span class="at">data=</span>Dataset)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-12" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-12">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> X2年 <span class="sc">+</span> X4時間 <span class="sc">+</span> X6時間 <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ X2年 + X4時間 + X6時間 + シルバー + 
    赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0556 -0.8889  0.4167  1.0278  2.4444 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -0.5556     1.0199  -0.545  0.59591    
X2年          6.7778     0.8327   8.139 3.15e-06 ***
X4時間        2.5000     1.0199   2.451  0.03052 *  
X6時間        3.5000     1.0199   3.432  0.00497 ** 
シルバー      6.3333     1.0199   6.210 4.52e-05 ***
赤            7.6667     1.0199   7.517 7.07e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.766 on 12 degrees of freedom
Multiple R-squared:  0.9227,    Adjusted R-squared:  0.8905 
F-statistic: 28.65 on 5 and 12 DF,  p-value: 2.819e-06</code></pre>
</div>
</div>
<p><code>conjoint1.txt</code> はタブ区切りテキストのように見えるが，Rコマンダーで「フィールドの区切り記号」を「タブ」にするとエラーが出て読み込めない。 「空白」にすると読み込める。 よく見ると，<code>conjoint1.txt</code> のヘッダーのみスペース区切りになっている。 このようなデータは珍しい。</p>
<p>なお，数字で始まる列名の先頭に <code>X</code> を付けたくない場合は，<code>read.table()</code> の引数に <code>check.names = FALSE</code> を指定すればよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   カードNo. 6時間 4時間 2年 赤 シルバー 選好順位 全体効用
1          1     1     0   0  1        0        7       12
2          2     1     0   0  0        1        9       10
3          3     1     0   0  0        0       17        2
4          4     1     0   1  1        0        1       18
5          5     1     0   1  0        1        6       13
6          6     1     0   1  0        0        8       11
7          7     0     1   0  1        0       10        9
8          8     0     1   0  0        1       12        7
9          9     0     1   0  0        0       16        3
10        10     0     1   1  1        0        2       17
11        11     0     1   1  0        1        3       16
12        12     0     1   1  0        0       11        8
13        13     0     0   0  1        0       14        5
14        14     0     0   0  0        1       13        6
15        15     0     0   0  0        0       18        1
16        16     0     0   1  1        0        5       14
17        17     0     0   1  0        1        4       15
18        18     0     0   1  0        0       15        4</code></pre>
</div>
</div>
<p>ただし，<code>lm()</code> を実行するときには，列名をバッククオート <code>`</code> で括る必要がある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> <span class="st">`</span><span class="at">2年</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">4時間</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">6時間</span><span class="st">`</span> <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ `2年` + `4時間` + `6時間` + 
    シルバー + 赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0556 -0.8889  0.4167  1.0278  2.4444 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -0.5556     1.0199  -0.545  0.59591    
`2年`         6.7778     0.8327   8.139 3.15e-06 ***
`4時間`       2.5000     1.0199   2.451  0.03052 *  
`6時間`       3.5000     1.0199   3.432  0.00497 ** 
シルバー      6.3333     1.0199   6.210 4.52e-05 ***
赤            7.6667     1.0199   7.517 7.07e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.766 on 12 degrees of freedom
Multiple R-squared:  0.9227,    Adjusted R-squared:  0.8905 
F-statistic: 28.65 on 5 and 12 DF,  p-value: 2.819e-06</code></pre>
</div>
</div>
<p>実際に自分でデータを扱う際には，こうしたことを考慮しながら，列名をどうするかを決める必要がある。</p>
</section>
</section>
</section>
<section id="直交表利用によるコンジョイント分析" class="level3">
<h3 class="anchored" data-anchor-id="直交表利用によるコンジョイント分析">5 直交表利用によるコンジョイント分析</h3>
<section id="集計分析rコマンダーによる分析" class="level4">
<h4 class="anchored" data-anchor-id="集計分析rコマンダーによる分析">5.3 集計分析：Rコマンダーによる分析</h4>
<section id="rコマンダーによって生成されたコードp.-179" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-179">▶ Rコマンダーによって生成されたコード（p.&nbsp;179）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用<span class="sc">~</span>X2年<span class="sc">+</span>X4時間<span class="sc">+</span>X6時間<span class="sc">+</span>シルバー<span class="sc">+</span>赤, <span class="at">data=</span>Dataset)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-13" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-13">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>RegModel_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(全体効用 <span class="sc">~</span> X2年 <span class="sc">+</span> X4時間 <span class="sc">+</span> X6時間 <span class="sc">+</span> シルバー <span class="sc">+</span> 赤, <span class="at">data =</span> Dataset)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 全体効用 ~ X2年 + X4時間 + X6時間 + シルバー + 
    赤, data = Dataset)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.7667 -0.6875 -0.1500  0.5833  2.7000 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.1667     0.3193   0.522 0.603020    
X2年          2.2500     0.2560   8.790 1.57e-13 ***
X4時間        1.1333     0.2956   3.834 0.000243 ***
X6時間        0.3667     0.2956   1.240 0.218245    
シルバー      3.9000     0.2956  13.194  &lt; 2e-16 ***
赤            4.6000     0.2956  15.563  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.145 on 84 degrees of freedom
Multiple R-squared:  0.8165,    Adjusted R-squared:  0.8056 
F-statistic: 74.77 on 5 and 84 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><code>conjoint2.txt</code> も <code>conjoint1.txt</code> と同様に変わったルール（ヘッダーのみスペース区切りで，他はタブ区切り）でデータが記述されている。</p>
</section>
</section>
</section>
</section>
<section id="第9章-新製品の普及" class="level2">
<h2 class="anchored" data-anchor-id="第9章-新製品の普及">第9章 新製品の普及</h2>
<section id="rコマンダーによる新製品普及構造の分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる新製品普及構造の分析">6 Rコマンダーによる新製品普及構造の分析</h3>
<section id="回帰分析" class="level4">
<h4 class="anchored" data-anchor-id="回帰分析">6.1 回帰分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;202，表9.2</p>
<ul>
<li>（誤）5000e+03</li>
<li>（正）5.000e+03</li>
</ul>
<p>p.&nbsp;203</p>
<ul>
<li>（誤）予測値が追加される。本書の検証は</li>
<li>（正）予測値が追加される。その後，【グラフ】⇒【折れ線グラフ…】でコマンドボックスを立ち上げて，【x 変数（1つ選択）】から「時点」を選択し，【y 変数（2つ以上選択）】から「購買者数」と「予測」を選択した後で，【OK】をクリックする。本書の検証は</li>
</ul>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-199" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-199">▶ Rコマンダーによって生成されたコード（p.&nbsp;199）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>Dataset2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(Dataset, <span class="at">subset=</span>時点<span class="sc">&lt;</span><span class="dv">11</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>RegModel<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(購買者数<span class="sc">~</span>一期前累積購買者数<span class="sc">+</span>一期前累積購買者数の二乗, <span class="at">data=</span>Dataset2)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel<span class="fl">.1</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコード-1" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコード-1">▶ 手入力するコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">5.000e+03</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">9.983e-02</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.994e-06</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> (<span class="sc">-</span> b <span class="sc">-</span> <span class="fu">sqrt</span>(b <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> a <span class="sc">*</span> c)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> c)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> a <span class="sc">/</span> m</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> p <span class="sc">+</span> b</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50021.69</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09995664</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>q</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1997866</code></pre>
</div>
</div>
<p>本書の指示通りに計算すると，<code>p</code> と <code>q</code> は小数第4位で四捨五入すれば正しい値が計算できたことになる。 ただし，<code>m</code> については四捨五入したとしても値が一致しない。</p>
</section>
<section id="一般的なrコード-14" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-14">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>Dataset2 <span class="ot">&lt;-</span> Dataset[Dataset<span class="sc">$</span>時点 <span class="sc">&lt;</span> <span class="dv">11</span>, ]</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>RegModel_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(購買者数 <span class="sc">~</span> 一期前累積購買者数 <span class="sc">+</span> <span class="fu">I</span>(一期前累積購買者数 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">data =</span> Dataset2)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = 購買者数 ~ 一期前累積購買者数 + I(一期前累積購買者数^2), 
    data = Dataset2)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.8250 -1.4318 -0.3015  1.5493  5.1581 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              5.000e+03  2.453e+00  2038.4  &lt; 2e-16 ***
一期前累積購買者数       9.983e-02  2.708e-04   368.7 2.85e-16 ***
I(一期前累積購買者数^2) -3.994e-06  6.104e-09  -654.3  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.051 on 7 degrees of freedom
Multiple R-squared:      1, Adjusted R-squared:      1 
F-statistic: 7.471e+05 on 2 and 7 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>このデータについて，「累積購買者数」，「一期前累積購買者数」，「一期前累積購買者数の二乗」の3つの列がどこで計算されたのかが気になる。 通常は，次のデータが手元にあると考えるのが理に適っているだろう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> Dataset[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   時点 購買者数
1     1     4998
2     2     5398
3     3     5611
4     4     5574
5     5     5292
6     6     4798
7     7     4157
8     8     3445
9     9     2762
10   10     2141
11   11     1609
12   12     1199
13   13      871
14   14      629
15   15      448</code></pre>
</div>
</div>
<p>このデータから，必要なデータを作成可能である。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>累積購買者数 <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(Dataset<span class="sc">$</span>購買者数)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>一期前累積購買者数 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">head</span>(Dataset<span class="sc">$</span>累積購買者数, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>一期前累積購買者数の二乗 <span class="ot">&lt;-</span> Dataset<span class="sc">$</span>一期前累積購買者数 <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>Dataset</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   時点 購買者数 累積購買者数 一期前累積購買者数 一期前累積購買者数の二乗
1     1     4998         4998                  0                        0
2     2     5398        10396               4998                 24980004
3     3     5611        16007              10396                108076816
4     4     5574        21581              16007                256224049
5     5     5292        26873              21581                465739561
6     6     4798        31671              26873                722158129
7     7     4157        35828              31671               1003052241
8     8     3445        39273              35828               1283645584
9     9     2762        42035              39273               1542368529
10   10     2141        44176              42035               1766941225
11   11     1609        45785              44176               1951518976
12   12     1199        46984              45785               2096266225
13   13      871        47855              46984               2207496256
14   14      629        48484              47855               2290101025
15   15      448        48932              48484               2350698256</code></pre>
</div>
</div>
<p>続いて，<code>m</code>，<code>p</code>，<code>q</code> の計算は，<code>lm()</code> の結果を用いて計算することができる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">coef</span>(RegModel_1)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> x[<span class="dv">2</span>]</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> x[<span class="dv">3</span>]</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> (<span class="sc">-</span> b <span class="sc">-</span> <span class="fu">sqrt</span>(b <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> a <span class="sc">*</span> c)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> c)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> a <span class="sc">/</span> m</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> p <span class="sc">+</span> b</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50022.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09994712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>q</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1997775</code></pre>
</div>
</div>
<p>今度は，本書と同じ値が計算された。 続いて，図9.12を作成する。</p>
</section>
<section id="rコマンダーによって生成されたコードp.-203" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-203">▶ Rコマンダーによって生成されたコード（p.&nbsp;203）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">with</span>(Dataset, <span class="fl">5.000e+03</span><span class="sc">+</span>一期前累積購買者数<span class="sc">*</span><span class="fl">9.983e-02</span><span class="sc">+</span>一期前累積購買者数の二乗<span class="sc">*</span>(<span class="sc">-</span><span class="fl">3.994e-06</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">lineplot</span>(時点, 購買者数, 予測))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-15" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-15">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, Dataset[, <span class="fu">c</span>(<span class="st">"一期前累積購買者数"</span>, <span class="st">"一期前累積購買者数の二乗"</span>)])) <span class="sc">%*%</span> <span class="fu">coef</span>(RegModel_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このとき， <code>predict()</code> 関数を使うと便利である。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>予測 <span class="ot">&lt;-</span> <span class="fu">predict</span>(RegModel_1, <span class="at">newdata =</span> Dataset)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rコマンダーでは，<code>RcmdrMisc</code> パッケージの関数 <code>lineplot()</code> で作図しているので，Rコマンダーを使わない場合はこの関数は使えない。 代わりに，次のコードで図を作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>購買者数, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(<span class="fu">c</span>(Dataset<span class="sc">$</span>購買者数, Dataset<span class="sc">$</span>予測)),</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"時点"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">"購買者数と予測値の推移"</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>予測, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>購買者数, <span class="at">labels =</span> <span class="st">"1"</span>, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">offset =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(Dataset<span class="sc">$</span>時点, Dataset<span class="sc">$</span>予測, <span class="at">labels =</span> <span class="st">"2"</span>, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">offset =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"購買者数"</span>, <span class="st">"予測"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>図9.13にあるような累積購入者数のグラフを作成するには，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(累積購買者数 <span class="sc">~</span> 時点, <span class="at">data =</span> Dataset, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(Dataset<span class="sc">$</span>累積購買者数)), <span class="at">main =</span> <span class="st">"普及パターン"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第10章-顧客の管理" class="level2">
<h2 class="anchored" data-anchor-id="第10章-顧客の管理">第10章 顧客の管理</h2>
<section id="rコマンダーによる顧客管理のための分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる顧客管理のための分析">4 Rコマンダーによる顧客管理のための分析</h3>
<section id="rfm分析" class="level4">
<h4 class="anchored" data-anchor-id="rfm分析">4.1 RFM分析</h4>
<section id="rコマンダーによって生成されたコードp.-220" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-220">▶ Rコマンダーによって生成されたコード（p.&nbsp;220）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  M_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(M, <span class="st">'0:49999="M_Rank1"; 50000:99999="M_Rank2"; 100000:299999="M_Rank3"; 300000:499999="M_Rank4"; else="M_Rank5"'</span>, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">as.factor=</span><span class="cn">TRUE</span>, <span class="at">to.value=</span><span class="st">"="</span>, <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  F_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(F, <span class="st">'1="F_Rank1"; 2="F_Rank2"; 3:9="F_Rank3"; 10:29="F_Rank4"; else="F_Rank5";'</span>, <span class="at">as.factor=</span><span class="cn">TRUE</span>, <span class="at">to.value=</span><span class="st">"="</span>, </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">within</span>(Dataset, {</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  R_Rank <span class="ot">&lt;-</span> <span class="fu">Recode</span>(R, <span class="st">'0:30="R_Rank5"; 31:60="R_Rank4"; 61:90="R_Rank3"; 91:180="R_Rank2"; else="R_Rank1"; ;'</span>, <span class="at">as.factor=</span><span class="cn">TRUE</span>, </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">to.value=</span><span class="st">"="</span>, <span class="at">interval=</span><span class="st">":"</span>, <span class="at">separator=</span><span class="st">";"</span>)</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="fu">Boxplot</span>(F <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset, <span class="at">id=</span><span class="fu">list</span>(<span class="at">method=</span><span class="st">"y"</span>))</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TH.data, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind, <span class="at">pos=</span><span class="dv">21</span>)</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>AnovaModel<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">aov</span>(M <span class="sc">~</span> R_Rank, <span class="at">data=</span>Dataset)</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AnovaModel<span class="fl">.2</span>)</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">numSummary</span>(M, <span class="at">groups=</span>R_Rank, <span class="at">statistics=</span><span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>)))</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  .Pairs <span class="ot">&lt;-</span> <span class="fu">glht</span>(AnovaModel<span class="fl">.2</span>, <span class="at">linfct =</span> <span class="fu">mcp</span>(<span class="at">R_Rank =</span> <span class="st">"Tukey"</span>))</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(.Pairs)) <span class="co"># pairwise tests</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">confint</span>(.Pairs, <span class="at">level=</span><span class="fl">0.95</span>)) <span class="co"># confidence intervals</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">cld</span>(.Pairs, <span class="at">level=</span><span class="fl">0.05</span>)) <span class="co"># compact letter display</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  old.oma <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">confint</span>(.Pairs))</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(old.oma)</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-16" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-16">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>M_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>M,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">49999</span>, <span class="dv">99999</span>, <span class="dv">299999</span>, <span class="dv">499999</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"M_Rank"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>F_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>F,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">29</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"F_Rank"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>R_Rank <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>  Dataset<span class="sc">$</span>R,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">180</span>, <span class="cn">Inf</span>),</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"R_Rank"</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>R_Rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(Dataset<span class="sc">$</span>R_Rank, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(Dataset<span class="sc">$</span>R_Rank)))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Boxplot()</code> は <code>car</code> パッケージの関数である。 <code>car</code> パッケージを使わなくても，<code>boxplot()</code> で同じ図が作成できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(M <span class="sc">~</span> R_Rank, <span class="at">data =</span> Dataset, <span class="at">col =</span> <span class="st">"gray"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(F <span class="sc">~</span> R_Rank, <span class="at">data =</span> Dataset, <span class="at">col =</span> <span class="st">"gray"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-71-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>AnovaModel_2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(M <span class="sc">~</span> R_Rank, <span class="at">data =</span> Dataset)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(AnovaModel_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Df    Sum Sq   Mean Sq F value Pr(&gt;F)    
R_Rank         4 2.054e+12 5.134e+11   20.78 &lt;2e-16 ***
Residuals   1995 4.929e+13 2.471e+10                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Rコマンダーでは，<code>RcmdrMisc</code> パッケージの関数 <code>lineplot()</code> でTukeyのHSD検定を行っているので，Rコマンダーを使わない場合はこの関数は使えない。 代わりに，次のコードで同様の結果が得られる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="fu">tapply</span>(Dataset<span class="sc">$</span>M, Dataset<span class="sc">$</span>R_Rank, mean)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">tapply</span>(Dataset<span class="sc">$</span>M, Dataset<span class="sc">$</span>R_Rank, sd)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">R_Rank =</span> <span class="fu">names</span>(mean), <span class="at">mean =</span> mean, <span class="at">sd =</span> sd)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         R_Rank     mean       sd
R_Rank1 R_Rank1 209930.0 151138.6
R_Rank2 R_Rank2 225057.9 152059.6
R_Rank3 R_Rank3 247259.6 152568.9
R_Rank4 R_Rank4 281963.5 156606.0
R_Rank5 R_Rank5 306564.1 161327.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>Tukey_Result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(AnovaModel_2, <span class="st">"R_Rank"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>Tukey_Result</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = M ~ R_Rank, data = Dataset)

$R_Rank
                    diff        lwr       upr     p adj
R_Rank2-R_Rank1 15127.90 -42195.595  72451.39 0.9518249
R_Rank3-R_Rank1 37329.65 -25238.093  99897.40 0.4789160
R_Rank4-R_Rank1 72033.53  17020.899 127046.17 0.0032962
R_Rank5-R_Rank1 96634.17  41964.001 151304.34 0.0000148
R_Rank3-R_Rank2 22201.75 -19061.973  63465.48 0.5828362
R_Rank4-R_Rank2 56905.63  28368.600  85442.67 0.0000006
R_Rank5-R_Rank2 81506.27  53635.143 109377.40 0.0000000
R_Rank4-R_Rank3 34703.88  -3284.302  72692.06 0.0922935
R_Rank5-R_Rank3 59304.52  21813.992  96795.04 0.0001599
R_Rank5-R_Rank4 24600.64   1858.459  47342.81 0.0263635</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Tukey_Result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>tukey_pvalues <span class="ot">&lt;-</span> Tukey_Result<span class="sc">$</span>R_Rank[, <span class="st">"p adj"</span>]</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>cld_results <span class="ot">&lt;-</span> <span class="fu">multcompLetters</span>(tukey_pvalues)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>cld_results</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R_Rank2 R_Rank3 R_Rank4 R_Rank5 R_Rank1 
    "a"    "ab"     "b"     "c"     "a" </code></pre>
</div>
</div>
</section>
</section>
<section id="ロジスティック回帰分析" class="level4">
<h4 class="anchored" data-anchor-id="ロジスティック回帰分析">4.2 ロジスティック回帰分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;226</p>
<ul>
<li>（誤）一般化線形モデル</li>
<li>（正）一般化線型モデル</li>
</ul>
<p>これはRコマンダーの翻訳ミスであろう。同様の翻訳ミスはこの箇所以降にも見られる。</p>
</div>
</div>
</div>
<section id="rコマンダーによって生成されたコードp.-220-1" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-220-1">▶ Rコマンダーによって生成されたコード（p.&nbsp;220）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(DM <span class="sc">~</span> <span class="fu">log</span>(M)<span class="sc">+</span><span class="fu">log</span>(F)<span class="sc">+</span><span class="fu">log</span>(R), <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>Dataset)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.3</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.3</span>))  <span class="co"># Exponentiated coefficients ("odds ratios")</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-17" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-17">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>Dataset<span class="sc">$</span>DM <span class="ot">&lt;-</span> <span class="fu">factor</span>(Dataset<span class="sc">$</span>DM, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset$DM01 &lt;- ifelse(Dataset$DM == "yes", 1, 0)</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(DM <span class="sc">~</span> <span class="fu">log</span>(M) <span class="sc">+</span> <span class="fu">log</span>(F) <span class="sc">+</span> <span class="fu">log</span>(R), <span class="at">family =</span> <span class="fu">binomial</span>(logit), <span class="at">data =</span> Dataset)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = DM ~ log(M) + log(F) + log(R), family = binomial(logit), 
    data = Dataset)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -11.94177    1.05258 -11.345  &lt; 2e-16 ***
log(M)        0.79688    0.08450   9.431  &lt; 2e-16 ***
log(F)        1.29098    0.09949  12.977  &lt; 2e-16 ***
log(R)       -0.47586    0.06170  -7.712 1.24e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2614.8  on 1999  degrees of freedom
Residual deviance: 1873.8  on 1996  degrees of freedom
AIC: 1881.8

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.3</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)       log(M)       log(F)       log(R) 
6.512621e-06 2.218618e+00 3.636348e+00 6.213502e-01 </code></pre>
</div>
</div>
<p>Rコマンダーは，どうやら内部で <code>DM</code> 列をファクターに変換しているようである。 実際には，<code>factor()</code> を適用するか，<code>ifelse()</code> でダミー変数に変換すればよい。 ダミー変数に変換した場合は，値も変わってしまうため，列名を変更することを推奨する。</p>
</section>
</section>
</section>
</section>
<section id="第11章-市場反応分析ii" class="level2">
<h2 class="anchored" data-anchor-id="第11章-市場反応分析ii">第11章 市場反応分析（II）</h2>
<section id="rコマンダーによる分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによる分析">3 Rコマンダーによる分析</h3>
<section id="ブランド価値を含むモデル" class="level4">
<h4 class="anchored" data-anchor-id="ブランド価値を含むモデル">3.1 ブランド価値を含むモデル</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> P1<span class="sc">-</span>P2, <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>Dataset)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.1</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.1</span>))  <span class="co"># Exponentiated coefficients ("odds ratios")</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> P1 <span class="sc">-</span> P2, <span class="at">family=</span><span class="fu">binomial</span>(probit), <span class="at">data=</span>Dataset)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="一般的なrコード-18" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-18">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>GLM_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> P1 <span class="sc">-</span> P2, <span class="at">family =</span> <span class="fu">binomial</span>(logit), <span class="at">data =</span> Dataset)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM_1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = B1 ~ P1 - P2, family = binomial(logit), data = Dataset)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 11.539963   3.637441   3.173 0.001511 ** 
P1          -0.030168   0.008989  -3.356 0.000791 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 55.352  on 39  degrees of freedom
Residual deviance: 28.919  on 38  degrees of freedom
AIC: 32.919

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM_1))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)           P1 
1.027407e+05 9.702822e-01 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>GLM_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> P1 <span class="sc">-</span> P2, <span class="at">family =</span> <span class="fu">binomial</span>(probit), <span class="at">data =</span> Dataset)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM_2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = B1 ~ P1 - P2, family = binomial(probit), data = Dataset)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  6.592380   1.880669   3.505 0.000456 ***
P1          -0.017215   0.004648  -3.703 0.000213 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 55.352  on 39  degrees of freedom
Residual deviance: 29.165  on 38  degrees of freedom
AIC: 33.165

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p><code>binomial-choice.txt</code> もヘッダーのみスペース区切りで，データはタブ区切りになっている。 タブ区切りのデータはヘッダーもタブ区切りであるのが普通であり，本書で扱うデータが特殊であることを認識しておく必要がある。</p>
</section>
<section id="rコマンダーによって生成されたコードp.-240" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-240">▶ Rコマンダーによって生成されたコード（p.&nbsp;240）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>GLM<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P1 <span class="sc">-</span> P2, <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>Dataset)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM<span class="fl">.3</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM<span class="fl">.3</span>))  <span class="co"># Exponentiated coefficients ("odds ratios")</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-19" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-19">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>GLM_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(B1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> P1 <span class="sc">-</span> P2, <span class="at">family =</span> <span class="fu">binomial</span>(logit), <span class="at">data =</span> Dataset)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GLM_3)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = B1 ~ 0 + P1 - P2, family = binomial(logit), data = Dataset)

Coefficients:
     Estimate Std. Error z value Pr(&gt;|z|)
P1 -0.0011618  0.0008517  -1.364    0.173

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 55.452  on 40  degrees of freedom
Residual deviance: 53.537  on 39  degrees of freedom
AIC: 55.537

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(GLM_3))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       P1 
0.9988388 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="多項離散選択モデル" class="level3">
<h3 class="anchored" data-anchor-id="多項離散選択モデル">4 多項離散選択モデル</h3>
<section id="rによる分析多項ロジットモデルの推定" class="level4">
<h4 class="anchored" data-anchor-id="rによる分析多項ロジットモデルの推定">4.1 Rによる分析：多項ロジット・モデルの推定</h4>
<section id="rコマンダーによって生成されたコードp.-241" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-241">▶ Rコマンダーによって生成されたコード（p.&nbsp;241）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlogit, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Catsup, <span class="at">package=</span><span class="st">"mlogit"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコードmlogit.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードmlogit.r">▶ 手入力するコード（<code>mlogit.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlogit)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Catsup)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>Catdata <span class="ot">&lt;-</span> <span class="fu">mlogit.data</span>(Catsup, <span class="at">choice =</span> <span class="st">"choice"</span>, <span class="at">shape =</span> <span class="st">"wide"</span>, <span class="at">varying =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>), <span class="at">sep=</span><span class="st">"."</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>Cat1<span class="ot">&lt;-</span><span class="fu">mlogit</span>(choice <span class="sc">~</span> disp<span class="sc">+</span>feat<span class="sc">+</span>price , <span class="at">data =</span> Catdata)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cat1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-20" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-20">▶ 一般的なRコード</h5>
<p><code>mlogit</code> パッケージをインストールしたことがなければ，最初に次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"mlogit"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>その後，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlogit)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Catsup)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>Catdata <span class="ot">&lt;-</span> <span class="fu">mlogit.data</span>(Catsup, <span class="at">choice =</span> <span class="st">"choice"</span>, <span class="at">shape =</span> <span class="st">"wide"</span>, <span class="at">varying =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>), <span class="at">sep =</span> <span class="st">"."</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>Cat1 <span class="ot">&lt;-</span> <span class="fu">mlogit</span>(choice <span class="sc">~</span> disp <span class="sc">+</span> feat <span class="sc">+</span> price , <span class="at">data =</span> Catdata)</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cat1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
mlogit(formula = choice ~ disp + feat + price, data = Catdata, 
    method = "nr")

Frequencies of alternatives:choice
 heinz28  heinz32  heinz41  hunts32 
0.304146 0.521086 0.065046 0.109721 

nr method
5 iterations, 0h:0m:0s 
g'(-H)^-1g = 0.00292 
successive function values within tolerance limits 

Coefficients :
                     Estimate Std. Error  z-value  Pr(&gt;|z|)    
(Intercept):heinz32 -0.924723   0.077218 -11.9755 &lt; 2.2e-16 ***
(Intercept):heinz41 -1.072272   0.087321 -12.2796 &lt; 2.2e-16 ***
(Intercept):hunts32 -2.425974   0.096189 -25.2209 &lt; 2.2e-16 ***
disp                 0.875593   0.097014   9.0254 &lt; 2.2e-16 ***
feat                 0.908559   0.114030   7.9677 1.554e-15 ***
price               -1.402405   0.057991 -24.1832 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log-Likelihood: -2517.9
McFadden R^2:  0.19788 
Likelihood ratio test : chisq = 1242.3 (p.value = &lt; 2.22e-16)</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第12章-ブランドと属性の同時マップ" class="level2">
<h2 class="anchored" data-anchor-id="第12章-ブランドと属性の同時マップ">第12章 ブランドと属性の同時マップ</h2>
<section id="質的変数の関連性" class="level3">
<h3 class="anchored" data-anchor-id="質的変数の関連性">1 質的変数の関連性</h3>
<section id="rコマンダーによる質的変数の独立性の検定" class="level4">
<h4 class="anchored" data-anchor-id="rコマンダーによる質的変数の独立性の検定">1.2 Rコマンダーによる質的変数の独立性の検定</h4>
<section id="rコマンダーによって生成されたコードp.-251" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-251">▶ Rコマンダーによって生成されたコード（p.&nbsp;251）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abind, <span class="at">pos=</span><span class="dv">16</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>.Table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">75</span>,<span class="dv">80</span>,<span class="dv">145</span>,<span class="dv">125</span>,<span class="dv">90</span>,<span class="dv">85</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(.Table) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"地域"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>), <span class="st">"嗜好"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>))</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>.Table  <span class="co"># Counts</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>.Test <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(.Table, <span class="at">correct=</span><span class="cn">FALSE</span>)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>.Test</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>.Test<span class="sc">$</span>expected <span class="co"># Expected Counts</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(.Test<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="co"># Chi-square Components</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.Test)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(.Table)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-21" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-21">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>Table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">145</span>, <span class="dv">125</span>, <span class="dv">90</span>, <span class="dv">85</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(Table) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"地域"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>), <span class="st">"嗜好"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>))</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>Table</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    嗜好
地域   1  2   3
   1  75 80 145
   2 125 90  85</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>Test <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(Table, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>Test</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  Table
X-squared = 28.74, df = 2, p-value = 5.742e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>Test<span class="sc">$</span>expected</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    嗜好
地域   1  2   3
   1 100 85 115
   2 100 85 115</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Test<span class="sc">$</span>residuals <span class="sc">^</span> <span class="dv">2</span>, <span class="dv">2</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    嗜好
地域    1    2    3
   1 6.25 0.29 7.83
   2 6.25 0.29 7.83</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="rコマンダーによるコレスポンデンス分析" class="level3">
<h3 class="anchored" data-anchor-id="rコマンダーによるコレスポンデンス分析">3 Rコマンダーによるコレスポンデンス分析</h3>
<section id="実行手順" class="level4">
<h4 class="anchored" data-anchor-id="実行手順">3.1 実行手順</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;256</p>
<ul>
<li>（誤）次にRコマンダーウィンドウのツールバー【ツール】⇒【Rcmdrプラグインのロード】へ進むと「RcmdrPlugin. FactoMineR」の選択画面が現れ，【OK】をクリックして選択する。</li>
<li>（正）インストール後，一度Rコマンダーを終了し，Rも終了する。その後，再び，RとRコマンダーを起動する。次にRコマンダーウィンドウのツールバー【ツール】⇒【Rcmdrプラグインのロード】へ進むと「RcmdrPlugin.FactoMineR」の選択画面が現れ，【OK】をクリックして選択する。</li>
</ul>
<p>p.&nbsp;257</p>
<ul>
<li>（誤）Perform clustring on</li>
<li>（正）Perform clustering on</li>
</ul>
<p>p.&nbsp;257</p>
<ul>
<li>（誤）“iterative”をを選択</li>
<li>（正）“interactive”を選択</li>
</ul>
</div>
</div>
</div>
<p>プラグイン <code>RcmdrPlugin.FactoMineR</code> をインストールしたことがなければ，最初に次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"RcmdrPlugin.FactoMineR"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>なお，Rコマンダーを使わない場合は，このプラグインのインストールは不要である。</p>
<section id="rコマンダーによって生成されたコードp.-256" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-256">▶ Rコマンダーによって生成されたコード（p.&nbsp;256）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>Dataset.CA<span class="ot">&lt;-</span>Dataset[<span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, <span class="st">"9"</span>, <span class="st">"10"</span>) ,<span class="fu">c</span>(<span class="st">"デザイン"</span>, <span class="st">"使いやすさ"</span>, <span class="st">"パワー"</span>, <span class="st">"静音性"</span>, <span class="st">"サイズ"</span>, <span class="st">"手入れのしやすさ"</span>, <span class="st">"取り回し"</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"満足度"</span>)]</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">CA</span>(Dataset.CA, <span class="at">ncp=</span><span class="dv">5</span>, <span class="at">row.sup=</span><span class="cn">NULL</span>, <span class="at">col.sup=</span><span class="cn">NULL</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot.CA</span>(res, <span class="at">axes=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col.row=</span><span class="st">"red"</span>, <span class="at">col.col=</span><span class="st">"blue"</span>, <span class="at">label=</span><span class="fu">c</span>(<span class="st">"col"</span>, <span class="st">"col.sup"</span>, <span class="st">"row"</span>, <span class="st">"row.sup"</span>)))</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res, <span class="at">nb.dec =</span> <span class="dv">3</span>, <span class="at">nbelements=</span><span class="dv">10</span>, <span class="at">nbind =</span> <span class="dv">10</span>, <span class="at">ncp =</span> <span class="dv">3</span>, <span class="at">file=</span><span class="st">""</span>)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(Dataset.CA)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>Dataset.CA<span class="ot">&lt;-</span>Dataset[<span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, <span class="st">"9"</span>, <span class="st">"10"</span>) ,<span class="fu">c</span>(<span class="st">"デザイン"</span>, <span class="st">"使いやすさ"</span>, <span class="st">"パワー"</span>, <span class="st">"静音性"</span>, <span class="st">"サイズ"</span>, <span class="st">"手入れのしやすさ"</span>, <span class="st">"取り回し"</span>,</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>   <span class="st">"満足度"</span>)]</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">CA</span>(Dataset.CA, <span class="at">ncp=</span><span class="dv">5</span>, <span class="at">row.sup=</span><span class="cn">NULL</span>, <span class="at">col.sup=</span><span class="cn">NULL</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot.CA</span>(res, <span class="at">axes=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col.row=</span><span class="st">"red"</span>, <span class="at">col.col=</span><span class="st">"blue"</span>, <span class="at">label=</span><span class="fu">c</span>(<span class="st">"col"</span>, <span class="st">"col.sup"</span>, <span class="st">"row"</span>, <span class="st">"row.sup"</span>)))</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>res.hcpc<span class="ot">&lt;-</span><span class="fu">HCPC</span>(res ,<span class="at">nb.clust=</span><span class="dv">0</span>,<span class="at">consol=</span><span class="cn">FALSE</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">cluster.CA=</span><span class="st">"rows"</span>,<span class="at">graph=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res, <span class="at">nb.dec =</span> <span class="dv">3</span>, <span class="at">nbelements=</span><span class="dv">10</span>, <span class="at">nbind =</span> <span class="dv">10</span>, <span class="at">ncp =</span> <span class="dv">3</span>, <span class="at">file=</span><span class="st">""</span>)</span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(Dataset.CA)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-22" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-22">▶ 一般的なRコード</h5>
<p><code>FactoMineR</code> パッケージをインストールしたことがなければ，最初に次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"FactoMineR"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>その後，次のコードを実行する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>Dataset.CA <span class="ot">&lt;-</span> Dataset[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">CA</span>(Dataset.CA, <span class="at">ncp =</span> <span class="dv">5</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.CA</span>(res, <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col.row =</span> <span class="st">"red"</span>, <span class="at">col.col =</span> <span class="st">"blue"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>この図のように文字化けする場合は，仕方ないと諦める。 macOSのRでは，日本語部分が文字化けしやすいと認識しておいてほしい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>res.hcpc <span class="ot">&lt;-</span> <span class="fu">HCPC</span>(res, <span class="at">nb.clust =</span> <span class="dv">0</span>, <span class="at">consol =</span> <span class="cn">FALSE</span>, <span class="at">cluster.CA =</span> <span class="st">"rows"</span>, <span class="at">graph =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(res.hcpc, choice = "tree")</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(res.hcpc, choice = "map")</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-93-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
CA(X = Dataset.CA, ncp = 5, graph = FALSE) 

The chi square of independence between the two variables is equal to 2.250722 (p-value =  1 ).

Eigenvalues
                       Dim.1   Dim.2   Dim.3   Dim.4   Dim.5   Dim.6   Dim.7
Variance               0.004   0.001   0.001   0.000   0.000   0.000   0.000
% of var.             61.704  17.718  11.254   5.552   3.242   0.467   0.063
Cumulative % of var.  61.704  79.422  90.676  96.228  99.470  99.937 100.000

Rows
           Iner*1000    Dim.1    ctr   cos2    Dim.2    ctr   cos2    Dim.3
1        |     0.324 |  0.013  0.457  0.056 | -0.018  2.769  0.097 | -0.049
2        |     0.174 | -0.038  3.741  0.853 |  0.009  0.724  0.047 |  0.005
3        |     1.506 | -0.101 25.371  0.669 |  0.066 37.088  0.281 | -0.022
4        |     0.434 | -0.049  6.278  0.574 | -0.015  2.119  0.056 |  0.024
5        |     0.557 |  0.055  7.637  0.544 | -0.027  6.697  0.137 | -0.039
6        |     0.298 | -0.033  2.612  0.348 |  0.007  0.466  0.018 |  0.015
7        |     0.689 | -0.057  8.019  0.462 | -0.049 20.068  0.332 |  0.019
8        |     1.277 |  0.100 25.618  0.796 |  0.033  9.824  0.088 |  0.037
9        |     0.948 |  0.087 19.479  0.815 |  0.030  8.143  0.098 | -0.004
10       |     0.225 |  0.018  0.790  0.139 | -0.038 12.101  0.613 |  0.014
            ctr   cos2  
1        33.184  0.742 |
2         0.291  0.012 |
3         6.483  0.031 |
4         8.524  0.142 |
5        21.328  0.277 |
6         3.118  0.076 |
7         4.913  0.052 |
8        19.159  0.109 |
9         0.272  0.002 |
10        2.728  0.088 |

Columns
                   Iner*1000    Dim.1    ctr   cos2    Dim.2    ctr   cos2  
デザイン         |     0.462 |  0.001  0.007  0.001 | -0.028  8.955  0.221 |
使いやすさ       |     0.322 |  0.013  0.593  0.073 |  0.023  5.923  0.210 |
パワー           |     0.823 |  0.042  5.851  0.282 | -0.062 45.015  0.624 |
静音性           |     2.094 |  0.126 43.758  0.829 |  0.049 22.594  0.123 |
サイズ           |     1.963 | -0.125 45.722  0.924 |  0.017  3.006  0.017 |
手入れのしやすさ |     0.335 | -0.005  0.097  0.011 | -0.011  1.344  0.046 |
取り回し         |     0.359 | -0.032  3.228  0.356 |  0.034 12.278  0.389 |
満足度           |     0.073 | -0.015  0.745  0.404 | -0.009  0.885  0.138 |
                  Dim.3    ctr   cos2  
デザイン          0.046 37.567  0.589 |
使いやすさ       -0.033 19.798  0.445 |
パワー           -0.003  0.143  0.001 |
静音性            0.020  5.933  0.021 |
サイズ            0.015  3.405  0.013 |
手入れのしやすさ -0.042 30.561  0.660 |
取り回し          0.010  1.684  0.034 |
満足度           -0.007  0.908  0.090 |</code></pre>
</div>
</div>
</section>
</section>
<section id="デジタルカメラの事例" class="level4">
<h4 class="anchored" data-anchor-id="デジタルカメラの事例">3.2 デジタルカメラの事例</h4>
<section id="rコマンダーによって生成されたコードp.-260" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-260">▶ Rコマンダーによって生成されたコード（p.&nbsp;260）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">"¥t"</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>Dataset.CA<span class="ot">&lt;-</span>Dataset[<span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, <span class="st">"9"</span>, <span class="st">"10"</span>) ,<span class="fu">c</span>(<span class="st">"デザイン"</span>, <span class="st">"画質"</span>, <span class="st">"操作性"</span>, <span class="st">"バッテリー"</span>, <span class="st">"携帯性"</span>, <span class="st">"機能性"</span>, <span class="st">"液晶"</span>, </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ホールド感"</span>, <span class="st">"満足度"</span>)]</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">CA</span>(Dataset.CA, <span class="at">ncp=</span><span class="dv">5</span>, <span class="at">row.sup=</span><span class="cn">NULL</span>, <span class="at">col.sup=</span><span class="cn">NULL</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">plot.CA</span>(res, <span class="at">axes=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col.row=</span><span class="st">"red"</span>, <span class="at">col.col=</span><span class="st">"blue"</span>, <span class="at">label=</span><span class="fu">c</span>(<span class="st">"col"</span>, <span class="st">"col.sup"</span>, <span class="st">"row"</span>, <span class="st">"row.sup"</span>)))</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>res.hcpc<span class="ot">&lt;-</span><span class="fu">HCPC</span>(res ,<span class="at">nb.clust=</span><span class="dv">0</span>,<span class="at">consol=</span><span class="cn">FALSE</span>,<span class="at">min=</span><span class="dv">3</span>,<span class="at">max=</span><span class="dv">10</span>,<span class="at">cluster.CA=</span><span class="st">"rows"</span>,<span class="at">graph=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res, <span class="at">nb.dec =</span> <span class="dv">3</span>, <span class="at">nbelements=</span><span class="dv">10</span>, <span class="at">nbind =</span> <span class="dv">10</span>, <span class="at">ncp =</span> <span class="dv">3</span>, <span class="at">file=</span><span class="st">""</span>)</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(Dataset.CA)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-23" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-23">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"¥t"</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>Dataset.CA <span class="ot">&lt;-</span> Dataset[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">CA</span>(Dataset.CA, <span class="at">ncp =</span> <span class="dv">5</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.CA</span>(res, <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col.row =</span> <span class="st">"red"</span>, <span class="at">col.col =</span> <span class="st">"blue"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>res.hcpc <span class="ot">&lt;-</span> <span class="fu">HCPC</span>(res, <span class="at">nb.clust =</span> <span class="dv">0</span>, <span class="at">consol =</span> <span class="cn">FALSE</span>, <span class="at">cluster.CA =</span> <span class="st">"rows"</span>, <span class="at">graph =</span> <span class="cn">TRUE</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(res.hcpc, choice = "tree")</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(res.hcpc, choice = "map")</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-99-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
CA(X = Dataset.CA, ncp = 5, graph = FALSE) 

The chi square of independence between the two variables is equal to 2.45364 (p-value =  1 ).

Eigenvalues
                       Dim.1   Dim.2   Dim.3   Dim.4   Dim.5   Dim.6   Dim.7
Variance               0.004   0.001   0.001   0.000   0.000   0.000   0.000
% of var.             56.904  21.000  13.598   4.015   3.011   0.865   0.571
Cumulative % of var.  56.904  77.904  91.501  95.516  98.528  99.393  99.964
                       Dim.8
Variance               0.000
% of var.              0.036
Cumulative % of var. 100.000

Rows
        Iner*1000    Dim.1    ctr   cos2    Dim.2    ctr   cos2    Dim.3    ctr
1     |     0.272 |  0.040  4.875  0.631 |  0.021  3.844  0.184 |  0.013  2.146
2     |     0.133 | -0.004  0.037  0.010 | -0.014  1.710  0.167 |  0.017  3.815
3     |     1.071 | -0.076 14.081  0.463 |  0.003  0.046  0.001 | -0.081 67.182
4     |     0.175 |  0.033  3.073  0.620 |  0.014  1.546  0.115 | -0.006  0.454
5     |     0.199 |  0.002  0.015  0.003 |  0.032  7.962  0.521 |  0.012  1.669
6     |     0.329 |  0.030  2.530  0.271 | -0.028  5.737  0.227 |  0.006  0.399
7     |     0.286 |  0.022  1.315  0.162 | -0.039 11.372  0.516 |  0.021  5.159
8     |     2.376 | -0.157 62.591  0.928 |  0.017  1.890  0.010 |  0.037 14.679
9     |     0.792 |  0.060 10.675  0.475 |  0.060 29.294  0.481 | -0.012  1.834
10    |     0.559 |  0.017  0.807  0.051 | -0.068 36.599  0.852 | -0.015  2.665
        cos2  
1      0.066 |
2      0.241 |
3      0.528 |
4      0.022 |
5      0.071 |
6      0.010 |
7      0.152 |
8      0.052 |
9      0.019 |
10     0.040 |

Columns
             Iner*1000    Dim.1    ctr   cos2    Dim.2    ctr   cos2    Dim.3
デザイン   |     0.024 |  0.000  0.000  0.000 | -0.005  0.222  0.121 | -0.008
画質       |     0.541 | -0.054  9.546  0.622 | -0.015  2.027  0.049 |  0.022
操作性     |     0.408 | -0.037  4.233  0.365 |  0.035 10.032  0.319 |  0.002
バッテリー |     2.471 |  0.156 68.081  0.971 | -0.021  3.459  0.018 | -0.003
携帯性     |     0.705 | -0.016  0.807  0.040 | -0.052 22.546  0.416 |  0.054
機能性     |     0.212 |  0.026  2.164  0.360 | -0.015  1.874  0.115 | -0.025
液晶       |     0.430 | -0.028  2.671  0.219 | -0.006  0.316  0.010 | -0.049
ホールド感 |     0.991 |  0.032  3.080  0.110 |  0.086 59.462  0.781 |  0.028
満足度     |     0.410 | -0.052  9.418  0.810 | -0.003  0.061  0.002 | -0.015
              ctr   cos2  
デザイン    0.910  0.321 |
画質        6.808  0.106 |
操作性      0.031  0.001 |
バッテリー  0.076  0.000 |
携帯性     37.700  0.450 |
機能性      8.171  0.325 |
液晶       33.573  0.657 |
ホールド感  9.480  0.081 |
満足度      3.251  0.067 |</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第13章-マーケットバスケットとクロスセリング" class="level2">
<h2 class="anchored" data-anchor-id="第13章-マーケットバスケットとクロスセリング">第13章 マーケットバスケットとクロスセリング</h2>
<section id="rによるマーケットバスケット分析" class="level3">
<h3 class="anchored" data-anchor-id="rによるマーケットバスケット分析">3 Rによるマーケットバスケット分析</h3>
<section id="rコマンダーによって生成されたコードp.-272" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-272">▶ Rコマンダーによって生成されたコード（p.&nbsp;272）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="手入力するコードarules.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードarules.r">▶ 手入力するコード（<code>arules.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>y.tran<span class="ot">&lt;-</span><span class="fu">as</span>(<span class="fu">as.matrix</span>(y),<span class="st">"transactions"</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(y.tran, <span class="at">parameter=</span> <span class="fu">list</span>(<span class="at">supp=</span><span class="fl">0.4</span>, <span class="at">conf=</span><span class="fl">0.5</span>))</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rules)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(<span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>),<span class="at">n=</span><span class="dv">20</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-24" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-24">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>(), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>y_tran <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">as.matrix</span>(y), <span class="st">"transactions"</span>)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y); <span class="fu">class</span>(y_tran)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "transactions"
attr(,"package")
[1] "arules"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(y_tran, <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp =</span> <span class="fl">0.4</span>, <span class="at">conf =</span> <span class="fl">0.5</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport maxtime support minlen
        0.5    0.1    1 none FALSE            TRUE       5     0.4      1
 maxlen target  ext
     10  rules TRUE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 400 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[20 item(s), 1000 transaction(s)] done [0.00s].
sorting and recoding items ... [17 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 done [0.00s].
writing ... [118 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rules)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>set of 118 rules

rule length distribution (lhs + rhs):sizes
 1  2  3 
14 92 12 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   2.000   2.000   1.983   2.000   3.000 

summary of quality measures:
    support         confidence        coverage          lift       
 Min.   :0.4010   Min.   :0.5000   Min.   :0.484   Min.   :0.9652  
 1st Qu.:0.4208   1st Qu.:0.6402   1st Qu.:0.634   1st Qu.:0.9958  
 Median :0.4430   Median :0.6694   Median :0.646   Median :1.0013  
 Mean   :0.4790   Mean   :0.6935   Mean   :0.700   Mean   :1.0302  
 3rd Qu.:0.5068   3rd Qu.:0.7792   3rd Qu.:0.780   3rd Qu.:1.0189  
 Max.   :0.7940   Max.   :0.9855   Max.   :1.000   Max.   :1.5399  
     count      
 Min.   :401.0  
 1st Qu.:420.8  
 Median :443.0  
 Mean   :479.0  
 3rd Qu.:506.8  
 Max.   :794.0  

mining info:
   data ntransactions support confidence
 y_tran          1000     0.4        0.5
                                                             call
 apriori(data = y_tran, parameter = list(supp = 0.4, conf = 0.5))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(<span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="at">n =</span> <span class="dv">20</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     lhs                     rhs            support confidence coverage
[1]  {炭酸飲料}           =&gt; {スナック菓子} 0.477   0.9855372  0.484   
[2]  {スナック菓子}       =&gt; {炭酸飲料}     0.477   0.7453125  0.640   
[3]  {根菜}               =&gt; {豚肉}         0.423   0.6558140  0.645   
[4]  {豚肉}               =&gt; {根菜}         0.423   0.8528226  0.496   
[5]  {牛乳, アイス}       =&gt; {スナック菓子} 0.418   0.8376754  0.499   
[6]  {スナック菓子}       =&gt; {アイス}       0.519   0.8109375  0.640   
[7]  {アイス}             =&gt; {スナック菓子} 0.519   0.8251192  0.629   
[8]  {牛乳, スナック菓子} =&gt; {アイス}       0.418   0.8069498  0.518   
[9]  {シャンプー}         =&gt; {リンス}       0.504   0.7949527  0.634   
[10] {リンス}             =&gt; {シャンプー}   0.504   0.7801858  0.646   
[11] {牛乳}               =&gt; {洗濯洗剤}     0.411   0.5176322  0.794   
[12] {洗濯洗剤}           =&gt; {牛乳}         0.411   0.8170974  0.503   
[13] {アイス}             =&gt; {チョコレート} 0.432   0.6868045  0.629   
[14] {チョコレート}       =&gt; {アイス}       0.432   0.6447761  0.670   
[15] {シャンプー}         =&gt; {チョコレート} 0.435   0.6861199  0.634   
[16] {チョコレート}       =&gt; {シャンプー}   0.435   0.6492537  0.670   
[17] {青菜}               =&gt; {チョコレート} 0.535   0.6858974  0.780   
[18] {チョコレート}       =&gt; {青菜}         0.535   0.7985075  0.670   
[19] {リンス}             =&gt; {根菜}         0.426   0.6594427  0.646   
[20] {根菜}               =&gt; {リンス}       0.426   0.6604651  0.645   
     lift     count
[1]  1.539902 477  
[2]  1.539902 477  
[3]  1.322206 423  
[4]  1.322206 423  
[5]  1.308868 418  
[6]  1.289249 519  
[7]  1.289249 519  
[8]  1.282909 418  
[9]  1.230577 504  
[10] 1.230577 504  
[11] 1.029090 411  
[12] 1.029090 411  
[13] 1.025081 432  
[14] 1.025081 432  
[15] 1.024060 435  
[16] 1.024060 435  
[17] 1.023728 535  
[18] 1.023728 535  
[19] 1.022392 426  
[20] 1.022392 426  </code></pre>
</div>
</div>
<p><code>rules</code> をデータフレームとして扱いたい場合は，次のようにするとよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>rules2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">lhs =</span> <span class="fu">labels</span>(<span class="fu">lhs</span>(rules)),</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">arrow =</span> <span class="st">"=&gt;"</span>,</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rhs =</span> <span class="fu">labels</span>(<span class="fu">rhs</span>(rules)),</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quality</span>(rules)</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>rules2[<span class="fu">order</span>(rules2<span class="sc">$</span>lift, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      lhs arrow            rhs support confidence coverage
15             {炭酸飲料}    =&gt; {スナック菓子}   0.477  0.9855372    0.484
16         {スナック菓子}    =&gt;     {炭酸飲料}   0.477  0.7453125    0.640
20                 {根菜}    =&gt;         {豚肉}   0.423  0.6558140    0.645
19                 {豚肉}    =&gt;         {根菜}   0.423  0.8528226    0.496
108         {牛乳,アイス}    =&gt; {スナック菓子}   0.418  0.8376754    0.499
56         {スナック菓子}    =&gt;       {アイス}   0.519  0.8109375    0.640
55               {アイス}    =&gt; {スナック菓子}   0.519  0.8251192    0.629
109   {牛乳,スナック菓子}    =&gt;       {アイス}   0.418  0.8069498    0.518
43           {シャンプー}    =&gt;       {リンス}   0.504  0.7949527    0.634
44               {リンス}    =&gt;   {シャンプー}   0.504  0.7801858    0.646
18                 {牛乳}    =&gt;     {洗濯洗剤}   0.411  0.5176322    0.794
17             {洗濯洗剤}    =&gt;         {牛乳}   0.411  0.8170974    0.503
57               {アイス}    =&gt; {チョコレート}   0.432  0.6868045    0.629
58         {チョコレート}    =&gt;       {アイス}   0.432  0.6447761    0.670
45           {シャンプー}    =&gt; {チョコレート}   0.435  0.6861199    0.634
46         {チョコレート}    =&gt;   {シャンプー}   0.435  0.6492537    0.670
98                 {青菜}    =&gt; {チョコレート}   0.535  0.6858974    0.780
97         {チョコレート}    =&gt;         {青菜}   0.535  0.7985075    0.670
65               {リンス}    =&gt;         {根菜}   0.426  0.6594427    0.646
66                 {根菜}    =&gt;       {リンス}   0.426  0.6604651    0.645
81                 {根菜}    =&gt;         {お茶}   0.452  0.7007752    0.645
82                 {お茶}    =&gt;         {根菜}   0.452  0.6579330    0.687
31                 {米菓}    =&gt;         {根菜}   0.419  0.6577708    0.637
32                 {根菜}    =&gt;         {米菓}   0.419  0.6496124    0.645
93         {スナック菓子}    =&gt;         {牛乳}   0.518  0.8093750    0.640
94                 {牛乳}    =&gt; {スナック菓子}   0.518  0.6523929    0.794
112           {青菜,牛乳}    =&gt;         {根菜}   0.401  0.6573770    0.610
26                 {青菜}    =&gt;     {台所洗剤}   0.434  0.5564103    0.780
25             {台所洗剤}    =&gt;         {青菜}   0.434  0.7948718    0.546
53               {アイス}    =&gt;       {リンス}   0.414  0.6581876    0.629
54               {リンス}    =&gt;       {アイス}   0.414  0.6408669    0.646
77                 {根菜}    =&gt; {スナック菓子}   0.420  0.6511628    0.645
78         {スナック菓子}    =&gt;         {根菜}   0.420  0.6562500    0.640
41           {シャンプー}    =&gt;       {アイス}   0.405  0.6388013    0.634
42               {アイス}    =&gt;   {シャンプー}   0.405  0.6438792    0.629
107 {スナック菓子,アイス}    =&gt;         {牛乳}   0.418  0.8053950    0.519
35                 {米菓}    =&gt;         {お茶}   0.443  0.6954474    0.637
36                 {お茶}    =&gt;         {米菓}   0.443  0.6448326    0.687
80         {チョコレート}    =&gt;         {根菜}   0.437  0.6522388    0.670
79                 {根菜}    =&gt; {チョコレート}   0.437  0.6775194    0.645
103                {お茶}    =&gt;         {牛乳}   0.550  0.8005822    0.687
104                {牛乳}    =&gt;         {お茶}   0.550  0.6926952    0.794
27             {台所洗剤}    =&gt;         {牛乳}   0.437  0.8003663    0.546
28                 {牛乳}    =&gt;     {台所洗剤}   0.437  0.5503778    0.794
83                 {根菜}    =&gt;         {青菜}   0.507  0.7860465    0.645
84                 {青菜}    =&gt;         {根菜}   0.507  0.6500000    0.780
85                 {根菜}    =&gt;         {牛乳}   0.516  0.8000000    0.645
86                 {牛乳}    =&gt;         {根菜}   0.516  0.6498741    0.794
114   {牛乳,チョコレート}    =&gt;         {青菜}   0.410  0.7854406    0.522
59               {アイス}    =&gt;         {お茶}   0.435  0.6915739    0.629
60                 {お茶}    =&gt;       {アイス}   0.435  0.6331878    0.687
87         {スナック菓子}    =&gt; {チョコレート}   0.431  0.6734375    0.640
88         {チョコレート}    =&gt; {スナック菓子}   0.431  0.6432836    0.670
95         {チョコレート}    =&gt;         {お茶}   0.462  0.6895522    0.670
96                 {お茶}    =&gt; {チョコレート}   0.462  0.6724891    0.687
115           {青菜,牛乳}    =&gt; {チョコレート}   0.410  0.6721311    0.610
49           {シャンプー}    =&gt;         {青菜}   0.496  0.7823344    0.634
50                 {青菜}    =&gt;   {シャンプー}   0.496  0.6358974    0.780
118           {青菜,牛乳}    =&gt;         {お茶}   0.420  0.6885246    0.610
37                 {米菓}    =&gt;         {青菜}   0.497  0.7802198    0.637
38                 {青菜}    =&gt;         {米菓}   0.497  0.6371795    0.780
1                      {}    =&gt;         {鶏肉}   0.500  0.5000000    1.000
2                      {}    =&gt;     {洗濯洗剤}   0.503  0.5030000    1.000
3                      {}    =&gt;         {牛肉}   0.528  0.5280000    1.000
4                      {}    =&gt;     {台所洗剤}   0.546  0.5460000    1.000
5                      {}    =&gt;         {米菓}   0.637  0.6370000    1.000
6                      {}    =&gt;   {シャンプー}   0.634  0.6340000    1.000
7                      {}    =&gt;       {アイス}   0.629  0.6290000    1.000
8                      {}    =&gt;       {リンス}   0.646  0.6460000    1.000
9                      {}    =&gt;         {根菜}   0.645  0.6450000    1.000
10                     {}    =&gt; {スナック菓子}   0.640  0.6400000    1.000
11                     {}    =&gt; {チョコレート}   0.670  0.6700000    1.000
12                     {}    =&gt;         {お茶}   0.687  0.6870000    1.000
13                     {}    =&gt;         {青菜}   0.780  0.7800000    1.000
14                     {}    =&gt;         {牛乳}   0.794  0.7940000    1.000
23                 {牛肉}    =&gt;         {牛乳}   0.419  0.7935606    0.528
24                 {牛乳}    =&gt;         {牛肉}   0.419  0.5277078    0.794
63               {アイス}    =&gt;         {牛乳}   0.499  0.7933227    0.629
64                 {牛乳}    =&gt;       {アイス}   0.499  0.6284635    0.794
39                 {米菓}    =&gt;         {牛乳}   0.505  0.7927786    0.637
40                 {牛乳}    =&gt;         {米菓}   0.505  0.6360202    0.794
101                {お茶}    =&gt;         {青菜}   0.534  0.7772926    0.687
102                {青菜}    =&gt;         {お茶}   0.534  0.6846154    0.780
111           {根菜,牛乳}    =&gt;         {青菜}   0.401  0.7771318    0.516
110           {青菜,根菜}    =&gt;         {牛乳}   0.401  0.7909270    0.507
33                 {米菓}    =&gt; {チョコレート}   0.425  0.6671900    0.637
34         {チョコレート}    =&gt;         {米菓}   0.425  0.6343284    0.670
69               {リンス}    =&gt; {チョコレート}   0.431  0.6671827    0.646
70         {チョコレート}    =&gt;       {リンス}   0.431  0.6432836    0.670
74                 {青菜}    =&gt;       {リンス}   0.501  0.6423077    0.780
73               {リンス}    =&gt;         {青菜}   0.501  0.7755418    0.646
67               {リンス}    =&gt; {スナック菓子}   0.411  0.6362229    0.646
68         {スナック菓子}    =&gt;       {リンス}   0.411  0.6421875    0.640
116           {青菜,お茶}    =&gt;         {牛乳}   0.420  0.7865169    0.534
71               {リンス}    =&gt;         {お茶}   0.439  0.6795666    0.646
72                 {お茶}    =&gt;       {リンス}   0.439  0.6390102    0.687
75               {リンス}    =&gt;         {牛乳}   0.506  0.7832817    0.646
76                 {牛乳}    =&gt;       {リンス}   0.506  0.6372796    0.794
91         {スナック菓子}    =&gt;         {青菜}   0.492  0.7687500    0.640
92                 {青菜}    =&gt; {スナック菓子}   0.492  0.6307692    0.780
105                {青菜}    =&gt;         {牛乳}   0.610  0.7820513    0.780
106                {牛乳}    =&gt;         {青菜}   0.610  0.7682620    0.794
29                 {米菓}    =&gt;       {リンス}   0.405  0.6357928    0.637
30               {リンス}    =&gt;         {米菓}   0.405  0.6269350    0.646
21                 {牛肉}    =&gt;         {青菜}   0.405  0.7670455    0.528
22                 {青菜}    =&gt;         {牛肉}   0.405  0.5192308    0.780
62                 {青菜}    =&gt;       {アイス}   0.482  0.6179487    0.780
61               {アイス}    =&gt;         {青菜}   0.482  0.7662957    0.629
52                 {牛乳}    =&gt;   {シャンプー}   0.494  0.6221662    0.794
51           {シャンプー}    =&gt;         {牛乳}   0.494  0.7791798    0.634
100                {牛乳}    =&gt; {チョコレート}   0.522  0.6574307    0.794
99         {チョコレート}    =&gt;         {牛乳}   0.522  0.7791045    0.670
89         {スナック菓子}    =&gt;         {お茶}   0.431  0.6734375    0.640
90                 {お茶}    =&gt; {スナック菓子}   0.431  0.6273654    0.687
117           {牛乳,お茶}    =&gt;         {青菜}   0.420  0.7636364    0.550
48                 {お茶}    =&gt;   {シャンプー}   0.424  0.6171761    0.687
47           {シャンプー}    =&gt;         {お茶}   0.424  0.6687697    0.634
113   {青菜,チョコレート}    =&gt;         {牛乳}   0.410  0.7663551    0.535
         lift count
15  1.5399019   477
16  1.5399019   477
20  1.3222056   423
19  1.3222056   423
108 1.3088677   418
56  1.2892488   519
55  1.2892488   519
109 1.2829091   418
43  1.2305769   504
44  1.2305769   504
18  1.0290899   411
17  1.0290899   411
57  1.0250813   432
58  1.0250813   432
45  1.0240595   435
46  1.0240595   435
98  1.0237275   535
97  1.0237275   535
65  1.0223918   426
66  1.0223918   426
81  1.0200512   452
82  1.0200512   452
31  1.0197997   419
32  1.0197997   419
93  1.0193640   518
94  1.0193640   518
112 1.0191892   401
26  1.0190664   434
25  1.0190664   434
53  1.0188663   414
54  1.0188663   414
77  1.0174419   420
78  1.0174419   420
41  1.0155823   405
42  1.0155823   405
107 1.0143514   418
35  1.0122961   443
36  1.0122961   443
80  1.0112230   437
79  1.0112230   437
103 1.0082900   550
104 1.0082900   550
27  1.0080180   437
28  1.0080180   437
83  1.0077519   507
84  1.0077519   507
85  1.0075567   516
86  1.0075567   516
114 1.0069751   410
59  1.0066578   435
60  1.0066578   435
87  1.0051306   431
88  1.0051306   431
95  1.0037150   462
96  1.0037150   462
115 1.0031808   410
49  1.0029928   496
50  1.0029928   496
118 1.0022192   420
37  1.0002818   497
38  1.0002818   497
1   1.0000000   500
2   1.0000000   503
3   1.0000000   528
4   1.0000000   546
5   1.0000000   637
6   1.0000000   634
7   1.0000000   629
8   1.0000000   646
9   1.0000000   645
10  1.0000000   640
11  1.0000000   670
12  1.0000000   687
13  1.0000000   780
14  1.0000000   794
23  0.9994466   419
24  0.9994466   419
63  0.9991470   499
64  0.9991470   499
39  0.9984618   505
40  0.9984618   505
101 0.9965289   534
102 0.9965289   534
111 0.9963228   401
110 0.9961298   401
33  0.9958059   425
34  0.9958059   425
69  0.9957950   431
70  0.9957950   431
74  0.9942844   501
73  0.9942844   501
67  0.9940983   411
68  0.9940983   411
116 0.9905754   420
71  0.9891799   439
72  0.9891799   439
75  0.9865009   506
76  0.9865009   506
91  0.9855769   492
92  0.9855769   492
105 0.9849512   610
106 0.9849512   610
29  0.9841993   405
30  0.9841993   405
21  0.9833916   405
22  0.9833916   405
62  0.9824304   482
61  0.9824304   482
52  0.9813348   494
51  0.9813348   494
100 0.9812399   522
99  0.9812399   522
89  0.9802584   431
90  0.9802584   431
117 0.9790210   420
48  0.9734639   424
47  0.9734639   424
113 0.9651828   410</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="第14章-定性調査データの分析" class="level2">
<h2 class="anchored" data-anchor-id="第14章-定性調査データの分析">第14章 定性調査データの分析</h2>
<section id="顧客満足度指数csi" class="level3">
<h3 class="anchored" data-anchor-id="顧客満足度指数csi">5 顧客満足度指数：CSI</h3>
<section id="rによる顧客満足度の分析" class="level4">
<h4 class="anchored" data-anchor-id="rによる顧客満足度の分析">5.6 Rによる顧客満足度の分析</h4>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;296</p>
<ul>
<li>（誤）(5) パス図作成のパッケージ“pathdiagram”および“DiagrammeR”をインストールする必要がある。Rのコードでは冒頭に install コマンドを記載している。</li>
<li>（正）(5) パス図作成のパッケージ“DiagrammeR”をインストールする必要がある。</li>
</ul>
</div>
</div>
</div>
<section id="手入力するコードsem-csi-cor.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードsem-csi-cor.r">▶ 手入力するコード（<code>SEM-CSI-Cor.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sem) <span class="co">#ライブラリの読み込み</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み#</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">readMoments</span>(</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag=</span><span class="cn">TRUE</span>, </span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names=</span><span class="fu">c</span>(</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y01"</span>, <span class="st">"y02"</span>, <span class="st">"y03"</span>, <span class="st">"y04"</span>, <span class="st">"y05"</span>, <span class="st">"y06"</span>, </span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y07"</span>, <span class="st">"y08"</span>, <span class="st">"y09"</span>, <span class="st">"y10"</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a><span class="fl">0.836</span> <span class="dv">1</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="fl">0.788</span> <span class="fl">0.841</span> <span class="dv">1</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="fl">0.532</span> <span class="fl">0.569</span> <span class="fl">0.646</span> <span class="dv">1</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a><span class="fl">0.459</span> <span class="fl">0.420</span> <span class="fl">0.378</span> <span class="fl">0.318</span> <span class="dv">1</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a><span class="fl">0.597</span> <span class="fl">0.625</span> <span class="fl">0.714</span> <span class="fl">0.597</span> <span class="fl">0.482</span> <span class="dv">1</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="fl">0.608</span> <span class="fl">0.639</span> <span class="fl">0.681</span> <span class="fl">0.604</span> <span class="fl">0.454</span> <span class="fl">0.708</span> <span class="dv">1</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a><span class="fl">0.762</span> <span class="fl">0.790</span> <span class="fl">0.821</span> <span class="fl">0.645</span> <span class="fl">0.343</span> <span class="fl">0.662</span> <span class="fl">0.647</span> <span class="dv">1</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="fl">0.629</span> <span class="fl">0.597</span> <span class="fl">0.666</span> <span class="fl">0.570</span> <span class="fl">0.271</span> <span class="fl">0.563</span> <span class="fl">0.588</span> <span class="fl">0.741</span> <span class="dv">1</span></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a><span class="fl">0.660</span> <span class="fl">0.581</span> <span class="fl">0.663</span> <span class="fl">0.472</span> <span class="fl">0.436</span> <span class="fl">0.626</span> <span class="fl">0.612</span> <span class="fl">0.694</span> <span class="fl">0.736</span> <span class="dv">1</span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a><span class="co">#モデルの作成#</span></span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a><span class="co">#測定方程式</span></span>
<span id="cb175-28"><a href="#cb175-28" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">specifyModel</span>()</span>
<span id="cb175-29"><a href="#cb175-29" aria-hidden="true" tabindex="-1"></a>  知覚品質 <span class="ot">-&gt;</span> y01, <span class="cn">NA</span>,  <span class="dv">1</span>　      <span class="co">#測定方程式, 識別性制約のため係数を１に固定</span></span>
<span id="cb175-30"><a href="#cb175-30" aria-hidden="true" tabindex="-1"></a>  知覚品質 <span class="ot">-&gt;</span> y02, b12, <span class="cn">NA</span></span>
<span id="cb175-31"><a href="#cb175-31" aria-hidden="true" tabindex="-1"></a>  知覚品質 <span class="ot">-&gt;</span> y03, b13, <span class="cn">NA</span></span>
<span id="cb175-32"><a href="#cb175-32" aria-hidden="true" tabindex="-1"></a>  知覚品質 <span class="ot">-&gt;</span> y04, b14, <span class="cn">NA</span></span>
<span id="cb175-33"><a href="#cb175-33" aria-hidden="true" tabindex="-1"></a>  顧客期待 <span class="ot">-&gt;</span> y05, <span class="cn">NA</span>,  <span class="dv">1</span></span>
<span id="cb175-34"><a href="#cb175-34" aria-hidden="true" tabindex="-1"></a>  顧客期待 <span class="ot">-&gt;</span> y06, b22, <span class="cn">NA</span></span>
<span id="cb175-35"><a href="#cb175-35" aria-hidden="true" tabindex="-1"></a>  顧客期待 <span class="ot">-&gt;</span> y07, b23, <span class="cn">NA</span></span>
<span id="cb175-36"><a href="#cb175-36" aria-hidden="true" tabindex="-1"></a>  顧客満足 <span class="ot">-&gt;</span> y08, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb175-37"><a href="#cb175-37" aria-hidden="true" tabindex="-1"></a>  顧客満足 <span class="ot">-&gt;</span> y09, b32, <span class="cn">NA</span></span>
<span id="cb175-38"><a href="#cb175-38" aria-hidden="true" tabindex="-1"></a>  顧客満足 <span class="ot">-&gt;</span> y10, b33, <span class="cn">NA</span></span>
<span id="cb175-39"><a href="#cb175-39" aria-hidden="true" tabindex="-1"></a>  y01 <span class="ot">&lt;-</span><span class="er">&gt;</span> y01, e01, NA　　　      <span class="co">#測定方程式の分散設定</span></span>
<span id="cb175-40"><a href="#cb175-40" aria-hidden="true" tabindex="-1"></a>  y02 <span class="ot">&lt;-</span><span class="er">&gt;</span> y02, e02, <span class="cn">NA</span></span>
<span id="cb175-41"><a href="#cb175-41" aria-hidden="true" tabindex="-1"></a>  y03 <span class="ot">&lt;-</span><span class="er">&gt;</span> y03, e03, <span class="cn">NA</span></span>
<span id="cb175-42"><a href="#cb175-42" aria-hidden="true" tabindex="-1"></a>  y04 <span class="ot">&lt;-</span><span class="er">&gt;</span> y04, e04, <span class="cn">NA</span></span>
<span id="cb175-43"><a href="#cb175-43" aria-hidden="true" tabindex="-1"></a>  y05 <span class="ot">&lt;-</span><span class="er">&gt;</span> y05, e05, <span class="cn">NA</span></span>
<span id="cb175-44"><a href="#cb175-44" aria-hidden="true" tabindex="-1"></a>  y06 <span class="ot">&lt;-</span><span class="er">&gt;</span> y06, e06, <span class="cn">NA</span></span>
<span id="cb175-45"><a href="#cb175-45" aria-hidden="true" tabindex="-1"></a>  y07 <span class="ot">&lt;-</span><span class="er">&gt;</span> y07, e07, <span class="cn">NA</span></span>
<span id="cb175-46"><a href="#cb175-46" aria-hidden="true" tabindex="-1"></a>  y08 <span class="ot">&lt;-</span><span class="er">&gt;</span> y08, e08, <span class="cn">NA</span></span>
<span id="cb175-47"><a href="#cb175-47" aria-hidden="true" tabindex="-1"></a>  y09 <span class="ot">&lt;-</span><span class="er">&gt;</span> y09, e09, <span class="cn">NA</span></span>
<span id="cb175-48"><a href="#cb175-48" aria-hidden="true" tabindex="-1"></a>  y10 <span class="ot">&lt;-</span><span class="er">&gt;</span> y10, e10, <span class="cn">NA</span></span>
<span id="cb175-49"><a href="#cb175-49" aria-hidden="true" tabindex="-1"></a>  知覚品質     <span class="ot">-&gt;</span> 顧客満足,  b1,<span class="cn">NA</span>    　　　<span class="co">#構造方程式</span></span>
<span id="cb175-50"><a href="#cb175-50" aria-hidden="true" tabindex="-1"></a>  顧客期待     <span class="ot">-&gt;</span> 顧客満足,  b2,<span class="cn">NA</span></span>
<span id="cb175-51"><a href="#cb175-51" aria-hidden="true" tabindex="-1"></a>  顧客期待     <span class="ot">-&gt;</span> 知覚品質,  b4,<span class="cn">NA</span></span>
<span id="cb175-52"><a href="#cb175-52" aria-hidden="true" tabindex="-1"></a>  知覚品質    <span class="ot">&lt;-</span><span class="er">&gt;</span> 知覚品質 , <span class="cn">NA</span>, <span class="dv">1</span>            <span class="co">#構造方程式の分散設定</span></span>
<span id="cb175-53"><a href="#cb175-53" aria-hidden="true" tabindex="-1"></a>  顧客期待    <span class="ot">&lt;-</span><span class="er">&gt;</span> 顧客期待 , <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb175-54"><a href="#cb175-54" aria-hidden="true" tabindex="-1"></a>  顧客満足    <span class="ot">&lt;-</span><span class="er">&gt;</span> 顧客満足 , <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb175-55"><a href="#cb175-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-56"><a href="#cb175-56" aria-hidden="true" tabindex="-1"></a><span class="co">#分析と出力#</span></span>
<span id="cb175-57"><a href="#cb175-57" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sem</span>(model,co,<span class="at">N=</span><span class="dv">100</span>) <span class="co">#モデル,相関係数, サンプル数の並び</span></span>
<span id="cb175-58"><a href="#cb175-58" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result,</span>
<span id="cb175-59"><a href="#cb175-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">fit.indices =</span> <span class="fu">c</span>(<span class="st">"GFI"</span>, <span class="st">"AGFI"</span>, <span class="st">"RMSEA"</span>,<span class="st">"NFI"</span>, <span class="st">"NNFI"</span>,</span>
<span id="cb175-60"><a href="#cb175-60" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"CFI"</span>, <span class="st">"RNI"</span>, <span class="st">"IFI"</span>, <span class="st">"SRMR"</span>, <span class="st">"AIC"</span>,</span>
<span id="cb175-61"><a href="#cb175-61" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"AICc"</span>, <span class="st">"BIC"</span>, <span class="st">"CAIC"</span>))</span>
<span id="cb175-62"><a href="#cb175-62" aria-hidden="true" tabindex="-1"></a><span class="fu">stdCoef</span>(result)　　 <span class="co">#標準解の表示</span></span>
<span id="cb175-63"><a href="#cb175-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-64"><a href="#cb175-64" aria-hidden="true" tabindex="-1"></a><span class="co">#パス図の作成#</span></span>
<span id="cb175-65"><a href="#cb175-65" aria-hidden="true" tabindex="-1"></a><span class="fu">pathDiagram</span>(result, <span class="at">out.file=</span><span class="st">"csi100-10.txt"</span>, <span class="at">ignore.double=</span><span class="cn">FALSE</span>, </span>
<span id="cb175-66"><a href="#cb175-66" aria-hidden="true" tabindex="-1"></a><span class="at">edge.labels=</span><span class="st">"values"</span>, <span class="at">digits=</span><span class="dv">3</span>,</span>
<span id="cb175-67"><a href="#cb175-67" aria-hidden="true" tabindex="-1"></a><span class="at">node.font=</span><span class="fu">c</span>(<span class="st">"C:/WINDOWS/Fonts/msgothic.ttc"</span>,<span class="dv">10</span>)) </span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-25" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-25">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sem)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">readMoments</span>(<span class="at">diag =</span> <span class="cn">TRUE</span>,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">names =</span> <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)),</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">text =</span> <span class="st">"</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="st">1</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="st">0.836 1</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="st">0.788 0.841 1</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="st">0.532 0.569 0.646 1</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="st">0.459 0.420 0.378 0.318 1</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="st">0.597 0.625 0.714 0.597 0.482 1</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="st">0.608 0.639 0.681 0.604 0.454 0.708 1</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="st">0.762 0.790 0.821 0.645 0.343 0.662 0.647 1</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="st">0.629 0.597 0.666 0.570 0.271 0.563 0.588 0.741 1</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="st">0.660 0.581 0.663 0.472 0.436 0.626 0.612 0.694 0.736 1</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">specifyModel</span>(<span class="at">text =</span> <span class="st">"</span></span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質 -&gt; y01, NA,  1</span></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質 -&gt; y02, b12, NA</span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質 -&gt; y03, b13, NA</span></span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質 -&gt; y04, b14, NA</span></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待 -&gt; y05, NA,  1</span></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待 -&gt; y06, b22, NA</span></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待 -&gt; y07, b23, NA</span></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客満足 -&gt; y08, NA,  1</span></span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客満足 -&gt; y09, b32, NA</span></span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客満足 -&gt; y10, b33, NA</span></span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a><span class="st">  y01 &lt;-&gt; y01, e01, NA</span></span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a><span class="st">  y02 &lt;-&gt; y02, e02, NA</span></span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a><span class="st">  y03 &lt;-&gt; y03, e03, NA</span></span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a><span class="st">  y04 &lt;-&gt; y04, e04, NA</span></span>
<span id="cb176-33"><a href="#cb176-33" aria-hidden="true" tabindex="-1"></a><span class="st">  y05 &lt;-&gt; y05, e05, NA</span></span>
<span id="cb176-34"><a href="#cb176-34" aria-hidden="true" tabindex="-1"></a><span class="st">  y06 &lt;-&gt; y06, e06, NA</span></span>
<span id="cb176-35"><a href="#cb176-35" aria-hidden="true" tabindex="-1"></a><span class="st">  y07 &lt;-&gt; y07, e07, NA</span></span>
<span id="cb176-36"><a href="#cb176-36" aria-hidden="true" tabindex="-1"></a><span class="st">  y08 &lt;-&gt; y08, e08, NA</span></span>
<span id="cb176-37"><a href="#cb176-37" aria-hidden="true" tabindex="-1"></a><span class="st">  y09 &lt;-&gt; y09, e09, NA</span></span>
<span id="cb176-38"><a href="#cb176-38" aria-hidden="true" tabindex="-1"></a><span class="st">  y10 &lt;-&gt; y10, e10, NA</span></span>
<span id="cb176-39"><a href="#cb176-39" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質   -&gt; 顧客満足, b1, NA</span></span>
<span id="cb176-40"><a href="#cb176-40" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待   -&gt; 顧客満足, b2, NA</span></span>
<span id="cb176-41"><a href="#cb176-41" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待   -&gt; 知覚品質, b4, NA</span></span>
<span id="cb176-42"><a href="#cb176-42" aria-hidden="true" tabindex="-1"></a><span class="st">  知覚品質  &lt;-&gt; 知覚品質, NA, 1</span></span>
<span id="cb176-43"><a href="#cb176-43" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客期待  &lt;-&gt; 顧客期待, NA, 1</span></span>
<span id="cb176-44"><a href="#cb176-44" aria-hidden="true" tabindex="-1"></a><span class="st">  顧客満足  &lt;-&gt; 顧客満足, NA, 1</span></span>
<span id="cb176-45"><a href="#cb176-45" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb176-46"><a href="#cb176-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-47"><a href="#cb176-47" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sem</span>(model, <span class="at">S =</span> co, <span class="at">N =</span> <span class="dv">100</span>)</span>
<span id="cb176-48"><a href="#cb176-48" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result,</span>
<span id="cb176-49"><a href="#cb176-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">fit.indices =</span> <span class="fu">c</span>(<span class="st">"GFI"</span>, <span class="st">"AGFI"</span>, <span class="st">"RMSEA"</span>,<span class="st">"NFI"</span>, <span class="st">"NNFI"</span>,</span>
<span id="cb176-50"><a href="#cb176-50" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"CFI"</span>, <span class="st">"RNI"</span>, <span class="st">"IFI"</span>, <span class="st">"SRMR"</span>, <span class="st">"AIC"</span>,</span>
<span id="cb176-51"><a href="#cb176-51" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"AICc"</span>, <span class="st">"BIC"</span>, <span class="st">"CAIC"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Model Chisquare =  195.8478   Df =  35 Pr(&gt;Chisq) = 2.939613e-24
 Goodness-of-fit index =  0.7482947
 Adjusted goodness-of-fit index =  0.6044631
 RMSEA index =  0.2154547   90% CI: (NA, NA)
 Bentler-Bonett NFI =  0.7671175
 Tucker-Lewis NNFI =  0.7401866
 Bentler CFI =  0.7979229
 Bentler RNI =  0.7979229
 Bollen IFI =  0.8004302
 SRMR =  0.5259796
 AIC =  235.8478
 AICc =  206.4807
 BIC =  34.66685
 CAIC =  -0.3331539

 Normalized Residuals
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4.0905 -2.6988 -2.0752 -1.9621 -1.2453  0.2498 

 R-square for Endogenous Variables
知覚品質      y01      y02      y03      y04      y05      y06      y07 
  0.4417   0.8874   0.9121   0.8988   0.5650   0.5819   0.8039   0.7593 
顧客満足      y08      y09      y10 
  0.5381   0.9063   0.8433   0.8012 

 Parameter Estimates
    Estimate  Std Error  z value   Pr(&gt;|z|)                            
b12 0.9164505 0.04302891 21.298481 1.172618e-100 y02 &lt;--- 知覚品質     
b13 0.9054107 0.04399643 20.579183  4.217254e-94 y03 &lt;--- 知覚品質     
b14 0.6459162 0.06191799 10.431802  1.774906e-25 y04 &lt;--- 知覚品質     
b22 1.0264636 0.08317768 12.340613  5.473752e-35 y06 &lt;--- 顧客期待     
b23 0.9890844 0.08412697 11.757043  6.496995e-32 y07 &lt;--- 顧客期待     
b32 0.8248899 0.04688206 17.595000  2.690544e-69 y09 &lt;--- 顧客満足     
b33 0.7894439 0.04889102 16.147013  1.191949e-58 y10 &lt;--- 顧客満足     
e01 0.2272440 0.04490721  5.060301  4.185949e-07 y01 &lt;--&gt; y01          
e02 0.1449226 0.03288996  4.406287  1.051575e-05 y02 &lt;--&gt; y02          
e03 0.1653994 0.03459551  4.780951  1.744679e-06 y03 &lt;--&gt; y03          
e04 0.5752444 0.08552435  6.726089  1.742839e-11 y04 &lt;--&gt; y04          
e05 0.7185013 0.11947856  6.013642  1.814006e-09 y05 &lt;--&gt; y05          
e06 0.2570127 0.06991582  3.676031  2.368910e-04 y06 &lt;--&gt; y06          
e07 0.3101407 0.07147017  4.339443  1.428441e-05 y07 &lt;--&gt; y07          
e08 0.2239144 0.06535497  3.426126  6.122556e-04 y08 &lt;--&gt; y08          
e09 0.2736352 0.05622301  4.866961  1.133271e-06 y09 &lt;--&gt; y09          
e10 0.3347183 0.06105611  5.482142  4.202065e-08 y10 &lt;--&gt; y10          
b1  0.6494165 0.11842640  5.483714  4.164877e-08 顧客満足 &lt;--- 知覚品質
b2  0.2844710 0.16095658  1.767377  7.716507e-02 顧客満足 &lt;--- 顧客期待
b4  0.8894711 0.12391592  7.178021  7.072774e-13 知覚品質 &lt;--- 顧客期待

 Iterations =  32 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stdCoef</span>(result)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Std. Estimate                       
1         0.94202651      y01 &lt;--- 知覚品質
2  b12    0.95505495      y02 &lt;--- 知覚品質
3  b13    0.94802950      y03 &lt;--- 知覚品質
4  b14    0.75169300      y04 &lt;--- 知覚品質
5         0.76282525      y05 &lt;--- 顧客期待
6  b22    0.89660634      y06 &lt;--- 顧客期待
7  b23    0.87137111      y07 &lt;--- 顧客期待
8         0.95198126      y08 &lt;--- 顧客満足
9  b32    0.91834004      y09 &lt;--- 顧客満足
10 b33    0.89511639      y10 &lt;--- 顧客満足
11 e01    0.11258606           y01 &lt;--&gt; y01
12 e02    0.08787004           y02 &lt;--&gt; y02
13 e03    0.10124007           y03 &lt;--&gt; y03
14 e04    0.43495763           y04 &lt;--&gt; y04
15 e05    0.41809763           y05 &lt;--&gt; y05
16 e06    0.19609707           y06 &lt;--&gt; y06
17 e07    0.24071239           y07 &lt;--&gt; y07
18 e08    0.09373169           y08 &lt;--&gt; y08
19 e09    0.15665158           y09 &lt;--&gt; y09
20 e10    0.19876665           y10 &lt;--&gt; y10
21  b1    0.59069621 顧客満足 &lt;--- 知覚品質
22  b2    0.19333560 顧客満足 &lt;--- 顧客期待
23  b4    0.66460680 知覚品質 &lt;--- 顧客期待
24        0.55829780 知覚品質 &lt;--&gt; 知覚品質
25        1.00000000 顧客期待 &lt;--&gt; 顧客期待
26        0.46189967 顧客満足 &lt;--&gt; 顧客満足</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pathDiagram</span>(result, <span class="at">file =</span> <span class="st">"csi100-10"</span>, <span class="at">output.type =</span> <span class="st">"graphics"</span>, <span class="at">graphics.fmt =</span> <span class="st">"pdf"</span>, <span class="at">ignore.double =</span> <span class="cn">FALSE</span>, <span class="at">edge.labels =</span> <span class="st">"values"</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running  dot -Tpdf -o csi100-10.pdf -Gcharset=latin1  csi100-10.dot </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-2989fdbfbaf84ef4cc59" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2989fdbfbaf84ef4cc59">{"x":{"diagram":"digraph \"result\" {\n  rankdir=LR;\n  size=\"8,8\";\n  node [fontname=\"Helvetica\" fontsize=14 fillcolor=\"transparent\" shape=box style=filled];\n  edge [fontname=\"Helvetica\" fontsize=10];\n  center=1;\n  \"顧客満足\" [shape=ellipse]\n  \"知覚品質\" [shape=ellipse]\n  \"顧客期待\" [shape=ellipse]\n  \"知覚品質\" [fillcolor=\"transparent\"]\n  \"y01\" [fillcolor=\"transparent\"]\n  \"y02\" [fillcolor=\"transparent\"]\n  \"y03\" [fillcolor=\"transparent\"]\n  \"y04\" [fillcolor=\"transparent\"]\n  \"y05\" [fillcolor=\"transparent\"]\n  \"y06\" [fillcolor=\"transparent\"]\n  \"y07\" [fillcolor=\"transparent\"]\n  \"顧客満足\" [fillcolor=\"transparent\"]\n  \"y08\" [fillcolor=\"transparent\"]\n  \"y09\" [fillcolor=\"transparent\"]\n  \"y10\" [fillcolor=\"transparent\"]\n  \"知覚品質\" -> \"y01\" [label=\"1\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"y02\" [label=\"0.916\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"y03\" [label=\"0.905\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"y04\" [label=\"0.646\" color=black penwidth=1.001];\n  \"顧客期待\" -> \"y05\" [label=\"1\" color=black penwidth=1.001];\n  \"顧客期待\" -> \"y06\" [label=\"1.026\" color=black penwidth=1.001];\n  \"顧客期待\" -> \"y07\" [label=\"0.989\" color=black penwidth=1.001];\n  \"顧客満足\" -> \"y08\" [label=\"1\" color=black penwidth=1.001];\n  \"顧客満足\" -> \"y09\" [label=\"0.825\" color=black penwidth=1.001];\n  \"顧客満足\" -> \"y10\" [label=\"0.789\" color=black penwidth=1.001];\n  \"y01\" -> \"y01\" [label=\"0.227\" dir=both color=black penwidth=1.001];\n  \"y02\" -> \"y02\" [label=\"0.145\" dir=both color=black penwidth=1.001];\n  \"y03\" -> \"y03\" [label=\"0.165\" dir=both color=black penwidth=1.001];\n  \"y04\" -> \"y04\" [label=\"0.575\" dir=both color=black penwidth=1.001];\n  \"y05\" -> \"y05\" [label=\"0.719\" dir=both color=black penwidth=1.001];\n  \"y06\" -> \"y06\" [label=\"0.257\" dir=both color=black penwidth=1.001];\n  \"y07\" -> \"y07\" [label=\"0.31\" dir=both color=black penwidth=1.001];\n  \"y08\" -> \"y08\" [label=\"0.224\" dir=both color=black penwidth=1.001];\n  \"y09\" -> \"y09\" [label=\"0.274\" dir=both color=black penwidth=1.001];\n  \"y10\" -> \"y10\" [label=\"0.335\" dir=both color=black penwidth=1.001];\n  \"知覚品質\" -> \"顧客満足\" [label=\"0.649\" color=black penwidth=1.001];\n  \"顧客期待\" -> \"顧客満足\" [label=\"0.284\" color=black penwidth=1.001];\n  \"顧客期待\" -> \"知覚品質\" [label=\"0.889\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"知覚品質\" [label=\"1\" dir=both color=black penwidth=1.001];\n  \"顧客期待\" -> \"顧客期待\" [label=\"1\" dir=both color=black penwidth=1.001];\n  \"顧客満足\" -> \"顧客満足\" [label=\"1\" dir=both color=black penwidth=1.001];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>コード <code>SEM-CSI-Cor.R</code> に記載されている <code>pathDiagram()</code> の引数 <code>out.file</code> は，関数のヘルプには見当たらない。 このような違いが生じるのは，本書で使用されている関数のバージョンが古く，現在のバージョンではその引数が廃止されたためであると考えられる。</p>
<p>上の <code>pathDiagram()</code> を実行すると，作業ディレクトリに <code>csi100-10.dot</code> という名前の DOT 言語によるファイルと，PDF形式のファイルが作成される。 ただし，PDFファイルでは日本語が文字化けする場合があるため注意が必要である。 DOT 言語はグラフ構造を記述するための言語であり，<a href="https://www.graphviz.org/">Graphviz</a> という作図ソフトウェアを用いて図として描画できる。 DOT ファイルの中身はテキスト形式で記述されており，このファイルの中の日本語が文字化けする可能性は低い。</p>
<p>また，<code>pathDiagram()</code> によって作成される図は，図14.11とは異なるレイアウトで表示される。 この問題に対応するためには，例えば，<code>pathDiagram()</code> の引数 <code>dot.options</code> を次のように指定するとよい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pathDiagram</span>(result, <span class="at">file =</span> <span class="st">"csi100-10_circo"</span>, <span class="at">output.type =</span> <span class="st">"graphics"</span>, <span class="at">graphics.fmt =</span> <span class="st">"png"</span>, <span class="at">dot.options =</span> <span class="st">"-Gcharset=UTF-8 -Kcirco"</span>, <span class="at">ignore.double =</span> <span class="cn">FALSE</span>, <span class="at">edge.labels =</span> <span class="st">"values"</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running  dot -Tpng -o csi100-10_circo.png -Gcharset=latin1 -Gcharset=UTF-8 -Kcirco csi100-10_circo.dot </code></pre>
</div>
</div>
<p><img src="csi100-10_circo.png" class="img-fluid"></p>
<p>なお，作図自体は必ずしもR上で行う必要はない。 例えば，DOT 言語のファイルに対して，コマンドプロンプト（macOS の場合は <code>ターミナル.app</code>）で以下のコマンドを実行する。</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="ex">circo</span> <span class="at">-Tpdf</span> csi100-10.dot <span class="at">-o</span> csi100-10.pdf</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>または</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="ex">circo</span> <span class="at">-Tpng</span> csi100-10.dot <span class="at">-o</span> csi100-10.png</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>これらのコマンドにより，次の図のファイルが得られる。 <img src="csi100-10.png" class="img-fluid"></p>
<p>また，次のように，<code>semPlot</code> パッケージを用いる方法もある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(semPlot)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">semPaths</span>(result, <span class="at">layout =</span> <span class="st">"circle"</span>, <span class="at">whatLabels =</span> <span class="st">"std"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="高次因子分析" class="level3">
<h3 class="anchored" data-anchor-id="高次因子分析">6 高次因子分析</h3>
<section id="rによるサービス品質の分析" class="level4">
<h4 class="anchored" data-anchor-id="rによるサービス品質の分析">6.2 Rによるサービス品質の分析</h4>
<section id="手入力するコードservqual.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードservqual.r">▶ 手入力するコード（<code>SERVQUAL.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sem)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み#</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">readMoments</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span>, <span class="st">"y4"</span>,<span class="st">"y5"</span>, <span class="st">"y6"</span>,<span class="st">"y7"</span>, <span class="st">"y8"</span>, <span class="st">"y9"</span>, <span class="st">"y10"</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="fl">1.00</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="fl">0.76</span> <span class="fl">1.00</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="fl">0.39</span> <span class="fl">0.32</span> <span class="fl">1.00</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="fl">0.48</span> <span class="fl">0.39</span> <span class="fl">0.68</span> <span class="fl">1.00</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="fl">0.46</span> <span class="fl">0.28</span> <span class="fl">0.33</span> <span class="fl">0.45</span> <span class="fl">1.00</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="fl">0.40</span> <span class="fl">0.45</span> <span class="fl">0.37</span> <span class="fl">0.40</span> <span class="fl">0.72</span> <span class="fl">1.00</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a><span class="fl">0.23</span> <span class="fl">0.37</span> <span class="fl">0.42</span> <span class="fl">0.31</span> <span class="fl">0.37</span> <span class="fl">0.47</span> <span class="fl">1.00</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a><span class="fl">0.31</span> <span class="fl">0.39</span> <span class="fl">0.34</span> <span class="fl">0.34</span> <span class="fl">0.42</span> <span class="fl">0.47</span> <span class="fl">0.81</span> <span class="fl">1.00</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="fl">0.48</span> <span class="fl">0.23</span> <span class="fl">0.30</span> <span class="fl">0.31</span> <span class="fl">0.33</span> <span class="fl">0.40</span> <span class="fl">0.44</span> <span class="fl">0.48</span> <span class="fl">1.00</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a><span class="fl">0.38</span> <span class="fl">0.23</span> <span class="fl">0.40</span> <span class="fl">0.31</span> <span class="fl">0.33</span> <span class="fl">0.30</span> <span class="fl">0.44</span> <span class="fl">0.48</span> <span class="fl">0.80</span> <span class="fl">1.00</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a><span class="co">#モデルの作成#</span></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a><span class="co">#測定方程式</span></span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a>　　<span class="co">#ラベル</span></span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">specifyModel</span>()</span>
<span id="cb187-22"><a href="#cb187-22" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">-&gt;</span> 信頼性, a1, <span class="cn">NA</span> <span class="co">#2次因子</span></span>
<span id="cb187-23"><a href="#cb187-23" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">-&gt;</span> 有形性, a2, <span class="cn">NA</span></span>
<span id="cb187-24"><a href="#cb187-24" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">-&gt;</span> 応答性, a3, <span class="cn">NA</span></span>
<span id="cb187-25"><a href="#cb187-25" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">-&gt;</span> 保証性, a4, <span class="cn">NA</span></span>
<span id="cb187-26"><a href="#cb187-26" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">-&gt;</span> 共感性, a5, <span class="cn">NA</span></span>
<span id="cb187-27"><a href="#cb187-27" aria-hidden="true" tabindex="-1"></a>信頼性 <span class="ot">-&gt;</span> y1, <span class="cn">NA</span>, <span class="dv">1</span>     <span class="co">#1次因子</span></span>
<span id="cb187-28"><a href="#cb187-28" aria-hidden="true" tabindex="-1"></a>信頼性 <span class="ot">-&gt;</span> y2, b1, <span class="cn">NA</span></span>
<span id="cb187-29"><a href="#cb187-29" aria-hidden="true" tabindex="-1"></a>有形性 <span class="ot">-&gt;</span> y3, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb187-30"><a href="#cb187-30" aria-hidden="true" tabindex="-1"></a>有形性 <span class="ot">-&gt;</span> y4, b2, <span class="cn">NA</span></span>
<span id="cb187-31"><a href="#cb187-31" aria-hidden="true" tabindex="-1"></a>応答性 <span class="ot">-&gt;</span> y5, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb187-32"><a href="#cb187-32" aria-hidden="true" tabindex="-1"></a>応答性 <span class="ot">-&gt;</span> y6, b3, <span class="cn">NA</span></span>
<span id="cb187-33"><a href="#cb187-33" aria-hidden="true" tabindex="-1"></a>保証性 <span class="ot">-&gt;</span> y7, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb187-34"><a href="#cb187-34" aria-hidden="true" tabindex="-1"></a>保証性 <span class="ot">-&gt;</span> y8, b4, <span class="cn">NA</span></span>
<span id="cb187-35"><a href="#cb187-35" aria-hidden="true" tabindex="-1"></a>共感性 <span class="ot">-&gt;</span> y9, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb187-36"><a href="#cb187-36" aria-hidden="true" tabindex="-1"></a>共感性 <span class="ot">-&gt;</span> y10, b5, <span class="cn">NA</span></span>
<span id="cb187-37"><a href="#cb187-37" aria-hidden="true" tabindex="-1"></a>知覚品質 <span class="ot">&lt;-</span><span class="er">&gt;</span> 知覚品質, <span class="cn">NA</span>, <span class="dv">1</span></span>
<span id="cb187-38"><a href="#cb187-38" aria-hidden="true" tabindex="-1"></a>信頼性   <span class="ot">&lt;-</span><span class="er">&gt;</span> 信頼性, d2, <span class="cn">NA</span></span>
<span id="cb187-39"><a href="#cb187-39" aria-hidden="true" tabindex="-1"></a>有形性   <span class="ot">&lt;-</span><span class="er">&gt;</span> 有形性, d3, <span class="cn">NA</span></span>
<span id="cb187-40"><a href="#cb187-40" aria-hidden="true" tabindex="-1"></a>応答性   <span class="ot">&lt;-</span><span class="er">&gt;</span> 応答性, d4, <span class="cn">NA</span></span>
<span id="cb187-41"><a href="#cb187-41" aria-hidden="true" tabindex="-1"></a>保証性   <span class="ot">&lt;-</span><span class="er">&gt;</span> 保証性, d5, <span class="cn">NA</span></span>
<span id="cb187-42"><a href="#cb187-42" aria-hidden="true" tabindex="-1"></a>共感性   <span class="ot">&lt;-</span><span class="er">&gt;</span> 共感性, d6, <span class="cn">NA</span></span>
<span id="cb187-43"><a href="#cb187-43" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span><span class="er">&gt;</span> y1, e1, <span class="cn">NA</span></span>
<span id="cb187-44"><a href="#cb187-44" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span><span class="er">&gt;</span> y2, e2, <span class="cn">NA</span></span>
<span id="cb187-45"><a href="#cb187-45" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span><span class="er">&gt;</span> y3, e3, <span class="cn">NA</span></span>
<span id="cb187-46"><a href="#cb187-46" aria-hidden="true" tabindex="-1"></a>y4 <span class="ot">&lt;-</span><span class="er">&gt;</span> y4, e4, <span class="cn">NA</span></span>
<span id="cb187-47"><a href="#cb187-47" aria-hidden="true" tabindex="-1"></a>y5 <span class="ot">&lt;-</span><span class="er">&gt;</span> y5, e5, <span class="cn">NA</span></span>
<span id="cb187-48"><a href="#cb187-48" aria-hidden="true" tabindex="-1"></a>y6 <span class="ot">&lt;-</span><span class="er">&gt;</span> y6, e6, <span class="cn">NA</span></span>
<span id="cb187-49"><a href="#cb187-49" aria-hidden="true" tabindex="-1"></a>y7 <span class="ot">&lt;-</span><span class="er">&gt;</span> y7, e7, <span class="cn">NA</span></span>
<span id="cb187-50"><a href="#cb187-50" aria-hidden="true" tabindex="-1"></a>y8 <span class="ot">&lt;-</span><span class="er">&gt;</span> y8, e8, <span class="cn">NA</span></span>
<span id="cb187-51"><a href="#cb187-51" aria-hidden="true" tabindex="-1"></a>y9 <span class="ot">&lt;-</span><span class="er">&gt;</span> y9, e9, <span class="cn">NA</span></span>
<span id="cb187-52"><a href="#cb187-52" aria-hidden="true" tabindex="-1"></a>y10 <span class="ot">&lt;-</span><span class="er">&gt;</span> y10, e10, <span class="cn">NA</span></span>
<span id="cb187-53"><a href="#cb187-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-54"><a href="#cb187-54" aria-hidden="true" tabindex="-1"></a><span class="co">#分析と出力#</span></span>
<span id="cb187-55"><a href="#cb187-55" aria-hidden="true" tabindex="-1"></a>y.sem <span class="ot">&lt;-</span> <span class="fu">sem</span>(model, cor, <span class="at">N =</span> <span class="dv">100</span>)</span>
<span id="cb187-56"><a href="#cb187-56" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y.sem,</span>
<span id="cb187-57"><a href="#cb187-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">fit.indices =</span> <span class="fu">c</span>(<span class="st">"GFI"</span>, <span class="st">"AGFI"</span>, <span class="st">"RMSEA"</span>,<span class="st">"NFI"</span>, <span class="st">"NNFI"</span>,</span>
<span id="cb187-58"><a href="#cb187-58" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"CFI"</span>, <span class="st">"RNI"</span>, <span class="st">"IFI"</span>, <span class="st">"SRMR"</span>, <span class="st">"AIC"</span>,</span>
<span id="cb187-59"><a href="#cb187-59" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"AICc"</span>, <span class="st">"BIC"</span>, <span class="st">"CAIC"</span>))</span>
<span id="cb187-60"><a href="#cb187-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-61"><a href="#cb187-61" aria-hidden="true" tabindex="-1"></a><span class="co">#パス図の作成#</span></span>
<span id="cb187-62"><a href="#cb187-62" aria-hidden="true" tabindex="-1"></a><span class="fu">pathDiagram</span>(y.sem, <span class="at">out.file=</span><span class="st">"servqual.txt"</span>, <span class="at">ignore.double=</span><span class="cn">FALSE</span>, </span>
<span id="cb187-63"><a href="#cb187-63" aria-hidden="true" tabindex="-1"></a><span class="at">edge.labels=</span><span class="st">"values"</span>, <span class="at">digits=</span><span class="dv">3</span>,</span>
<span id="cb187-64"><a href="#cb187-64" aria-hidden="true" tabindex="-1"></a><span class="at">node.font=</span><span class="fu">c</span>(<span class="st">"C:/WINDOWS/Fonts/msgothic.ttc"</span>,<span class="dv">10</span>)) </span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-26" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-26">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sem)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">readMoments</span>(<span class="at">names =</span> <span class="fu">paste0</span>(<span class="st">"y"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">text =</span> <span class="st">"</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="st">1.00</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="st">0.76 1.00</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="st">0.39 0.32 1.00</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="st">0.48 0.39 0.68 1.00</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="st">0.46 0.28 0.33 0.45 1.00</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="st">0.40 0.45 0.37 0.40 0.72 1.00</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a><span class="st">0.23 0.37 0.42 0.31 0.37 0.47 1.00</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="st">0.31 0.39 0.34 0.34 0.42 0.47 0.81 1.00</span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="st">0.48 0.23 0.30 0.31 0.33 0.40 0.44 0.48 1.00</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="st">0.38 0.23 0.40 0.31 0.33 0.30 0.44 0.48 0.80 1.00</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">specifyModel</span>(<span class="at">text =</span> <span class="st">"</span></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 -&gt; 信頼性, a1, NA</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 -&gt; 有形性, a2, NA</span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 -&gt; 応答性, a3, NA</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 -&gt; 保証性, a4, NA</span></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 -&gt; 共感性, a5, NA</span></span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a><span class="st">信頼性 -&gt; y1, NA, 1</span></span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a><span class="st">信頼性 -&gt; y2, b1, NA</span></span>
<span id="cb188-25"><a href="#cb188-25" aria-hidden="true" tabindex="-1"></a><span class="st">有形性 -&gt; y3, NA, 1</span></span>
<span id="cb188-26"><a href="#cb188-26" aria-hidden="true" tabindex="-1"></a><span class="st">有形性 -&gt; y4, b2, NA</span></span>
<span id="cb188-27"><a href="#cb188-27" aria-hidden="true" tabindex="-1"></a><span class="st">応答性 -&gt; y5, NA, 1</span></span>
<span id="cb188-28"><a href="#cb188-28" aria-hidden="true" tabindex="-1"></a><span class="st">応答性 -&gt; y6, b3, NA</span></span>
<span id="cb188-29"><a href="#cb188-29" aria-hidden="true" tabindex="-1"></a><span class="st">保証性 -&gt; y7, NA, 1</span></span>
<span id="cb188-30"><a href="#cb188-30" aria-hidden="true" tabindex="-1"></a><span class="st">保証性 -&gt; y8, b4, NA</span></span>
<span id="cb188-31"><a href="#cb188-31" aria-hidden="true" tabindex="-1"></a><span class="st">共感性 -&gt; y9, NA, 1</span></span>
<span id="cb188-32"><a href="#cb188-32" aria-hidden="true" tabindex="-1"></a><span class="st">共感性 -&gt; y10, b5, NA</span></span>
<span id="cb188-33"><a href="#cb188-33" aria-hidden="true" tabindex="-1"></a><span class="st">知覚品質 &lt;-&gt; 知覚品質, NA, 1</span></span>
<span id="cb188-34"><a href="#cb188-34" aria-hidden="true" tabindex="-1"></a><span class="st">信頼性   &lt;-&gt; 信頼性, d2, NA</span></span>
<span id="cb188-35"><a href="#cb188-35" aria-hidden="true" tabindex="-1"></a><span class="st">有形性   &lt;-&gt; 有形性, d3, NA</span></span>
<span id="cb188-36"><a href="#cb188-36" aria-hidden="true" tabindex="-1"></a><span class="st">応答性   &lt;-&gt; 応答性, d4, NA</span></span>
<span id="cb188-37"><a href="#cb188-37" aria-hidden="true" tabindex="-1"></a><span class="st">保証性   &lt;-&gt; 保証性, d5, NA</span></span>
<span id="cb188-38"><a href="#cb188-38" aria-hidden="true" tabindex="-1"></a><span class="st">共感性   &lt;-&gt; 共感性, d6, NA</span></span>
<span id="cb188-39"><a href="#cb188-39" aria-hidden="true" tabindex="-1"></a><span class="st">y1 &lt;-&gt; y1, e1, NA</span></span>
<span id="cb188-40"><a href="#cb188-40" aria-hidden="true" tabindex="-1"></a><span class="st">y2 &lt;-&gt; y2, e2, NA</span></span>
<span id="cb188-41"><a href="#cb188-41" aria-hidden="true" tabindex="-1"></a><span class="st">y3 &lt;-&gt; y3, e3, NA</span></span>
<span id="cb188-42"><a href="#cb188-42" aria-hidden="true" tabindex="-1"></a><span class="st">y4 &lt;-&gt; y4, e4, NA</span></span>
<span id="cb188-43"><a href="#cb188-43" aria-hidden="true" tabindex="-1"></a><span class="st">y5 &lt;-&gt; y5, e5, NA</span></span>
<span id="cb188-44"><a href="#cb188-44" aria-hidden="true" tabindex="-1"></a><span class="st">y6 &lt;-&gt; y6, e6, NA</span></span>
<span id="cb188-45"><a href="#cb188-45" aria-hidden="true" tabindex="-1"></a><span class="st">y7 &lt;-&gt; y7, e7, NA</span></span>
<span id="cb188-46"><a href="#cb188-46" aria-hidden="true" tabindex="-1"></a><span class="st">y8 &lt;-&gt; y8, e8, NA</span></span>
<span id="cb188-47"><a href="#cb188-47" aria-hidden="true" tabindex="-1"></a><span class="st">y9 &lt;-&gt; y9, e9, NA</span></span>
<span id="cb188-48"><a href="#cb188-48" aria-hidden="true" tabindex="-1"></a><span class="st">y10 &lt;-&gt; y10, e10, NA</span></span>
<span id="cb188-49"><a href="#cb188-49" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb188-50"><a href="#cb188-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-51"><a href="#cb188-51" aria-hidden="true" tabindex="-1"></a>y_sem <span class="ot">&lt;-</span> <span class="fu">sem</span>(model, <span class="at">S =</span> cor, <span class="at">N =</span> <span class="dv">100</span>)</span>
<span id="cb188-52"><a href="#cb188-52" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y_sem,</span>
<span id="cb188-53"><a href="#cb188-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">fit.indices =</span> <span class="fu">c</span>(<span class="st">"GFI"</span>, <span class="st">"AGFI"</span>, <span class="st">"RMSEA"</span>,<span class="st">"NFI"</span>, <span class="st">"NNFI"</span>,</span>
<span id="cb188-54"><a href="#cb188-54" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"CFI"</span>, <span class="st">"RNI"</span>, <span class="st">"IFI"</span>, <span class="st">"SRMR"</span>, <span class="st">"AIC"</span>,</span>
<span id="cb188-55"><a href="#cb188-55" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"AICc"</span>, <span class="st">"BIC"</span>, <span class="st">"CAIC"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Model Chisquare =  113.6219   Df =  30 Pr(&gt;Chisq) = 1.171446e-11
 Goodness-of-fit index =  0.8580703
 Adjusted goodness-of-fit index =  0.7397955
 RMSEA index =  0.167796   90% CI: (NA, NA)
 Bentler-Bonett NFI =  0.8293413
 Tucker-Lewis NNFI =  0.7979446
 Bentler CFI =  0.8652964
 Bentler RNI =  0.8652964
 Bollen IFI =  0.8684744
 SRMR =  0.0562804
 AIC =  163.6219
 AICc =  131.1894
 BIC =  -24.53325
 CAIC =  -54.53325

 Normalized Residuals
      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
-1.447e+00 -3.826e-01 -3.690e-06  2.164e-03  4.919e-01  9.483e-01 

 R-square for Endogenous Variables
信頼性 有形性 応答性 保証性 共感性     y1     y2     y3     y4     y5     y6 
0.4622 0.5052 0.5879 0.4810 0.4569 0.8883 0.6503 0.6345 0.7288 0.6851 0.7566 
    y7     y8     y9    y10 
0.7544 0.8697 0.8556 0.7480 

 Parameter Estimates
    Estimate  Std Error  z value  Pr(&gt;|z|)                         
a1  0.6407215 0.10099877 6.343855 2.240860e-10 信頼性 &lt;--- 知覚品質
a2  0.5661703 0.10422998 5.431934 5.574669e-08 有形性 &lt;--- 知覚品質
a3  0.6346445 0.10234995 6.200731 5.620145e-10 応答性 &lt;--- 知覚品質
a4  0.6023456 0.10297806 5.849262 4.937602e-09 保証性 &lt;--- 知覚品質
a5  0.6252549 0.10163074 6.152222 7.640465e-10 共感性 &lt;--- 知覚品質
b1  0.8555984 0.11827829 7.233774 4.697538e-13 y2 &lt;--- 信頼性      
b2  1.0717482 0.16924715 6.332445 2.413070e-10 y4 &lt;--- 有形性      
b3  1.0508971 0.14123076 7.440994 9.993081e-14 y6 &lt;--- 応答性      
b4  1.0737505 0.12339661 8.701621 3.271762e-18 y8 &lt;--- 保証性      
b5  0.9349937 0.11336085 8.247942 1.611459e-16 y10 &lt;--- 共感性     
d2  0.4777427 0.13128000 3.639112 2.735795e-04 信頼性 &lt;--&gt; 信頼性  
d3  0.3139296 0.09562747 3.282839 1.027673e-03 有形性 &lt;--&gt; 有形性  
d4  0.2823553 0.08918525 3.165941 1.545819e-03 応答性 &lt;--&gt; 応答性  
d5  0.3915460 0.09557047 4.096935 4.186561e-05 保証性 &lt;--&gt; 保証性  
d6  0.4646776 0.11694605 3.973436 7.084331e-05 共感性 &lt;--&gt; 共感性  
e1  0.1117331 0.10286252 1.086237 2.773739e-01 y1 &lt;--&gt; y1          
e2  0.3497449 0.08947697 3.908770 9.276724e-05 y2 &lt;--&gt; y2          
e3  0.3655219 0.09876276 3.701009 2.147439e-04 y3 &lt;--&gt; y3          
e4  0.2712120 0.10389506 2.610441 9.042550e-03 y4 &lt;--&gt; y4          
e5  0.3148702 0.08647260 3.641272 2.712945e-04 y5 &lt;--&gt; y5          
e6  0.2433546 0.08873328 2.742540 6.096602e-03 y6 &lt;--&gt; y6          
e7  0.2456351 0.07926060 3.099082 1.941213e-03 y7 &lt;--&gt; y7          
e8  0.1302618 0.08410302 1.548836 1.214211e-01 y8 &lt;--&gt; y8          
e9  0.1443791 0.08867811 1.628125 1.034983e-01 y9 &lt;--&gt; y9          
e10 0.2520053 0.08349268 3.018292 2.542039e-03 y10 &lt;--&gt; y10        

 Iterations =  54 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pathDiagram</span>(y_sem, <span class="at">ignore.double =</span> <span class="cn">FALSE</span>, <span class="at">edge.labels =</span> <span class="st">"values"</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-b538e2fb1a884faf88dc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b538e2fb1a884faf88dc">{"x":{"diagram":"digraph \"y_sem\" {\n  rankdir=LR;\n  size=\"8,8\";\n  node [fontname=\"Helvetica\" fontsize=14 fillcolor=\"transparent\" shape=box style=filled];\n  edge [fontname=\"Helvetica\" fontsize=10];\n  center=1;\n  \"信頼性\" [shape=ellipse]\n  \"有形性\" [shape=ellipse]\n  \"応答性\" [shape=ellipse]\n  \"保証性\" [shape=ellipse]\n  \"共感性\" [shape=ellipse]\n  \"知覚品質\" [shape=ellipse]\n  \"信頼性\" [fillcolor=\"transparent\"]\n  \"有形性\" [fillcolor=\"transparent\"]\n  \"応答性\" [fillcolor=\"transparent\"]\n  \"保証性\" [fillcolor=\"transparent\"]\n  \"共感性\" [fillcolor=\"transparent\"]\n  \"y1\" [fillcolor=\"transparent\"]\n  \"y2\" [fillcolor=\"transparent\"]\n  \"y3\" [fillcolor=\"transparent\"]\n  \"y4\" [fillcolor=\"transparent\"]\n  \"y5\" [fillcolor=\"transparent\"]\n  \"y6\" [fillcolor=\"transparent\"]\n  \"y7\" [fillcolor=\"transparent\"]\n  \"y8\" [fillcolor=\"transparent\"]\n  \"y9\" [fillcolor=\"transparent\"]\n  \"y10\" [fillcolor=\"transparent\"]\n  \"知覚品質\" -> \"信頼性\" [label=\"0.641\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"有形性\" [label=\"0.566\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"応答性\" [label=\"0.635\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"保証性\" [label=\"0.602\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"共感性\" [label=\"0.625\" color=black penwidth=1.001];\n  \"信頼性\" -> \"y1\" [label=\"1\" color=black penwidth=1.001];\n  \"信頼性\" -> \"y2\" [label=\"0.856\" color=black penwidth=1.001];\n  \"有形性\" -> \"y3\" [label=\"1\" color=black penwidth=1.001];\n  \"有形性\" -> \"y4\" [label=\"1.072\" color=black penwidth=1.001];\n  \"応答性\" -> \"y5\" [label=\"1\" color=black penwidth=1.001];\n  \"応答性\" -> \"y6\" [label=\"1.051\" color=black penwidth=1.001];\n  \"保証性\" -> \"y7\" [label=\"1\" color=black penwidth=1.001];\n  \"保証性\" -> \"y8\" [label=\"1.074\" color=black penwidth=1.001];\n  \"共感性\" -> \"y9\" [label=\"1\" color=black penwidth=1.001];\n  \"共感性\" -> \"y10\" [label=\"0.935\" color=black penwidth=1.001];\n  \"知覚品質\" -> \"知覚品質\" [label=\"1\" dir=both color=black penwidth=1.001];\n  \"信頼性\" -> \"信頼性\" [label=\"0.478\" dir=both color=black penwidth=1.001];\n  \"有形性\" -> \"有形性\" [label=\"0.314\" dir=both color=black penwidth=1.001];\n  \"応答性\" -> \"応答性\" [label=\"0.282\" dir=both color=black penwidth=1.001];\n  \"保証性\" -> \"保証性\" [label=\"0.392\" dir=both color=black penwidth=1.001];\n  \"共感性\" -> \"共感性\" [label=\"0.465\" dir=both color=black penwidth=1.001];\n  \"y1\" -> \"y1\" [label=\"0.112\" dir=both color=black penwidth=1.001];\n  \"y2\" -> \"y2\" [label=\"0.35\" dir=both color=black penwidth=1.001];\n  \"y3\" -> \"y3\" [label=\"0.366\" dir=both color=black penwidth=1.001];\n  \"y4\" -> \"y4\" [label=\"0.271\" dir=both color=black penwidth=1.001];\n  \"y5\" -> \"y5\" [label=\"0.315\" dir=both color=black penwidth=1.001];\n  \"y6\" -> \"y6\" [label=\"0.243\" dir=both color=black penwidth=1.001];\n  \"y7\" -> \"y7\" [label=\"0.246\" dir=both color=black penwidth=1.001];\n  \"y8\" -> \"y8\" [label=\"0.13\" dir=both color=black penwidth=1.001];\n  \"y9\" -> \"y9\" [label=\"0.144\" dir=both color=black penwidth=1.001];\n  \"y10\" -> \"y10\" [label=\"0.252\" dir=both color=black penwidth=1.001];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
誤植
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>p.&nbsp;311</p>
<ul>
<li>（誤）イルカ</li>
<li>（正）カイル</li>
</ul>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="第15章-eコマースとテキスト解析" class="level2">
<h2 class="anchored" data-anchor-id="第15章-eコマースとテキスト解析">第15章 Eコマースとテキスト解析</h2>
<section id="テキストデータの取得と前処理" class="level3">
<h3 class="anchored" data-anchor-id="テキストデータの取得と前処理">2 テキストデータの取得と前処理</h3>
<section id="rによるスクレイピングと形態素解析" class="level4">
<h4 class="anchored" data-anchor-id="rによるスクレイピングと形態素解析">2.2 Rによるスクレイピングと形態素解析</h4>
<section id="手入力するコードscraping.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードscraping.r">▶ 手入力するコード（<code>scraping.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co"># テキストスクレイピングおよび前処理ーTwitterデータを例として</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co">#①パッケージのインストール</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('rtweet', 'tidyverse')</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="co"># （以下，省略）</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-27" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-27">▶ 一般的なRコード</h5>
<p><code>rtweet</code> パッケージは現在 CRAN から削除されているため，引数を指定せずに <code>install.packages()</code> を実行してもインストールできない。 どうしても使用したい場合は，バージョン <code>2.0.0</code> が最新であるようなので，調べてインストールしてほしい。 なお，未確認ではあるが，Twitter API はすでに利用できなくなっている可能性が高く，<code>rtweet</code> を用いた Twitter（X） からのデータ取得（スクレイピング）は現在では困難と考えられる。</p>
</section>
</section>
</section>
<section id="テキストの可視化" class="level3">
<h3 class="anchored" data-anchor-id="テキストの可視化">3 テキストの可視化</h3>
<section id="rによるワードクラウドとn-gramネットワーク" class="level4">
<h4 class="anchored" data-anchor-id="rによるワードクラウドとn-gramネットワーク">3.2 RによるワードクラウドとN-gramネットワーク</h4>
<section id="手入力するコードwordcloud.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードwordcloud.r">▶ 手入力するコード（<code>wordcloud.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="do">####### ワードクラウド</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RMecabで形態素解析</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1)　https://taku910.github.io/mecab/  &lt;-ここでMecabの最新バージョンをダウンロード</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2)  install.packages("RMeCab", repos = "http://rmecab.jp/R", type = "source")1</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMeCab)</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="co">#①保存されたデータの読み込み</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>cleaned_texts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'cleaned_text.csv'</span>,<span class="at">fileEncoding =</span> <span class="st">'shift-jis'</span>,<span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a>cleaned_texts <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="co"># （以下，省略）</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-28" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-28">▶ 一般的なRコード</h5>
<p>まず，<a href="https://taku910.github.io/mecab/#install" target="_blank">MeCab: Yet Another Part-of-Speech and Morphological Analyzer</a> の指示に従って，パソコンに MeCab をインストールする。</p>
<p>続いて，<a href="https://rmecab.jp/wiki/index.php?RMeCab" target="_blank">RMeCab</a> の指示に従って，R に RMeCab をインストールする。</p>
<p>本章では，Rコマンダーを使用しないため，一般的なRコードは省略する。</p>
</section>
</section>
</section>
<section id="rによる商品レビューコメントを用いた製品評価" class="level3">
<h3 class="anchored" data-anchor-id="rによる商品レビューコメントを用いた製品評価">5 Rによる商品レビューコメントを用いた製品評価</h3>
<section id="手入力するコードlda.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードlda.r">▶ 手入力するコード（<code>LDA.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="do">### LDA(トピックモデル)</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="co">#①パッケージ"lda"のインストール</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("lda")</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lda)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="co"># （以下，省略）</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-29" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-29">▶ 一般的なRコード</h5>
<p>本章では，Rコマンダーを使用しないため，一般的なRコードは省略する。</p>
</section>
</section>
</section>
<section id="第16章-カウントデータの分析" class="level2">
<h2 class="anchored" data-anchor-id="第16章-カウントデータの分析">第16章 カウントデータの分析</h2>
<section id="カウントデータを用いた市場反応分析" class="level3">
<h3 class="anchored" data-anchor-id="カウントデータを用いた市場反応分析">4 カウントデータを用いた市場反応分析</h3>
<section id="事例データ入力データ" class="level4">
<h4 class="anchored" data-anchor-id="事例データ入力データ">4.1 事例データ：入力データ</h4>
<section id="rコマンダーによって生成されたコードp.-330" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-330">▶ Rコマンダーによって生成されたコード（p.&nbsp;330）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.choose</span>(), <span class="at">header=</span><span class="cn">TRUE</span>, </span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">na.strings=</span><span class="st">"NA"</span>, <span class="at">dec=</span><span class="st">"."</span>, <span class="at">strip.white=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Dataset, <span class="fu">Hist</span>(y, <span class="at">scale=</span><span class="st">"frequency"</span>, <span class="at">breaks=</span><span class="st">"Sturges"</span>, <span class="at">col=</span><span class="st">"darkgray"</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-30" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-30">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>Dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.choose</span>())</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Dataset<span class="sc">$</span>y)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="モデルによる分析" class="level4">
<h4 class="anchored" data-anchor-id="モデルによる分析">4.2 モデルによる分析</h4>
<section id="rコマンダーによって生成されたコードp.-332" class="level5">
<h5 class="anchored" data-anchor-id="rコマンダーによって生成されたコードp.-332">▶ Rコマンダーによって生成されたコード（p.&nbsp;332）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>Model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6, <span class="at">family=</span><span class="fu">poisson</span>(log), <span class="at">data=</span>Dataset)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model1)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(Model1))  <span class="co"># Exponentiated coefficients</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>Model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(k)), <span class="at">family=</span><span class="fu">poisson</span>(log), <span class="at">data=</span>Dataset)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model2)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(Model2))  <span class="co"># Exponentiated coefficients</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-31" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-31">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>Model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6, <span class="at">family =</span> <span class="fu">poisson</span>(log), <span class="at">data =</span> Dataset)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model1)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6, family = poisson(log), 
    data = Dataset)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.54603    0.36294   4.260 2.05e-05 ***
x1          -4.06961    0.32365 -12.574  &lt; 2e-16 ***
x2           0.99184    0.05367  18.481  &lt; 2e-16 ***
x3           0.68375    0.06550  10.439  &lt; 2e-16 ***
x4           3.43355    0.33728  10.180  &lt; 2e-16 ***
x5           0.05001    0.06610   0.757    0.449    
x6          -0.22181    0.14134  -1.569    0.117    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2514.8  on 360  degrees of freedom
Residual deviance: 1092.5  on 354  degrees of freedom
AIC: 2141.6

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>Model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(k)), <span class="at">family =</span> <span class="fu">poisson</span>(log), <span class="at">data =</span> Dataset)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model2)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6 + offset(log(k)), 
    family = poisson(log), data = Dataset)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -6.89345    0.36042 -19.126   &lt;2e-16 ***
x1          -4.08155    0.32561 -12.535   &lt;2e-16 ***
x2           1.04012    0.05345  19.461   &lt;2e-16 ***
x3           0.63168    0.06573   9.611   &lt;2e-16 ***
x4           3.71043    0.33722  11.003   &lt;2e-16 ***
x5           0.10315    0.06609   1.561   0.1186    
x6          -0.27589    0.14130  -1.953   0.0509 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2503.1  on 360  degrees of freedom
Residual deviance: 1047.1  on 354  degrees of freedom
AIC: 2096.2

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</section>
<section id="手入力するコードnbr.r" class="level5">
<h5 class="anchored" data-anchor-id="手入力するコードnbr.r">▶ 手入力するコード（<code>NBR.R</code>）</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co">#負の二項回帰で用いるパッケージ「MASS」を読み込む.</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ポアソン回帰モデル（オフセット変数無）のコマンド．教科書ではRコマンダー実施している．</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Model1 &lt;- glm(y ~ x1 + x2 + x3 + x4 + x5 + x6, family=poisson(log),data=Dataset)</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(Model1)</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ポアソン回帰モデル（オフセット変数有）のコマンド．教科書ではRコマンダー実施している．</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Model2 &lt;- glm(y ~ x1 + x2 + x3 + x4 + x5 + x6 + offset(log(k)),family=poisson(log), data=Dataset)</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(Model2)</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="co">#負の二項回帰モデル（オフセット変数無）のコマンド．</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>Model3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6, <span class="at">link=</span>log,<span class="at">data=</span>Dataset)</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model3)</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="co">#負の二項回帰モデル（オフセット変数有）のコマンド．</span></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>Model4 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(k)), <span class="at">link=</span>log,<span class="at">data=</span>Dataset)</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model4)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="一般的なrコード-32" class="level5">
<h5 class="anchored" data-anchor-id="一般的なrコード-32">▶ 一般的なRコード</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>Model3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6, <span class="at">link =</span> log, <span class="at">data =</span> Dataset)</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model3)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6, data = Dataset, 
    link = log, init.theta = 2.847464481)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.87517    0.73728   3.900 9.63e-05 ***
x1          -5.96421    0.57228 -10.422  &lt; 2e-16 ***
x2           0.96808    0.09663  10.018  &lt; 2e-16 ***
x3           0.41945    0.17888   2.345    0.019 *  
x4           3.77215    0.65457   5.763 8.27e-09 ***
x5           0.12944    0.12538   1.032    0.302    
x6          -0.02242    0.22021  -0.102    0.919    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(2.8475) family taken to be 1)

    Null deviance: 861.95  on 360  degrees of freedom
Residual deviance: 387.61  on 354  degrees of freedom
AIC: 1765.7

Number of Fisher Scoring iterations: 1

              Theta:  2.847 
          Std. Err.:  0.350 

 2 x log-likelihood:  -1749.736 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>Model4 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5 <span class="sc">+</span> x6 <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(k)), <span class="at">link =</span> log, <span class="at">data =</span> Dataset)</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Model4)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = y ~ x1 + x2 + x3 + x4 + x5 + x6 + offset(log(k)), 
    data = Dataset, link = log, init.theta = 3.020799298)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.67700    0.72170  -7.866 3.66e-15 ***
x1          -5.73625    0.56215 -10.204  &lt; 2e-16 ***
x2           1.00952    0.09475  10.655  &lt; 2e-16 ***
x3           0.39616    0.17464   2.268   0.0233 *  
x4           3.95109    0.64170   6.157 7.40e-10 ***
x5           0.17002    0.12311   1.381   0.1672    
x6          -0.10558    0.21708  -0.486   0.6267    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(3.0208) family taken to be 1)

    Null deviance: 885.42  on 360  degrees of freedom
Residual deviance: 390.58  on 354  degrees of freedom
AIC: 1757.4

Number of Fisher Scoring iterations: 1

              Theta:  3.021 
          Std. Err.:  0.384 

 2 x log-likelihood:  -1741.352 </code></pre>
</div>
</div>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "コピーしました");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "コピーしました");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>